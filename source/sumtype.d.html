<!DOCTYPE html>
<html lang="en">
<head>
        <title>sumtype source code</title>
	<meta charset="utf-8" />
	<meta content="width=device-width, initial-scale=1" name="viewport" />
        <link href="../style.css" rel="stylesheet" />
        <script src="../script.js" type="text/javascript"></script>

	
	<link href="../search-results.html" rel="prefetch" />
</head>
<body>
	<div id="page-header">
		<div id="logotype">
		<span>Documentation</span>
		<nav>
			<a href="http://dlang.org/">Dlang.org</a>
		</nav>
		</div>

		<form action="../search-docs.html" id="search">
			<input name="searchTerm" placeholder="Find a symbol name..." type="search" />
			<input type="submit" value="Go" />
		</form>
	</div>
	<div id="page-body">
		<div id="page-content">
		<pre class="d_code highlighted with-line-wrappers thousand-lines"><a class="br" href="#L1" id="L1">1 </a><span class="com">/++
<a class="br" href="#L2" id="L2">2 </a>[SumType] is a generic discriminated union implementation that uses
<a class="br" href="#L3" id="L3">3 </a>design-by-introspection to generate safe and efficient code. Its features
<a class="br" href="#L4" id="L4">4 </a>include:
<a class="br" href="#L5" id="L5">5 </a>
<a class="br" href="#L6" id="L6">6 </a>$(LIST
<a class="br" href="#L7" id="L7">7 </a>    * [match|Pattern matching.]
<a class="br" href="#L8" id="L8">8 </a>    * Support for self-referential types.
<a class="br" href="#L9" id="L9">9 </a>    * Full attribute correctness (`pure`, `@safe`, `@nogc`, and `nothrow` are
<a class="br" href="#L10" id="L10">10 </a>      inferred whenever possible).
<a class="br" href="#L11" id="L11">11 </a>    * A type-safe and memory-safe API compatible with DIP 1000 (`scope`).
<a class="br" href="#L12" id="L12">12 </a>    * No dependency on runtime type information (`TypeInfo`).
<a class="br" href="#L13" id="L13">13 </a>    * Compatibility with BetterC.
<a class="br" href="#L14" id="L14">14 </a>)
<a class="br" href="#L15" id="L15">15 </a>
<a class="br" href="#L16" id="L16">16 </a>License: Boost License 1.0
<a class="br" href="#L17" id="L17">17 </a>Authors: Paul Backus
<a class="br" href="#L18" id="L18">18 </a>+/</span>
<a class="br" href="#L19" id="L19">19 </a><span class="kwrd">module</span> <span class="hid">sumtype</span>;
<a class="br" href="#L20" id="L20">20 </a>
<a class="br" href="#L21" id="L21">21 </a><span class="com">/// $(H3 Basic usage)</span>
<a class="br" href="#L22" id="L22">22 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L23" id="L23">23 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L24" id="L24">24 </a>    <span class="kwrd">import</span> <span class="hid">std.math</span>: <a class="hid" href="sumtype.d.html#L1866" title="sumtype.isClose">isClose</a>;
<a class="br" href="#L25" id="L25">25 </a>
<a class="br" href="#L26" id="L26">26 </a>    <span class="kwrd">struct</span> <span class="hid">Fahrenheit</span> { <span class="type">double</span> <span class="hid">degrees</span>; }
<a class="br" href="#L27" id="L27">27 </a>    <span class="kwrd">struct</span> <span class="hid">Celsius</span> { <span class="type">double</span> <span class="hid">degrees</span>; }
<a class="br" href="#L28" id="L28">28 </a>    <span class="kwrd">struct</span> <span class="hid">Kelvin</span> { <span class="type">double</span> <span class="hid">degrees</span>; }
<a class="br" href="#L29" id="L29">29 </a>
<a class="br" href="#L30" id="L30">30 </a>    <span class="kwrd">alias</span> <span class="hid">Temperature</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">Fahrenheit</span>, <span class="hid">Celsius</span>, <span class="hid">Kelvin</span>);
<a class="br" href="#L31" id="L31">31 </a>
<a class="br" href="#L32" id="L32">32 </a>    <span class="com">// Construct from any of the member types.</span>
<a class="br" href="#L33" id="L33">33 </a>    <span class="hid">Temperature</span> <span class="hid">t1</span> = <span class="hid">Fahrenheit</span>(<span class="num">98.6</span>);
<a class="br" href="#L34" id="L34">34 </a>    <span class="hid">Temperature</span> <span class="hid">t2</span> = <span class="hid">Celsius</span>(<span class="num">100</span>);
<a class="br" href="#L35" id="L35">35 </a>    <span class="hid">Temperature</span> <span class="hid">t3</span> = <span class="hid">Kelvin</span>(<span class="num">273</span>);
<a class="br" href="#L36" id="L36">36 </a>
<a class="br" href="#L37" id="L37">37 </a>    <span class="com">// Use pattern matching to access the value.</span>
<a class="br" href="#L38" id="L38">38 </a>    <span class="kwrd">pure</span> @<span class="hid">safe</span> @<span class="hid">nogc</span> <span class="kwrd">nothrow</span>
<a class="br" href="#L39" id="L39">39 </a>    <span class="hid">Fahrenheit</span> <span class="hid">toFahrenheit</span>(<span class="hid">Temperature</span> <span class="hid">t</span>)
<a class="br" href="#L40" id="L40">40 </a>    {
<a class="br" href="#L41" id="L41">41 </a>        <span class="kwrd">return</span> <span class="hid">Fahrenheit</span>(
<a class="br" href="#L42" id="L42">42 </a>            <span class="hid">t.match</span>!(
<a class="br" href="#L43" id="L43">43 </a>                (<span class="hid">Fahrenheit</span> <span class="hid">f</span>) =&gt; <span class="hid">f.degrees</span>,
<a class="br" href="#L44" id="L44">44 </a>                (<span class="hid">Celsius</span> <span class="hid">c</span>) =&gt; <span class="hid">c.degrees</span> * <span class="num">9.0</span>/<span class="num">5</span> + <span class="num">32</span>,
<a class="br" href="#L45" id="L45">45 </a>                (<span class="hid">Kelvin</span> <span class="hid">k</span>) =&gt; <span class="hid">k.degrees</span> * <span class="num">9.0</span>/<span class="num">5</span> - <span class="num">459.4</span>
<a class="br" href="#L46" id="L46">46 </a>            )
<a class="br" href="#L47" id="L47">47 </a>        );
<a class="br" href="#L48" id="L48">48 </a>    }
<a class="br" href="#L49" id="L49">49 </a>
<a class="br" href="#L50" id="L50">50 </a>    <span class="kwrd">assert</span>(<span class="hid">toFahrenheit</span>(<span class="hid">t1</span>).<span class="hid">degrees.isClose</span>(<span class="num">98.6</span>));
<a class="br" href="#L51" id="L51">51 </a>    <span class="kwrd">assert</span>(<span class="hid">toFahrenheit</span>(<span class="hid">t2</span>).<span class="hid">degrees.isClose</span>(<span class="num">212</span>));
<a class="br" href="#L52" id="L52">52 </a>    <span class="kwrd">assert</span>(<span class="hid">toFahrenheit</span>(<span class="hid">t3</span>).<span class="hid">degrees.isClose</span>(<span class="num">32</span>));
<a class="br" href="#L53" id="L53">53 </a>
<a class="br" href="#L54" id="L54">54 </a>    <span class="com">// Use ref to modify the value in place.</span>
<a class="br" href="#L55" id="L55">55 </a>    <span class="kwrd">pure</span> @<span class="hid">safe</span> @<span class="hid">nogc</span> <span class="kwrd">nothrow</span>
<a class="br" href="#L56" id="L56">56 </a>    <span class="type">void</span> <span class="hid">freeze</span>(<span class="kwrd">ref</span> <span class="hid">Temperature</span> <span class="hid">t</span>)
<a class="br" href="#L57" id="L57">57 </a>    {
<a class="br" href="#L58" id="L58">58 </a>        <span class="hid">t.match</span>!(
<a class="br" href="#L59" id="L59">59 </a>            (<span class="kwrd">ref</span> <span class="hid">Fahrenheit</span> <span class="hid">f</span>) =&gt; <span class="hid">f.degrees</span> = <span class="num">32</span>,
<a class="br" href="#L60" id="L60">60 </a>            (<span class="kwrd">ref</span> <span class="hid">Celsius</span> <span class="hid">c</span>) =&gt; <span class="hid">c.degrees</span> = <span class="num">0</span>,
<a class="br" href="#L61" id="L61">61 </a>            (<span class="kwrd">ref</span> <span class="hid">Kelvin</span> <span class="hid">k</span>) =&gt; <span class="hid">k.degrees</span> = <span class="num">273</span>
<a class="br" href="#L62" id="L62">62 </a>        );
<a class="br" href="#L63" id="L63">63 </a>    }
<a class="br" href="#L64" id="L64">64 </a>
<a class="br" href="#L65" id="L65">65 </a>    <span class="hid">freeze</span>(<span class="hid">t1</span>);
<a class="br" href="#L66" id="L66">66 </a>    <span class="kwrd">assert</span>(<span class="hid">toFahrenheit</span>(<span class="hid">t1</span>).<span class="hid">degrees.isClose</span>(<span class="num">32</span>));
<a class="br" href="#L67" id="L67">67 </a>
<a class="br" href="#L68" id="L68">68 </a>    <span class="com">// Use a catch-all handler to give a default result.</span>
<a class="br" href="#L69" id="L69">69 </a>    <span class="kwrd">pure</span> @<span class="hid">safe</span> @<span class="hid">nogc</span> <span class="kwrd">nothrow</span>
<a class="br" href="#L70" id="L70">70 </a>    <span class="type">bool</span> <span class="hid">isFahrenheit</span>(<span class="hid">Temperature</span> <span class="hid">t</span>)
<a class="br" href="#L71" id="L71">71 </a>    {
<a class="br" href="#L72" id="L72">72 </a>        <span class="kwrd">return</span> <span class="hid">t.match</span>!(
<a class="br" href="#L73" id="L73">73 </a>            (<span class="hid">Fahrenheit</span> <span class="hid">f</span>) =&gt; <span class="kwrd">true</span>,
<a class="br" href="#L74" id="L74">74 </a>            <span class="hid">_</span> =&gt; <span class="kwrd">false</span>
<a class="br" href="#L75" id="L75">75 </a>        );
<a class="br" href="#L76" id="L76">76 </a>    }
<a class="br" href="#L77" id="L77">77 </a>
<a class="br" href="#L78" id="L78">78 </a>    <span class="kwrd">assert</span>(<span class="hid">isFahrenheit</span>(<span class="hid">t1</span>));
<a class="br" href="#L79" id="L79">79 </a>    <span class="kwrd">assert</span>(!<span class="hid">isFahrenheit</span>(<span class="hid">t2</span>));
<a class="br" href="#L80" id="L80">80 </a>    <span class="kwrd">assert</span>(!<span class="hid">isFahrenheit</span>(<span class="hid">t3</span>));
<a class="br" href="#L81" id="L81">81 </a>}
<a class="br" href="#L82" id="L82">82 </a>
<a class="br" href="#L83" id="L83">83 </a><span class="com">/** $(H3 Introspection-based matching)
<a class="br" href="#L84" id="L84">84 </a> *
<a class="br" href="#L85" id="L85">85 </a> * In the `length` and `horiz` functions below, the handlers for `match` do not
<a class="br" href="#L86" id="L86">86 </a> * specify the types of their arguments. Instead, matching is done based on how
<a class="br" href="#L87" id="L87">87 </a> * the argument is used in the body of the handler: any type with `x` and `y`
<a class="br" href="#L88" id="L88">88 </a> * properties will be matched by the `rect` handlers, and any type with `r` and
<a class="br" href="#L89" id="L89">89 </a> * `theta` properties will be matched by the `polar` handlers.
<a class="br" href="#L90" id="L90">90 </a> */</span>
<a class="br" href="#L91" id="L91">91 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L92" id="L92">92 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L93" id="L93">93 </a>    <span class="kwrd">import</span> <span class="hid">std.math</span>: <a class="hid" href="sumtype.d.html#L1866" title="sumtype.isClose">isClose</a>, <span class="hid">cos</span>, <span class="hid">PI</span>, <span class="hid">sqrt</span>;
<a class="br" href="#L94" id="L94">94 </a>
<a class="br" href="#L95" id="L95">95 </a>    <span class="kwrd">struct</span> <span class="hid">Rectangular</span> { <span class="type">double</span> <span class="hid">x</span>, <span class="hid">y</span>; }
<a class="br" href="#L96" id="L96">96 </a>    <span class="kwrd">struct</span> <span class="hid">Polar</span> { <span class="type">double</span> <span class="hid">r</span>, <span class="hid">theta</span>; }
<a class="br" href="#L97" id="L97">97 </a>    <span class="kwrd">alias</span> <span class="hid">Vector</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">Rectangular</span>, <span class="hid">Polar</span>);
<a class="br" href="#L98" id="L98">98 </a>
<a class="br" href="#L99" id="L99">99 </a>    <span class="kwrd">pure</span> @<span class="hid">safe</span> @<span class="hid">nogc</span> <span class="kwrd">nothrow</span>
<a class="br" href="#L100" id="L100">100 </a>    <span class="type">double</span> <span class="hid">length</span>(<span class="hid">Vector</span> <span class="hid">v</span>)
<a class="br" href="#L101" id="L101">101 </a>    {
<a class="br" href="#L102" id="L102">102 </a>        <span class="kwrd">return</span> <span class="hid">v.match</span>!(
<a class="br" href="#L103" id="L103">103 </a>            <span class="hid">rect</span> =&gt; <span class="hid">sqrt</span>(<span class="hid">rect.x</span>^^<span class="num">2</span> + <span class="hid">rect.y</span>^^<span class="num">2</span>),
<a class="br" href="#L104" id="L104">104 </a>            <span class="hid">polar</span> =&gt; <span class="hid">polar.r</span>
<a class="br" href="#L105" id="L105">105 </a>        );
<a class="br" href="#L106" id="L106">106 </a>    }
<a class="br" href="#L107" id="L107">107 </a>
<a class="br" href="#L108" id="L108">108 </a>    <span class="kwrd">pure</span> @<span class="hid">safe</span> @<span class="hid">nogc</span> <span class="kwrd">nothrow</span>
<a class="br" href="#L109" id="L109">109 </a>    <span class="type">double</span> <span class="hid">horiz</span>(<span class="hid">Vector</span> <span class="hid">v</span>)
<a class="br" href="#L110" id="L110">110 </a>    {
<a class="br" href="#L111" id="L111">111 </a>        <span class="kwrd">return</span> <span class="hid">v.match</span>!(
<a class="br" href="#L112" id="L112">112 </a>            <span class="hid">rect</span> =&gt; <span class="hid">rect.x</span>,
<a class="br" href="#L113" id="L113">113 </a>            <span class="hid">polar</span> =&gt; <span class="hid">polar.r</span> * <span class="hid">cos</span>(<span class="hid">polar.theta</span>)
<a class="br" href="#L114" id="L114">114 </a>        );
<a class="br" href="#L115" id="L115">115 </a>    }
<a class="br" href="#L116" id="L116">116 </a>
<a class="br" href="#L117" id="L117">117 </a>    <span class="hid">Vector</span> <span class="hid">u</span> = <span class="hid">Rectangular</span>(<span class="num">1</span>, <span class="num">1</span>);
<a class="br" href="#L118" id="L118">118 </a>    <span class="hid">Vector</span> <span class="hid">v</span> = <span class="hid">Polar</span>(<span class="num">1</span>, <span class="hid">PI</span>/<span class="num">4</span>);
<a class="br" href="#L119" id="L119">119 </a>
<a class="br" href="#L120" id="L120">120 </a>    <span class="kwrd">assert</span>(<span class="hid">length</span>(<span class="hid">u</span>).<a class="hid" href="sumtype.d.html#L1866" title="sumtype.isClose">isClose</a>(<span class="hid">sqrt</span>(<span class="num">2.0</span>)));
<a class="br" href="#L121" id="L121">121 </a>    <span class="kwrd">assert</span>(<span class="hid">length</span>(<span class="hid">v</span>).<a class="hid" href="sumtype.d.html#L1866" title="sumtype.isClose">isClose</a>(<span class="num">1</span>));
<a class="br" href="#L122" id="L122">122 </a>    <span class="kwrd">assert</span>(<span class="hid">horiz</span>(<span class="hid">u</span>).<a class="hid" href="sumtype.d.html#L1866" title="sumtype.isClose">isClose</a>(<span class="num">1</span>));
<a class="br" href="#L123" id="L123">123 </a>    <span class="kwrd">assert</span>(<span class="hid">horiz</span>(<span class="hid">v</span>).<a class="hid" href="sumtype.d.html#L1866" title="sumtype.isClose">isClose</a>(<span class="hid">sqrt</span>(<span class="num">0.5</span>)));
<a class="br" href="#L124" id="L124">124 </a>}
<a class="br" href="#L125" id="L125">125 </a>
<a class="br" href="#L126" id="L126">126 </a><span class="com">/** $(H3 Arithmetic expression evaluator)
<a class="br" href="#L127" id="L127">127 </a> *
<a class="br" href="#L128" id="L128">128 </a> * This example makes use of the special placeholder type `This` to define a
<a class="br" href="#L129" id="L129">129 </a> * [https://en.wikipedia.org/wiki/Recursive_data_type|recursive data type]: an
<a class="br" href="#L130" id="L130">130 </a> * [https://en.wikipedia.org/wiki/Abstract_syntax_tree|abstract syntax tree] for
<a class="br" href="#L131" id="L131">131 </a> * representing simple arithmetic expressions.
<a class="br" href="#L132" id="L132">132 </a> */</span>
<a class="br" href="#L133" id="L133">133 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L134" id="L134">134 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L135" id="L135">135 </a>    <span class="kwrd">import</span> <span class="hid">std.functional</span>: <span class="hid">partial</span>;
<a class="br" href="#L136" id="L136">136 </a>    <span class="kwrd">import</span> <span class="hid">std.traits</span>: <span class="hid">EnumMembers</span>;
<a class="br" href="#L137" id="L137">137 </a>    <span class="kwrd">import</span> <span class="hid">std.typecons</span>: <span class="hid">Tuple</span>;
<a class="br" href="#L138" id="L138">138 </a>
<a class="br" href="#L139" id="L139">139 </a>    <span class="kwrd">enum</span> <span class="hid">Op</span> : <span class="type">string</span>
<a class="br" href="#L140" id="L140">140 </a>    {
<a class="br" href="#L141" id="L141">141 </a>        <span class="hid">Plus</span>  = <span class="str">&quot;+&quot;</span>,
<a class="br" href="#L142" id="L142">142 </a>        <span class="hid">Minus</span> = <span class="str">&quot;-&quot;</span>,
<a class="br" href="#L143" id="L143">143 </a>        <span class="hid">Times</span> = <span class="str">&quot;*&quot;</span>,
<a class="br" href="#L144" id="L144">144 </a>        <span class="hid">Div</span>   = <span class="str">&quot;/&quot;</span>
<a class="br" href="#L145" id="L145">145 </a>    }
<a class="br" href="#L146" id="L146">146 </a>
<a class="br" href="#L147" id="L147">147 </a>    <span class="com">// An expression is either</span>
<a class="br" href="#L148" id="L148">148 </a>    <span class="com">//  - a number,</span>
<a class="br" href="#L149" id="L149">149 </a>    <span class="com">//  - a variable, or</span>
<a class="br" href="#L150" id="L150">150 </a>    <span class="com">//  - a binary operation combining two sub-expressions.</span>
<a class="br" href="#L151" id="L151">151 </a>    <span class="kwrd">alias</span> <span class="hid">Expr</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(
<a class="br" href="#L152" id="L152">152 </a>        <span class="type">double</span>,
<a class="br" href="#L153" id="L153">153 </a>        <span class="type">string</span>,
<a class="br" href="#L154" id="L154">154 </a>        <span class="hid">Tuple</span>!(<span class="hid">Op</span>, <span class="str">&quot;op&quot;</span>, <a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>*, <span class="str">&quot;lhs&quot;</span>, <a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>*, <span class="str">&quot;rhs&quot;</span>)
<a class="br" href="#L155" id="L155">155 </a>    );
<a class="br" href="#L156" id="L156">156 </a>
<a class="br" href="#L157" id="L157">157 </a>    <span class="com">// Shorthand for Tuple!(Op, &quot;op&quot;, Expr*, &quot;lhs&quot;, Expr*, &quot;rhs&quot;),</span>
<a class="br" href="#L158" id="L158">158 </a>    <span class="com">// the Tuple type above with Expr substituted for This.</span>
<a class="br" href="#L159" id="L159">159 </a>    <span class="kwrd">alias</span> <span class="hid">BinOp</span> = <span class="hid">Expr.Types</span>[<span class="num">2</span>];
<a class="br" href="#L160" id="L160">160 </a>
<a class="br" href="#L161" id="L161">161 </a>    <span class="com">// Factory function for number expressions</span>
<a class="br" href="#L162" id="L162">162 </a>    <span class="kwrd">pure</span> @<span class="hid">safe</span>
<a class="br" href="#L163" id="L163">163 </a>    <span class="hid">Expr</span>* <span class="hid">num</span>(<span class="type">double</span> <span class="hid">value</span>)
<a class="br" href="#L164" id="L164">164 </a>    {
<a class="br" href="#L165" id="L165">165 </a>        <span class="kwrd">return</span> <span class="kwrd">new</span> <span class="hid">Expr</span>(<span class="hid">value</span>);
<a class="br" href="#L166" id="L166">166 </a>    }
<a class="br" href="#L167" id="L167">167 </a>
<a class="br" href="#L168" id="L168">168 </a>    <span class="com">// Factory function for variable expressions</span>
<a class="br" href="#L169" id="L169">169 </a>    <span class="kwrd">pure</span> @<span class="hid">safe</span>
<a class="br" href="#L170" id="L170">170 </a>    <span class="hid">Expr</span>* <span class="hid">var</span>(<span class="type">string</span> <span class="hid">name</span>)
<a class="br" href="#L171" id="L171">171 </a>    {
<a class="br" href="#L172" id="L172">172 </a>        <span class="kwrd">return</span> <span class="kwrd">new</span> <span class="hid">Expr</span>(<span class="hid">name</span>);
<a class="br" href="#L173" id="L173">173 </a>    }
<a class="br" href="#L174" id="L174">174 </a>
<a class="br" href="#L175" id="L175">175 </a>    <span class="com">// Factory function for binary operation expressions</span>
<a class="br" href="#L176" id="L176">176 </a>    <span class="kwrd">pure</span> @<span class="hid">safe</span>
<a class="br" href="#L177" id="L177">177 </a>    <span class="hid">Expr</span>* <span class="hid">binOp</span>(<span class="hid">Op</span> <span class="hid">op</span>, <span class="hid">Expr</span>* <span class="hid">lhs</span>, <span class="hid">Expr</span>* <span class="hid">rhs</span>)
<a class="br" href="#L178" id="L178">178 </a>    {
<a class="br" href="#L179" id="L179">179 </a>        <span class="kwrd">return</span> <span class="kwrd">new</span> <span class="hid">Expr</span>(<span class="hid">BinOp</span>(<span class="hid">op</span>, <span class="hid">lhs</span>, <span class="hid">rhs</span>));
<a class="br" href="#L180" id="L180">180 </a>    }
<a class="br" href="#L181" id="L181">181 </a>
<a class="br" href="#L182" id="L182">182 </a>    <span class="com">// Convenience wrappers for creating BinOp expressions</span>
<a class="br" href="#L183" id="L183">183 </a>    <span class="kwrd">alias</span> <span class="hid">sum</span>  = <span class="hid">partial</span>!(<span class="hid">binOp</span>, <span class="hid">Op.Plus</span>);
<a class="br" href="#L184" id="L184">184 </a>    <span class="kwrd">alias</span> <span class="hid">diff</span> = <span class="hid">partial</span>!(<span class="hid">binOp</span>, <span class="hid">Op.Minus</span>);
<a class="br" href="#L185" id="L185">185 </a>    <span class="kwrd">alias</span> <span class="hid">prod</span> = <span class="hid">partial</span>!(<span class="hid">binOp</span>, <span class="hid">Op.Times</span>);
<a class="br" href="#L186" id="L186">186 </a>    <span class="kwrd">alias</span> <span class="hid">quot</span> = <span class="hid">partial</span>!(<span class="hid">binOp</span>, <span class="hid">Op.Div</span>);
<a class="br" href="#L187" id="L187">187 </a>
<a class="br" href="#L188" id="L188">188 </a>    <span class="com">// Evaluate expr, looking up variables in env</span>
<a class="br" href="#L189" id="L189">189 </a>    <span class="kwrd">pure</span> @<span class="hid">safe</span> <span class="kwrd">nothrow</span>
<a class="br" href="#L190" id="L190">190 </a>    <span class="type">double</span> <span class="hid">eval</span>(<span class="hid">Expr</span> <span class="hid">expr</span>, <span class="type">double</span>[<span class="type">string</span>] <span class="hid">env</span>)
<a class="br" href="#L191" id="L191">191 </a>    {
<a class="br" href="#L192" id="L192">192 </a>        <span class="kwrd">return</span> <span class="hid">expr.match</span>!(
<a class="br" href="#L193" id="L193">193 </a>            (<span class="type">double</span> <span class="hid">num</span>) =&gt; <span class="hid">num</span>,
<a class="br" href="#L194" id="L194">194 </a>            (<span class="type">string</span> <span class="hid">var</span>) =&gt; <span class="hid">env</span>[<span class="hid">var</span>],
<a class="br" href="#L195" id="L195">195 </a>            (<span class="hid">BinOp</span> <span class="hid">bop</span>) {
<a class="br" href="#L196" id="L196">196 </a>                <span class="type">double</span> <span class="hid">lhs</span> = <span class="hid">eval</span>(*<span class="hid">bop.lhs</span>, <span class="hid">env</span>);
<a class="br" href="#L197" id="L197">197 </a>                <span class="type">double</span> <span class="hid">rhs</span> = <span class="hid">eval</span>(*<span class="hid">bop.rhs</span>, <span class="hid">env</span>);
<a class="br" href="#L198" id="L198">198 </a>                <span class="kwrd">final</span> <span class="kwrd">switch</span>(<span class="hid">bop.op</span>) {
<a class="br" href="#L199" id="L199">199 </a>                    <span class="kwrd">static</span> <span class="kwrd">foreach</span>(<span class="hid">op</span>; <span class="hid">EnumMembers</span>!<span class="hid">Op</span>) {
<a class="br" href="#L200" id="L200">200 </a>                        <span class="kwrd">case</span> <span class="hid">op</span>:
<a class="br" href="#L201" id="L201">201 </a>                            <span class="kwrd">return</span> <span class="kwrd">mixin</span>(<span class="str">&quot;lhs&quot;</span> ~ <span class="hid">op</span> ~ <span class="str">&quot;rhs&quot;</span>);
<a class="br" href="#L202" id="L202">202 </a>                    }
<a class="br" href="#L203" id="L203">203 </a>                }
<a class="br" href="#L204" id="L204">204 </a>            }
<a class="br" href="#L205" id="L205">205 </a>        );
<a class="br" href="#L206" id="L206">206 </a>    }
<a class="br" href="#L207" id="L207">207 </a>
<a class="br" href="#L208" id="L208">208 </a>    <span class="com">// Return a &quot;pretty-printed&quot; representation of expr</span>
<a class="br" href="#L209" id="L209">209 </a>    @<span class="hid">safe</span>
<a class="br" href="#L210" id="L210">210 </a>    <span class="type">string</span> <span class="hid">pprint</span>(<span class="hid">Expr</span> <span class="hid">expr</span>)
<a class="br" href="#L211" id="L211">211 </a>    {
<a class="br" href="#L212" id="L212">212 </a>        <span class="kwrd">import</span> <span class="hid">std.format</span>;
<a class="br" href="#L213" id="L213">213 </a>
<a class="br" href="#L214" id="L214">214 </a>        <span class="kwrd">return</span> <span class="hid">expr.match</span>!(
<a class="br" href="#L215" id="L215">215 </a>            (<span class="type">double</span> <span class="hid">num</span>) =&gt; <span class="str">&quot;%g&quot;</span>.<span class="hid">format</span>(<span class="hid">num</span>),
<a class="br" href="#L216" id="L216">216 </a>            (<span class="type">string</span> <span class="hid">var</span>) =&gt; <span class="hid">var</span>,
<a class="br" href="#L217" id="L217">217 </a>            (<span class="hid">BinOp</span> <span class="hid">bop</span>) =&gt; <span class="str">&quot;(%s %s %s)&quot;</span>.<span class="hid">format</span>(
<a class="br" href="#L218" id="L218">218 </a>                <span class="hid">pprint</span>(*<span class="hid">bop.lhs</span>),
<a class="br" href="#L219" id="L219">219 </a>                <span class="kwrd">cast</span>(<span class="type">string</span>) <span class="hid">bop.op</span>,
<a class="br" href="#L220" id="L220">220 </a>                <span class="hid">pprint</span>(*<span class="hid">bop.rhs</span>)
<a class="br" href="#L221" id="L221">221 </a>            )
<a class="br" href="#L222" id="L222">222 </a>        );
<a class="br" href="#L223" id="L223">223 </a>    }
<a class="br" href="#L224" id="L224">224 </a>
<a class="br" href="#L225" id="L225">225 </a>    <span class="hid">Expr</span>* <span class="hid">myExpr</span> = <span class="hid">sum</span>(<span class="hid">var</span>(<span class="str">&quot;a&quot;</span>), <span class="hid">prod</span>(<span class="hid">num</span>(<span class="num">2</span>), <span class="hid">var</span>(<span class="str">&quot;b&quot;</span>)));
<a class="br" href="#L226" id="L226">226 </a>    <span class="type">double</span>[<span class="type">string</span>] <span class="hid">myEnv</span> = [<span class="str">&quot;a&quot;</span>:<span class="num">3</span>, <span class="str">&quot;b&quot;</span>:<span class="num">4</span>, <span class="str">&quot;c&quot;</span>:<span class="num">7</span>];
<a class="br" href="#L227" id="L227">227 </a>
<a class="br" href="#L228" id="L228">228 </a>    <span class="kwrd">assert</span>(<span class="hid">eval</span>(*<span class="hid">myExpr</span>, <span class="hid">myEnv</span>) == <span class="num">11</span>);
<a class="br" href="#L229" id="L229">229 </a>    <span class="kwrd">assert</span>(<span class="hid">pprint</span>(*<span class="hid">myExpr</span>) == <span class="str">&quot;(a + (2 * b))&quot;</span>);
<a class="br" href="#L230" id="L230">230 </a>}
<a class="br" href="#L231" id="L231">231 </a>
<a class="br" href="#L232" id="L232">232 </a><span class="kwrd">import</span> <span class="hid">std.format</span>: <span class="hid">FormatSpec</span>, <span class="hid">singleSpec</span>;
<a class="br" href="#L233" id="L233">233 </a><span class="kwrd">import</span> <span class="hid">std.meta</span>: <span class="hid">AliasSeq</span>, <span class="hid">Filter</span>, <span class="hid">IndexOf</span> = <span class="hid">staticIndexOf</span>, <span class="hid">Map</span> = <span class="hid">staticMap</span>;
<a class="br" href="#L234" id="L234">234 </a><span class="kwrd">import</span> <span class="hid">std.meta</span>: <span class="hid">NoDuplicates</span>;
<a class="br" href="#L235" id="L235">235 </a><span class="kwrd">import</span> <span class="hid">std.meta</span>: <span class="hid">anySatisfy</span>, <span class="hid">allSatisfy</span>;
<a class="br" href="#L236" id="L236">236 </a><span class="kwrd">import</span> <span class="hid">std.traits</span>: <span class="hid">hasElaborateCopyConstructor</span>, <span class="hid">hasElaborateDestructor</span>;
<a class="br" href="#L237" id="L237">237 </a><span class="kwrd">import</span> <span class="hid">std.traits</span>: <span class="hid">isAssignable</span>, <span class="hid">isCopyable</span>, <span class="hid">isStaticArray</span>;
<a class="br" href="#L238" id="L238">238 </a><span class="kwrd">import</span> <span class="hid">std.traits</span>: <span class="hid">ConstOf</span>, <span class="hid">ImmutableOf</span>, <span class="hid">InoutOf</span>, <span class="hid">TemplateArgsOf</span>;
<a class="br" href="#L239" id="L239">239 </a><span class="kwrd">import</span> <span class="hid">std.traits</span>: <span class="hid">CommonType</span>;
<a class="br" href="#L240" id="L240">240 </a><span class="kwrd">import</span> <span class="hid">std.typecons</span>: <span class="hid">ReplaceTypeUnless</span>;
<a class="br" href="#L241" id="L241">241 </a><span class="kwrd">import</span> <span class="hid">std.typecons</span>: <span class="hid">Flag</span>;
<a class="br" href="#L242" id="L242">242 </a>
<a class="br" href="#L243" id="L243">243 </a><span class="com">/// Placeholder used to refer to the enclosing [SumType].</span>
<a class="br" href="#L244" id="L244">244 </a><span class="kwrd">struct</span> <a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a> {}
<a class="br" href="#L245" id="L245">245 </a>
<a class="br" href="#L246" id="L246">246 </a><span class="com">// Converts an unsigned integer to a compile-time string constant.</span>
<a class="br" href="#L247" id="L247">247 </a><span class="kwrd">private</span> <span class="kwrd">enum</span> <a class="hid" href="sumtype.d.html#L247" title="sumtype.toCtString">toCtString</a>(<span class="type">ulong</span> <span class="hid">n</span>) = <span class="hid">n.stringof</span>[<span class="num">0</span> .. $ - <span class="str">&quot;LU&quot;</span>.<span class="hid">length</span>];
<a class="br" href="#L248" id="L248">248 </a>
<a class="br" href="#L249" id="L249">249 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L250" id="L250">250 </a>	<span class="kwrd">assert</span>(<a class="hid" href="sumtype.d.html#L247" title="sumtype.toCtString">toCtString</a>!<span class="num">0</span> == <span class="str">&quot;0&quot;</span>);
<a class="br" href="#L251" id="L251">251 </a>	<span class="kwrd">assert</span>(<a class="hid" href="sumtype.d.html#L247" title="sumtype.toCtString">toCtString</a>!<span class="num">123456</span> == <span class="str">&quot;123456&quot;</span>);
<a class="br" href="#L252" id="L252">252 </a>}
<a class="br" href="#L253" id="L253">253 </a>
<a class="br" href="#L254" id="L254">254 </a><span class="com">// True if a variable of type T can appear on the lhs of an assignment</span>
<a class="br" href="#L255" id="L255">255 </a><span class="kwrd">private</span> <span class="kwrd">enum</span> <a class="hid" href="sumtype.d.html#L255" title="sumtype.isAssignableTo">isAssignableTo</a>(<span class="hid">T</span>) =
<a class="br" href="#L256" id="L256">256 </a>	<span class="hid">isAssignable</span>!<span class="hid">T</span> || (!<span class="hid">isCopyable</span>!<span class="hid">T</span> &amp;&amp; <a class="hid" href="sumtype.d.html#L2226" title="sumtype.isRvalueAssignable">isRvalueAssignable</a>!<span class="hid">T</span>);
<a class="br" href="#L257" id="L257">257 </a>
<a class="br" href="#L258" id="L258">258 </a><span class="com">// toHash is required by the language spec to be nothrow and @safe</span>
<a class="br" href="#L259" id="L259">259 </a><span class="kwrd">private</span> <span class="kwrd">enum</span> <a class="hid" href="sumtype.d.html#L259" title="sumtype.isHashable">isHashable</a>(<span class="hid">T</span>) = <span class="kwrd">__traits</span>(<span class="hid">compiles</span>,
<a class="br" href="#L260" id="L260">260 </a>	() <span class="kwrd">nothrow</span> @<span class="hid">safe</span> { <span class="hid">hashOf</span>(<span class="hid">T.init</span>); }
<a class="br" href="#L261" id="L261">261 </a>);
<a class="br" href="#L262" id="L262">262 </a>
<a class="br" href="#L263" id="L263">263 </a><span class="com">/**
<a class="br" href="#L264" id="L264">264 </a> * A tagged union that can hold a single value from any of a specified set of
<a class="br" href="#L265" id="L265">265 </a> * types.
<a class="br" href="#L266" id="L266">266 </a> *
<a class="br" href="#L267" id="L267">267 </a> * The value in a `SumType` can be operated on using [match|pattern matching].
<a class="br" href="#L268" id="L268">268 </a> *
<a class="br" href="#L269" id="L269">269 </a> * To avoid ambiguity, duplicate types are not allowed (but see the
<a class="br" href="#L270" id="L270">270 </a> * [sumtype#basic-usage|&quot;basic usage&quot; example] for a workaround).
<a class="br" href="#L271" id="L271">271 </a> *
<a class="br" href="#L272" id="L272">272 </a> * The special type `This` can be used as a placeholder to create
<a class="br" href="#L273" id="L273">273 </a> * self-referential types, just like with `Algebraic`. See the
<a class="br" href="#L274" id="L274">274 </a> * [sumtype#arithmetic-expression-evaluator|&quot;Arithmetic expression evaluator&quot; example] for
<a class="br" href="#L275" id="L275">275 </a> * usage.
<a class="br" href="#L276" id="L276">276 </a> *
<a class="br" href="#L277" id="L277">277 </a> * A `SumType` is initialized by default to hold the `.init` value of its
<a class="br" href="#L278" id="L278">278 </a> * first member type, just like a regular union. The version identifier
<a class="br" href="#L279" id="L279">279 </a> * `SumTypeNoDefaultCtor` can be used to disable this behavior.
<a class="br" href="#L280" id="L280">280 </a> *
<a class="br" href="#L281" id="L281">281 </a> * See_Also: `std.variant.Algebraic`
<a class="br" href="#L282" id="L282">282 </a> */</span>
<a class="br" href="#L283" id="L283">283 </a><span class="kwrd">struct</span> <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>(<span class="hid">Types</span>...)
<a class="br" href="#L284" id="L284">284 </a>	<span class="kwrd">if</span> (<span class="kwrd">is</span>(<span class="hid">NoDuplicates</span>!<span class="hid">Types</span> == <span class="hid">Types</span>) &amp;&amp; <span class="hid">Types.length</span> &gt; <span class="num">0</span>)
<a class="br" href="#L285" id="L285">285 </a>{
<a class="br" href="#L286" id="L286">286 </a>	<span class="com">/// The types a `SumType` can hold.</span>
<a class="br" href="#L287" id="L287">287 </a>	<span class="kwrd">alias</span> <span class="hid">Types</span> = <span class="hid">AliasSeq</span>!(
<a class="br" href="#L288" id="L288">288 </a>		<span class="hid">ReplaceTypeUnless</span>!(<a class="hid" href="sumtype.d.html#L1286" title="sumtype.isSumTypeInstance">isSumTypeInstance</a>, <a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>, <span class="kwrd">typeof</span>(<span class="kwrd">this</span>), <span class="hid">TemplateArgsOf</span>!<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>)
<a class="br" href="#L289" id="L289">289 </a>	);
<a class="br" href="#L290" id="L290">290 </a>
<a class="br" href="#L291" id="L291">291 </a><span class="kwrd">private</span>:
<a class="br" href="#L292" id="L292">292 </a>
<a class="br" href="#L293" id="L293">293 </a>	<span class="kwrd">enum</span> <span class="type">bool</span> <span class="hid">canHoldTag</span>(<span class="hid">T</span>) = <span class="hid">Types.length</span> &lt;= <span class="hid">T.max</span>;
<a class="br" href="#L294" id="L294">294 </a>	<span class="kwrd">alias</span> <span class="hid">unsignedInts</span> = <span class="hid">AliasSeq</span>!(<span class="type">ubyte</span>, <span class="type">ushort</span>, <span class="type">uint</span>, <span class="type">ulong</span>);
<a class="br" href="#L295" id="L295">295 </a>
<a class="br" href="#L296" id="L296">296 </a>	<span class="kwrd">alias</span> <span class="hid">Tag</span> = <span class="hid">Filter</span>!(<span class="hid">canHoldTag</span>, <span class="hid">unsignedInts</span>)[<span class="num">0</span>];
<a class="br" href="#L297" id="L297">297 </a>
<a class="br" href="#L298" id="L298">298 </a>	<span class="kwrd">union</span> <span class="hid">Storage</span>
<a class="br" href="#L299" id="L299">299 </a>	{
<a class="br" href="#L300" id="L300">300 </a>		<span class="kwrd">template</span> <span class="hid">memberName</span>(<span class="hid">T</span>)
<a class="br" href="#L301" id="L301">301 </a>			<span class="kwrd">if</span> (<span class="hid">IndexOf</span>!(<span class="hid">T</span>, <span class="hid">Types</span>) &gt;= <span class="num">0</span>)
<a class="br" href="#L302" id="L302">302 </a>		{
<a class="br" href="#L303" id="L303">303 </a>			<span class="kwrd">enum</span> <span class="hid">tid</span> = <span class="hid">IndexOf</span>!(<span class="hid">T</span>, <span class="hid">Types</span>);
<a class="br" href="#L304" id="L304">304 </a>			<span class="kwrd">mixin</span>(<span class="str">&quot;enum memberName = `values_&quot;</span>, <a class="hid" href="sumtype.d.html#L247" title="sumtype.toCtString">toCtString</a>!<span class="hid">tid</span>, <span class="str">&quot;`;&quot;</span>);
<a class="br" href="#L305" id="L305">305 </a>		}
<a class="br" href="#L306" id="L306">306 </a>
<a class="br" href="#L307" id="L307">307 </a>		<span class="kwrd">static</span> <span class="kwrd">foreach</span> (<span class="hid">T</span>; <span class="hid">Types</span>) {
<a class="br" href="#L308" id="L308">308 </a>			<span class="kwrd">mixin</span>(<span class="str">&quot;T &quot;</span>, <span class="hid">memberName</span>!<span class="hid">T</span>, <span class="str">&quot;;&quot;</span>);
<a class="br" href="#L309" id="L309">309 </a>		}
<a class="br" href="#L310" id="L310">310 </a>	}
<a class="br" href="#L311" id="L311">311 </a>
<a class="br" href="#L312" id="L312">312 </a>	<span class="hid">Storage</span> <span class="hid">storage</span>;
<a class="br" href="#L313" id="L313">313 </a>	<span class="hid">Tag</span> <span class="hid">tag</span>;
<a class="br" href="#L314" id="L314">314 </a>
<a class="br" href="#L315" id="L315">315 </a>	<span class="com">/**
<a class="br" href="#L316" id="L316">316 </a>	 * Accesses the value stored in a SumType.
<a class="br" href="#L317" id="L317">317 </a>	 *
<a class="br" href="#L318" id="L318">318 </a>	 * This method is memory-safe, provided that:
<a class="br" href="#L319" id="L319">319 </a>	 *
<a class="br" href="#L320" id="L320">320 </a>	 *   1. A SumType's tag is always accurate.
<a class="br" href="#L321" id="L321">321 </a>	 *   2. A SumType cannot be assigned to in @safe code if that assignment
<a class="br" href="#L322" id="L322">322 </a>	 *      could cause unsafe aliasing.
<a class="br" href="#L323" id="L323">323 </a>	 *
<a class="br" href="#L324" id="L324">324 </a>	 * All code that accesses a SumType's tag or storage directly, including
<a class="br" href="#L325" id="L325">325 </a>	 * @safe code in this module, must be manually checked to ensure that it
<a class="br" href="#L326" id="L326">326 </a>	 * does not violate either of the above requirements.
<a class="br" href="#L327" id="L327">327 </a>	 */</span>
<a class="br" href="#L328" id="L328">328 </a>	@<span class="hid">trusted</span>
<a class="br" href="#L329" id="L329">329 </a>	<span class="kwrd">ref</span> <span class="kwrd">inout</span>(<span class="hid">T</span>) <span class="hid">get</span>(<span class="hid">T</span>)() <span class="kwrd">inout</span>
<a class="br" href="#L330" id="L330">330 </a>		<span class="kwrd">if</span> (<span class="hid">IndexOf</span>!(<span class="hid">T</span>, <span class="hid">Types</span>) &gt;= <span class="num">0</span>)
<a class="br" href="#L331" id="L331">331 </a>	{
<a class="br" href="#L332" id="L332">332 </a>		<span class="kwrd">enum</span> <span class="hid">tid</span> = <span class="hid">IndexOf</span>!(<span class="hid">T</span>, <span class="hid">Types</span>);
<a class="br" href="#L333" id="L333">333 </a>		<span class="kwrd">assert</span>(<span class="hid">tag</span> == <span class="hid">tid</span>);
<a class="br" href="#L334" id="L334">334 </a>		<span class="kwrd">return</span> <span class="kwrd">__traits</span>(<span class="hid">getMember</span>, <span class="hid">storage</span>, <span class="hid">Storage.memberName</span>!<span class="hid">T</span>);
<a class="br" href="#L335" id="L335">335 </a>	}
<a class="br" href="#L336" id="L336">336 </a>
<a class="br" href="#L337" id="L337">337 </a><span class="kwrd">public</span>:
<a class="br" href="#L338" id="L338">338 </a>
<a class="br" href="#L339" id="L339">339 </a>	<span class="kwrd">static</span> <span class="kwrd">foreach</span> (<span class="hid">tid</span>, <span class="hid">T</span>; <span class="hid">Types</span>) {
<a class="br" href="#L340" id="L340">340 </a>		<span class="com">/// Constructs a `SumType` holding a specific value.</span>
<a class="br" href="#L341" id="L341">341 </a>		<span class="kwrd">this</span>()(<span class="kwrd">auto</span> <span class="kwrd">ref</span> <span class="hid">T</span> <span class="hid">value</span>)
<a class="br" href="#L342" id="L342">342 </a>		{
<a class="br" href="#L343" id="L343">343 </a>			<span class="kwrd">import</span> <span class="hid">core.lifetime</span>: <span class="hid">forward</span>;
<a class="br" href="#L344" id="L344">344 </a>
<a class="br" href="#L345" id="L345">345 </a>			<span class="hid">storage</span> = () {
<a class="br" href="#L346" id="L346">346 </a>				<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="hid">isCopyable</span>!<span class="hid">T</span>) {
<a class="br" href="#L347" id="L347">347 </a>					<span class="kwrd">mixin</span>(<span class="str">&quot;Storage newStorage = { &quot;</span>,
<a class="br" href="#L348" id="L348">348 </a>						<span class="hid">Storage.memberName</span>!<span class="hid">T</span>, <span class="str">&quot;: value&quot;</span>,
<a class="br" href="#L349" id="L349">349 </a>					<span class="str">&quot; };&quot;</span>);
<a class="br" href="#L350" id="L350">350 </a>				} <span class="kwrd">else</span> {
<a class="br" href="#L351" id="L351">351 </a>					<span class="kwrd">mixin</span>(<span class="str">&quot;Storage newStorage = { &quot;</span>,
<a class="br" href="#L352" id="L352">352 </a>						<span class="hid">Storage.memberName</span>!<span class="hid">T</span>, <span class="str">&quot; : forward!value&quot;</span>,
<a class="br" href="#L353" id="L353">353 </a>					<span class="str">&quot; };&quot;</span>);
<a class="br" href="#L354" id="L354">354 </a>				}
<a class="br" href="#L355" id="L355">355 </a>
<a class="br" href="#L356" id="L356">356 </a>				<span class="kwrd">return</span> <span class="hid">newStorage</span>;
<a class="br" href="#L357" id="L357">357 </a>			}();
<a class="br" href="#L358" id="L358">358 </a>
<a class="br" href="#L359" id="L359">359 </a>			<span class="hid">tag</span> = <span class="hid">tid</span>;
<a class="br" href="#L360" id="L360">360 </a>		}
<a class="br" href="#L361" id="L361">361 </a>
<a class="br" href="#L362" id="L362">362 </a>		<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="hid">isCopyable</span>!<span class="hid">T</span>) {
<a class="br" href="#L363" id="L363">363 </a>			<span class="com">/// ditto</span>
<a class="br" href="#L364" id="L364">364 </a>			<span class="kwrd">this</span>()(<span class="kwrd">auto</span> <span class="kwrd">ref</span> <span class="kwrd">const</span>(<span class="hid">T</span>) <span class="hid">value</span>) <span class="kwrd">const</span>
<a class="br" href="#L365" id="L365">365 </a>			{
<a class="br" href="#L366" id="L366">366 </a>				<span class="hid">storage</span> = () {
<a class="br" href="#L367" id="L367">367 </a>					<span class="kwrd">mixin</span>(<span class="str">&quot;const(Storage) newStorage = { &quot;</span>,
<a class="br" href="#L368" id="L368">368 </a>						<span class="hid">Storage.memberName</span>!<span class="hid">T</span>, <span class="str">&quot;: value&quot;</span>,
<a class="br" href="#L369" id="L369">369 </a>					<span class="str">&quot; };&quot;</span>);
<a class="br" href="#L370" id="L370">370 </a>
<a class="br" href="#L371" id="L371">371 </a>					<span class="kwrd">return</span> <span class="hid">newStorage</span>;
<a class="br" href="#L372" id="L372">372 </a>				}();
<a class="br" href="#L373" id="L373">373 </a>
<a class="br" href="#L374" id="L374">374 </a>				<span class="hid">tag</span> = <span class="hid">tid</span>;
<a class="br" href="#L375" id="L375">375 </a>			}
<a class="br" href="#L376" id="L376">376 </a>
<a class="br" href="#L377" id="L377">377 </a>			<span class="com">/// ditto</span>
<a class="br" href="#L378" id="L378">378 </a>			<span class="kwrd">this</span>()(<span class="kwrd">auto</span> <span class="kwrd">ref</span> <span class="kwrd">immutable</span>(<span class="hid">T</span>) <span class="hid">value</span>) <span class="kwrd">immutable</span>
<a class="br" href="#L379" id="L379">379 </a>			{
<a class="br" href="#L380" id="L380">380 </a>				<span class="hid">storage</span> = () {
<a class="br" href="#L381" id="L381">381 </a>					<span class="kwrd">mixin</span>(<span class="str">&quot;immutable(Storage) newStorage = { &quot;</span>,
<a class="br" href="#L382" id="L382">382 </a>						<span class="hid">Storage.memberName</span>!<span class="hid">T</span>, <span class="str">&quot;: value&quot;</span>,
<a class="br" href="#L383" id="L383">383 </a>					<span class="str">&quot; };&quot;</span>);
<a class="br" href="#L384" id="L384">384 </a>
<a class="br" href="#L385" id="L385">385 </a>					<span class="kwrd">return</span> <span class="hid">newStorage</span>;
<a class="br" href="#L386" id="L386">386 </a>				}();
<a class="br" href="#L387" id="L387">387 </a>
<a class="br" href="#L388" id="L388">388 </a>				<span class="hid">tag</span> = <span class="hid">tid</span>;
<a class="br" href="#L389" id="L389">389 </a>			}
<a class="br" href="#L390" id="L390">390 </a>		} <span class="kwrd">else</span> {
<a class="br" href="#L391" id="L391">391 </a>			@<span class="hid">disable</span> <span class="kwrd">this</span>(<span class="kwrd">const</span>(<span class="hid">T</span>) <span class="hid">value</span>) <span class="kwrd">const</span>;
<a class="br" href="#L392" id="L392">392 </a>			@<span class="hid">disable</span> <span class="kwrd">this</span>(<span class="kwrd">immutable</span>(<span class="hid">T</span>) <span class="hid">value</span>) <span class="kwrd">immutable</span>;
<a class="br" href="#L393" id="L393">393 </a>		}
<a class="br" href="#L394" id="L394">394 </a>	}
<a class="br" href="#L395" id="L395">395 </a>
<a class="br" href="#L396" id="L396">396 </a>	<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="hid">anySatisfy</span>!(<span class="hid">hasElaborateCopyConstructor</span>, <span class="hid">Types</span>)) {
<a class="br" href="#L397" id="L397">397 </a>		<span class="kwrd">private</span> <span class="kwrd">enum</span> <span class="hid">hasPostblit</span>(<span class="hid">T</span>) = <span class="kwrd">__traits</span>(<span class="hid">hasPostblit</span>, <span class="hid">T</span>);
<a class="br" href="#L398" id="L398">398 </a>
<a class="br" href="#L399" id="L399">399 </a>		<span class="kwrd">static</span> <span class="kwrd">if</span> (
<a class="br" href="#L400" id="L400">400 </a>			<span class="hid">allSatisfy</span>!(<span class="hid">isCopyable</span>, <span class="hid">Map</span>!(<span class="hid">InoutOf</span>, <span class="hid">Types</span>))
<a class="br" href="#L401" id="L401">401 </a>			&amp;&amp; !<span class="hid">anySatisfy</span>!(<span class="hid">hasPostblit</span>, <span class="hid">Map</span>!(<span class="hid">InoutOf</span>, <span class="hid">Types</span>))
<a class="br" href="#L402" id="L402">402 </a>		) {
<a class="br" href="#L403" id="L403">403 </a>			<span class="com">/// Constructs a `SumType` that's a copy of another `SumType`.</span>
<a class="br" href="#L404" id="L404">404 </a>			<span class="kwrd">this</span>(<span class="kwrd">ref</span> <span class="kwrd">inout</span>(<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>) <span class="hid">other</span>) <span class="kwrd">inout</span>
<a class="br" href="#L405" id="L405">405 </a>			{
<a class="br" href="#L406" id="L406">406 </a>				<span class="hid">storage</span> = <span class="hid">other.match</span>!((<span class="kwrd">ref</span> <span class="hid">value</span>) {
<a class="br" href="#L407" id="L407">407 </a>					<span class="kwrd">alias</span> <span class="hid">OtherTypes</span> = <span class="hid">Map</span>!(<span class="hid">InoutOf</span>, <span class="hid">Types</span>);
<a class="br" href="#L408" id="L408">408 </a>					<span class="kwrd">enum</span> <span class="hid">tid</span> = <span class="hid">IndexOf</span>!(<span class="kwrd">typeof</span>(<span class="hid">value</span>), <span class="hid">OtherTypes</span>);
<a class="br" href="#L409" id="L409">409 </a>					<span class="kwrd">alias</span> <span class="hid">T</span> = <span class="hid">Types</span>[<span class="hid">tid</span>];
<a class="br" href="#L410" id="L410">410 </a>
<a class="br" href="#L411" id="L411">411 </a>					<span class="kwrd">mixin</span>(<span class="str">&quot;inout(Storage) newStorage = { &quot;</span>,
<a class="br" href="#L412" id="L412">412 </a>						<span class="hid">Storage.memberName</span>!<span class="hid">T</span>, <span class="str">&quot;: value&quot;</span>,
<a class="br" href="#L413" id="L413">413 </a>					<span class="str">&quot; };&quot;</span>);
<a class="br" href="#L414" id="L414">414 </a>
<a class="br" href="#L415" id="L415">415 </a>					<span class="kwrd">return</span> <span class="hid">newStorage</span>;
<a class="br" href="#L416" id="L416">416 </a>				});
<a class="br" href="#L417" id="L417">417 </a>
<a class="br" href="#L418" id="L418">418 </a>				<span class="hid">tag</span> = <span class="hid">other.tag</span>;
<a class="br" href="#L419" id="L419">419 </a>			}
<a class="br" href="#L420" id="L420">420 </a>		} <span class="kwrd">else</span> {
<a class="br" href="#L421" id="L421">421 </a>			<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="hid">allSatisfy</span>!(<span class="hid">isCopyable</span>, <span class="hid">Types</span>)) {
<a class="br" href="#L422" id="L422">422 </a>				<span class="com">/// ditto</span>
<a class="br" href="#L423" id="L423">423 </a>				<span class="kwrd">this</span>(<span class="kwrd">ref</span> <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a> <span class="hid">other</span>)
<a class="br" href="#L424" id="L424">424 </a>				{
<a class="br" href="#L425" id="L425">425 </a>					<span class="hid">storage</span> = <span class="hid">other.match</span>!((<span class="kwrd">ref</span> <span class="hid">value</span>) {
<a class="br" href="#L426" id="L426">426 </a>						<span class="kwrd">alias</span> <span class="hid">T</span> = <span class="kwrd">typeof</span>(<span class="hid">value</span>);
<a class="br" href="#L427" id="L427">427 </a>
<a class="br" href="#L428" id="L428">428 </a>						<span class="kwrd">mixin</span>(<span class="str">&quot;Storage newStorage = { &quot;</span>,
<a class="br" href="#L429" id="L429">429 </a>							<span class="hid">Storage.memberName</span>!<span class="hid">T</span>, <span class="str">&quot;: value&quot;</span>,
<a class="br" href="#L430" id="L430">430 </a>						<span class="str">&quot; };&quot;</span>);
<a class="br" href="#L431" id="L431">431 </a>
<a class="br" href="#L432" id="L432">432 </a>						<span class="kwrd">return</span> <span class="hid">newStorage</span>;
<a class="br" href="#L433" id="L433">433 </a>					});
<a class="br" href="#L434" id="L434">434 </a>
<a class="br" href="#L435" id="L435">435 </a>					<span class="hid">tag</span> = <span class="hid">other.tag</span>;
<a class="br" href="#L436" id="L436">436 </a>				}
<a class="br" href="#L437" id="L437">437 </a>			} <span class="kwrd">else</span> {
<a class="br" href="#L438" id="L438">438 </a>				@<span class="hid">disable</span> <span class="kwrd">this</span>(<span class="kwrd">ref</span> <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a> <span class="hid">other</span>);
<a class="br" href="#L439" id="L439">439 </a>			}
<a class="br" href="#L440" id="L440">440 </a>
<a class="br" href="#L441" id="L441">441 </a>			<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="hid">allSatisfy</span>!(<span class="hid">isCopyable</span>, <span class="hid">Map</span>!(<span class="hid">ConstOf</span>, <span class="hid">Types</span>))) {
<a class="br" href="#L442" id="L442">442 </a>				<span class="com">/// ditto</span>
<a class="br" href="#L443" id="L443">443 </a>				<span class="kwrd">this</span>(<span class="kwrd">ref</span> <span class="kwrd">const</span>(<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>) <span class="hid">other</span>) <span class="kwrd">const</span>
<a class="br" href="#L444" id="L444">444 </a>				{
<a class="br" href="#L445" id="L445">445 </a>					<span class="hid">storage</span> = <span class="hid">other.match</span>!((<span class="kwrd">ref</span> <span class="hid">value</span>) {
<a class="br" href="#L446" id="L446">446 </a>						<span class="kwrd">alias</span> <span class="hid">OtherTypes</span> = <span class="hid">Map</span>!(<span class="hid">ConstOf</span>, <span class="hid">Types</span>);
<a class="br" href="#L447" id="L447">447 </a>						<span class="kwrd">enum</span> <span class="hid">tid</span> = <span class="hid">IndexOf</span>!(<span class="kwrd">typeof</span>(<span class="hid">value</span>), <span class="hid">OtherTypes</span>);
<a class="br" href="#L448" id="L448">448 </a>						<span class="kwrd">alias</span> <span class="hid">T</span> = <span class="hid">Types</span>[<span class="hid">tid</span>];
<a class="br" href="#L449" id="L449">449 </a>
<a class="br" href="#L450" id="L450">450 </a>						<span class="kwrd">mixin</span>(<span class="str">&quot;const(Storage) newStorage = { &quot;</span>,
<a class="br" href="#L451" id="L451">451 </a>							<span class="hid">Storage.memberName</span>!<span class="hid">T</span>, <span class="str">&quot;: value&quot;</span>,
<a class="br" href="#L452" id="L452">452 </a>						<span class="str">&quot; };&quot;</span>);
<a class="br" href="#L453" id="L453">453 </a>
<a class="br" href="#L454" id="L454">454 </a>						<span class="kwrd">return</span> <span class="hid">newStorage</span>;
<a class="br" href="#L455" id="L455">455 </a>					});
<a class="br" href="#L456" id="L456">456 </a>
<a class="br" href="#L457" id="L457">457 </a>					<span class="hid">tag</span> = <span class="hid">other.tag</span>;
<a class="br" href="#L458" id="L458">458 </a>				}
<a class="br" href="#L459" id="L459">459 </a>			} <span class="kwrd">else</span> {
<a class="br" href="#L460" id="L460">460 </a>				@<span class="hid">disable</span> <span class="kwrd">this</span>(<span class="kwrd">ref</span> <span class="kwrd">const</span>(<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>) <span class="hid">other</span>) <span class="kwrd">const</span>;
<a class="br" href="#L461" id="L461">461 </a>			}
<a class="br" href="#L462" id="L462">462 </a>
<a class="br" href="#L463" id="L463">463 </a>			<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="hid">allSatisfy</span>!(<span class="hid">isCopyable</span>, <span class="hid">Map</span>!(<span class="hid">ImmutableOf</span>, <span class="hid">Types</span>))) {
<a class="br" href="#L464" id="L464">464 </a>				<span class="com">/// ditto</span>
<a class="br" href="#L465" id="L465">465 </a>				<span class="kwrd">this</span>(<span class="kwrd">ref</span> <span class="kwrd">immutable</span>(<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>) <span class="hid">other</span>) <span class="kwrd">immutable</span>
<a class="br" href="#L466" id="L466">466 </a>				{
<a class="br" href="#L467" id="L467">467 </a>					<span class="hid">storage</span> = <span class="hid">other.match</span>!((<span class="kwrd">ref</span> <span class="hid">value</span>) {
<a class="br" href="#L468" id="L468">468 </a>						<span class="kwrd">alias</span> <span class="hid">OtherTypes</span> = <span class="hid">Map</span>!(<span class="hid">ImmutableOf</span>, <span class="hid">Types</span>);
<a class="br" href="#L469" id="L469">469 </a>						<span class="kwrd">enum</span> <span class="hid">tid</span> = <span class="hid">IndexOf</span>!(<span class="kwrd">typeof</span>(<span class="hid">value</span>), <span class="hid">OtherTypes</span>);
<a class="br" href="#L470" id="L470">470 </a>						<span class="kwrd">alias</span> <span class="hid">T</span> = <span class="hid">Types</span>[<span class="hid">tid</span>];
<a class="br" href="#L471" id="L471">471 </a>
<a class="br" href="#L472" id="L472">472 </a>						<span class="kwrd">mixin</span>(<span class="str">&quot;immutable(Storage) newStorage = { &quot;</span>,
<a class="br" href="#L473" id="L473">473 </a>							<span class="hid">Storage.memberName</span>!<span class="hid">T</span>, <span class="str">&quot;: value&quot;</span>,
<a class="br" href="#L474" id="L474">474 </a>						<span class="str">&quot; };&quot;</span>);
<a class="br" href="#L475" id="L475">475 </a>
<a class="br" href="#L476" id="L476">476 </a>						<span class="kwrd">return</span> <span class="hid">newStorage</span>;
<a class="br" href="#L477" id="L477">477 </a>					});
<a class="br" href="#L478" id="L478">478 </a>
<a class="br" href="#L479" id="L479">479 </a>					<span class="hid">tag</span> = <span class="hid">other.tag</span>;
<a class="br" href="#L480" id="L480">480 </a>				}
<a class="br" href="#L481" id="L481">481 </a>			} <span class="kwrd">else</span> {
<a class="br" href="#L482" id="L482">482 </a>				@<span class="hid">disable</span> <span class="kwrd">this</span>(<span class="kwrd">ref</span> <span class="kwrd">immutable</span>(<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>) <span class="hid">other</span>) <span class="kwrd">immutable</span>;
<a class="br" href="#L483" id="L483">483 </a>			}
<a class="br" href="#L484" id="L484">484 </a>		}
<a class="br" href="#L485" id="L485">485 </a>	}
<a class="br" href="#L486" id="L486">486 </a>
<a class="br" href="#L487" id="L487">487 </a>	<span class="kwrd">version</span>(<span class="hid">SumTypeNoDefaultCtor</span>) {
<a class="br" href="#L488" id="L488">488 </a>		@<span class="hid">disable</span> <span class="kwrd">this</span>();
<a class="br" href="#L489" id="L489">489 </a>	}
<a class="br" href="#L490" id="L490">490 </a>
<a class="br" href="#L491" id="L491">491 </a>	<span class="kwrd">static</span> <span class="kwrd">foreach</span> (<span class="hid">tid</span>, <span class="hid">T</span>; <span class="hid">Types</span>) {
<a class="br" href="#L492" id="L492">492 </a>		<span class="kwrd">static</span> <span class="kwrd">if</span> (<a class="hid" href="sumtype.d.html#L255" title="sumtype.isAssignableTo">isAssignableTo</a>!<span class="hid">T</span>) {
<a class="br" href="#L493" id="L493">493 </a>			<span class="com">/**
<a class="br" href="#L494" id="L494">494 </a>			 * Assigns a value to a `SumType`.
<a class="br" href="#L495" id="L495">495 </a>			 *
<a class="br" href="#L496" id="L496">496 </a>			 * Assigning to a `SumType` is `@system` if any of the
<a class="br" href="#L497" id="L497">497 </a>			 * `SumType`'s members contain pointers or references, since
<a class="br" href="#L498" id="L498">498 </a>			 * those members may be reachable through external references,
<a class="br" href="#L499" id="L499">499 </a>			 * and overwriting them could therefore lead to memory
<a class="br" href="#L500" id="L500">500 </a>			 * corruption.
<a class="br" href="#L501" id="L501">501 </a>			 *
<a class="br" href="#L502" id="L502">502 </a>			 * An individual assignment can be `@trusted` if the caller can
<a class="br" href="#L503" id="L503">503 </a>			 * guarantee that there are no outstanding references to $(I any)
<a class="br" href="#L504" id="L504">504 </a>			 * of the `SumType`'s members when the assignment occurs.
<a class="br" href="#L505" id="L505">505 </a>			 */</span>
<a class="br" href="#L506" id="L506">506 </a>			<span class="kwrd">ref</span> <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a> <span class="hid">opAssign</span>()(<span class="kwrd">auto</span> <span class="kwrd">ref</span> <span class="hid">T</span> <span class="hid">rhs</span>)
<a class="br" href="#L507" id="L507">507 </a>			{
<a class="br" href="#L508" id="L508">508 </a>				<span class="kwrd">import</span> <span class="hid">core.lifetime</span>: <span class="hid">forward</span>;
<a class="br" href="#L509" id="L509">509 </a>				<span class="kwrd">import</span> <span class="hid">std.traits</span>: <span class="hid">hasIndirections</span>, <span class="hid">hasNested</span>;
<a class="br" href="#L510" id="L510">510 </a>				<span class="kwrd">import</span> <span class="hid">std.meta</span>: <span class="hid">Or</span> = <span class="hid">templateOr</span>;
<a class="br" href="#L511" id="L511">511 </a>
<a class="br" href="#L512" id="L512">512 </a>				<span class="kwrd">enum</span> <span class="hid">mayContainPointers</span> =
<a class="br" href="#L513" id="L513">513 </a>					<span class="hid">anySatisfy</span>!(<span class="hid">Or</span>!(<span class="hid">hasIndirections</span>, <span class="hid">hasNested</span>), <span class="hid">Types</span>);
<a class="br" href="#L514" id="L514">514 </a>
<a class="br" href="#L515" id="L515">515 </a>				<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="hid">mayContainPointers</span>) {
<a class="br" href="#L516" id="L516">516 </a>					<span class="kwrd">cast</span>(<span class="type">void</span>) () @<span class="hid">system</span> {}();
<a class="br" href="#L517" id="L517">517 </a>				}
<a class="br" href="#L518" id="L518">518 </a>
<a class="br" href="#L519" id="L519">519 </a>				<span class="kwrd">this</span>.<a class="hid" href="sumtype.d.html#L1352" title="sumtype.match">match</a>!((<span class="kwrd">ref</span> <span class="hid">value</span>) {
<a class="br" href="#L520" id="L520">520 </a>					<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="hid">hasElaborateDestructor</span>!(<span class="kwrd">typeof</span>(<span class="hid">value</span>))) {
<a class="br" href="#L521" id="L521">521 </a>						<span class="hid">destroy</span>(<span class="hid">value</span>);
<a class="br" href="#L522" id="L522">522 </a>					}
<a class="br" href="#L523" id="L523">523 </a>				});
<a class="br" href="#L524" id="L524">524 </a>
<a class="br" href="#L525" id="L525">525 </a>				<span class="kwrd">mixin</span>(<span class="str">&quot;Storage newStorage = { &quot;</span>,
<a class="br" href="#L526" id="L526">526 </a>					<span class="hid">Storage.memberName</span>!<span class="hid">T</span>, <span class="str">&quot;: forward!rhs&quot;</span>,
<a class="br" href="#L527" id="L527">527 </a>				<span class="str">&quot; };&quot;</span>);
<a class="br" href="#L528" id="L528">528 </a>
<a class="br" href="#L529" id="L529">529 </a>				<span class="hid">storage</span> = <span class="hid">newStorage</span>;
<a class="br" href="#L530" id="L530">530 </a>				<span class="hid">tag</span> = <span class="hid">tid</span>;
<a class="br" href="#L531" id="L531">531 </a>
<a class="br" href="#L532" id="L532">532 </a>				<span class="kwrd">return</span> <span class="kwrd">this</span>;
<a class="br" href="#L533" id="L533">533 </a>			}
<a class="br" href="#L534" id="L534">534 </a>		}
<a class="br" href="#L535" id="L535">535 </a>	}
<a class="br" href="#L536" id="L536">536 </a>
<a class="br" href="#L537" id="L537">537 </a>	<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="hid">allSatisfy</span>!(<a class="hid" href="sumtype.d.html#L255" title="sumtype.isAssignableTo">isAssignableTo</a>, <span class="hid">Types</span>)) {
<a class="br" href="#L538" id="L538">538 </a>		<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="hid">allSatisfy</span>!(<span class="hid">isCopyable</span>, <span class="hid">Types</span>)) {
<a class="br" href="#L539" id="L539">539 </a>			<span class="com">/**
<a class="br" href="#L540" id="L540">540 </a>			 * Copies the value from another `SumType` into this one.
<a class="br" href="#L541" id="L541">541 </a>			 *
<a class="br" href="#L542" id="L542">542 </a>			 * See the value-assignment overload for details on `@safe`ty.
<a class="br" href="#L543" id="L543">543 </a>			 *
<a class="br" href="#L544" id="L544">544 </a>			 * Copy assignment is `@disable`d if any of `Types` is non-copyable.
<a class="br" href="#L545" id="L545">545 </a>			 */</span>
<a class="br" href="#L546" id="L546">546 </a>			<span class="kwrd">ref</span> <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a> <span class="hid">opAssign</span>(<span class="kwrd">ref</span> <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a> <span class="hid">rhs</span>)
<a class="br" href="#L547" id="L547">547 </a>			{
<a class="br" href="#L548" id="L548">548 </a>				<span class="hid">rhs.match</span>!((<span class="kwrd">ref</span> <span class="hid">value</span>) { <span class="kwrd">this</span> = <span class="hid">value</span>; });
<a class="br" href="#L549" id="L549">549 </a>				<span class="kwrd">return</span> <span class="kwrd">this</span>;
<a class="br" href="#L550" id="L550">550 </a>			}
<a class="br" href="#L551" id="L551">551 </a>		} <span class="kwrd">else</span> {
<a class="br" href="#L552" id="L552">552 </a>			@<span class="hid">disable</span> <span class="kwrd">ref</span> <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a> <span class="hid">opAssign</span>(<span class="kwrd">ref</span> <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a> <span class="hid">rhs</span>);
<a class="br" href="#L553" id="L553">553 </a>		}
<a class="br" href="#L554" id="L554">554 </a>
<a class="br" href="#L555" id="L555">555 </a>		<span class="com">/**
<a class="br" href="#L556" id="L556">556 </a>		 * Moves the value from another `SumType` into this one.
<a class="br" href="#L557" id="L557">557 </a>		 *
<a class="br" href="#L558" id="L558">558 </a>		 * See the value-assignment overload for details on `@safe`ty.
<a class="br" href="#L559" id="L559">559 </a>		 */</span>
<a class="br" href="#L560" id="L560">560 </a>		<span class="kwrd">ref</span> <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a> <span class="hid">opAssign</span>(<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a> <span class="hid">rhs</span>)
<a class="br" href="#L561" id="L561">561 </a>		{
<a class="br" href="#L562" id="L562">562 </a>			<span class="kwrd">import</span> <span class="hid">core.lifetime</span>: <span class="hid">move</span>;
<a class="br" href="#L563" id="L563">563 </a>
<a class="br" href="#L564" id="L564">564 </a>			<span class="hid">rhs.match</span>!((<span class="kwrd">ref</span> <span class="hid">value</span>) { <span class="kwrd">this</span> = <span class="hid">move</span>(<span class="hid">value</span>); });
<a class="br" href="#L565" id="L565">565 </a>			<span class="kwrd">return</span> <span class="kwrd">this</span>;
<a class="br" href="#L566" id="L566">566 </a>		}
<a class="br" href="#L567" id="L567">567 </a>	}
<a class="br" href="#L568" id="L568">568 </a>
<a class="br" href="#L569" id="L569">569 </a>	<span class="com">/**
<a class="br" href="#L570" id="L570">570 </a>	 * Compares two `SumType`s for equality.
<a class="br" href="#L571" id="L571">571 </a>	 *
<a class="br" href="#L572" id="L572">572 </a>	 * Two `SumType`s are equal if they are the same kind of `SumType`, they
<a class="br" href="#L573" id="L573">573 </a>	 * contain values of the same type, and those values are equal.
<a class="br" href="#L574" id="L574">574 </a>	 */</span>
<a class="br" href="#L575" id="L575">575 </a>	<span class="type">bool</span> <span class="hid">opEquals</span>(<span class="kwrd">this</span> <a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>, <span class="hid">Rhs</span>)(<span class="kwrd">auto</span> <span class="kwrd">ref</span> <span class="hid">Rhs</span> <span class="hid">rhs</span>)
<a class="br" href="#L576" id="L576">576 </a>		<span class="kwrd">if</span> (<span class="kwrd">is</span>(<span class="hid">CommonType</span>!(<a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>, <span class="hid">Rhs</span>)))
<a class="br" href="#L577" id="L577">577 </a>	{
<a class="br" href="#L578" id="L578">578 </a>		<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="kwrd">is</span>(<a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a> == <span class="hid">Rhs</span>)) {
<a class="br" href="#L579" id="L579">579 </a>			<span class="kwrd">return</span> <span class="hid">AliasSeq</span>!(<span class="kwrd">this</span>, <span class="hid">rhs</span>).<a class="hid" href="sumtype.d.html#L1352" title="sumtype.match">match</a>!((<span class="kwrd">ref</span> <span class="hid">value</span>, <span class="kwrd">ref</span> <span class="hid">rhsValue</span>) {
<a class="br" href="#L580" id="L580">580 </a>				<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="kwrd">is</span>(<span class="kwrd">typeof</span>(<span class="hid">value</span>) == <span class="kwrd">typeof</span>(<span class="hid">rhsValue</span>))) {
<a class="br" href="#L581" id="L581">581 </a>					<span class="kwrd">return</span> <span class="hid">value</span> == <span class="hid">rhsValue</span>;
<a class="br" href="#L582" id="L582">582 </a>				} <span class="kwrd">else</span> {
<a class="br" href="#L583" id="L583">583 </a>					<span class="kwrd">return</span> <span class="kwrd">false</span>;
<a class="br" href="#L584" id="L584">584 </a>				}
<a class="br" href="#L585" id="L585">585 </a>			});
<a class="br" href="#L586" id="L586">586 </a>		} <span class="kwrd">else</span> {
<a class="br" href="#L587" id="L587">587 </a>			<span class="kwrd">alias</span> <span class="hid">CommonSumType</span> = <span class="hid">CommonType</span>!(<a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>, <span class="hid">Rhs</span>);
<a class="br" href="#L588" id="L588">588 </a>			<span class="kwrd">return</span> <span class="kwrd">cast</span>(<span class="hid">CommonSumType</span>) <span class="kwrd">this</span> == <span class="kwrd">cast</span>(<span class="hid">CommonSumType</span>) <span class="hid">rhs</span>;
<a class="br" href="#L589" id="L589">589 </a>		}
<a class="br" href="#L590" id="L590">590 </a>	}
<a class="br" href="#L591" id="L591">591 </a>
<a class="br" href="#L592" id="L592">592 </a>	<span class="com">// Workaround for dlang issue 19407</span>
<a class="br" href="#L593" id="L593">593 </a>	<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">anySatisfy</span>!(<span class="hid">hasElaborateDestructor</span>, <span class="hid">Types</span>))) {
<a class="br" href="#L594" id="L594">594 </a>		<span class="com">// If possible, include the destructor only when it's needed</span>
<a class="br" href="#L595" id="L595">595 </a>		<span class="kwrd">private</span> <span class="kwrd">enum</span> <span class="hid">includeDtor</span> = <span class="hid">anySatisfy</span>!(<span class="hid">hasElaborateDestructor</span>, <span class="hid">Types</span>);
<a class="br" href="#L596" id="L596">596 </a>	} <span class="kwrd">else</span> {
<a class="br" href="#L597" id="L597">597 </a>		<span class="com">// If we can't tell, always include it, even when it does nothing</span>
<a class="br" href="#L598" id="L598">598 </a>		<span class="kwrd">private</span> <span class="kwrd">enum</span> <span class="hid">includeDtor</span> = <span class="kwrd">true</span>;
<a class="br" href="#L599" id="L599">599 </a>	}
<a class="br" href="#L600" id="L600">600 </a>
<a class="br" href="#L601" id="L601">601 </a>	<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="hid">includeDtor</span>) {
<a class="br" href="#L602" id="L602">602 </a>		<span class="com">/// Calls the destructor of the `SumType`'s current value.</span>
<a class="br" href="#L603" id="L603">603 </a>		~<span class="kwrd">this</span>()
<a class="br" href="#L604" id="L604">604 </a>		{
<a class="br" href="#L605" id="L605">605 </a>			<span class="kwrd">this</span>.<a class="hid" href="sumtype.d.html#L1352" title="sumtype.match">match</a>!((<span class="kwrd">ref</span> <span class="hid">value</span>) {
<a class="br" href="#L606" id="L606">606 </a>				<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="hid">hasElaborateDestructor</span>!(<span class="kwrd">typeof</span>(<span class="hid">value</span>))) {
<a class="br" href="#L607" id="L607">607 </a>					<span class="hid">destroy</span>(<span class="hid">value</span>);
<a class="br" href="#L608" id="L608">608 </a>				}
<a class="br" href="#L609" id="L609">609 </a>			});
<a class="br" href="#L610" id="L610">610 </a>		}
<a class="br" href="#L611" id="L611">611 </a>	}
<a class="br" href="#L612" id="L612">612 </a>
<a class="br" href="#L613" id="L613">613 </a>	<span class="kwrd">invariant</span> {
<a class="br" href="#L614" id="L614">614 </a>		<span class="kwrd">this</span>.<a class="hid" href="sumtype.d.html#L1352" title="sumtype.match">match</a>!((<span class="kwrd">ref</span> <span class="hid">value</span>) {
<a class="br" href="#L615" id="L615">615 </a>			<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="kwrd">is</span>(<span class="kwrd">typeof</span>(<span class="hid">value</span>) == <span class="kwrd">class</span>)) {
<a class="br" href="#L616" id="L616">616 </a>				<span class="kwrd">if</span> (<span class="hid">value</span> !<span class="kwrd">is</span> <span class="kwrd">null</span>) {
<a class="br" href="#L617" id="L617">617 </a>					<span class="kwrd">assert</span>(<span class="hid">value</span>);
<a class="br" href="#L618" id="L618">618 </a>				}
<a class="br" href="#L619" id="L619">619 </a>			} <span class="kwrd">else</span> <span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="kwrd">is</span>(<span class="kwrd">typeof</span>(<span class="hid">value</span>) == <span class="kwrd">struct</span>)) {
<a class="br" href="#L620" id="L620">620 </a>				<span class="kwrd">assert</span>(&amp;<span class="hid">value</span>);
<a class="br" href="#L621" id="L621">621 </a>			}
<a class="br" href="#L622" id="L622">622 </a>		});
<a class="br" href="#L623" id="L623">623 </a>	}
<a class="br" href="#L624" id="L624">624 </a>
<a class="br" href="#L625" id="L625">625 </a>	<span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L626" id="L626">626 </a>	<span class="com">/**
<a class="br" href="#L627" id="L627">627 </a>	 * Returns a string representation of the `SumType`'s current value.
<a class="br" href="#L628" id="L628">628 </a>	 *
<a class="br" href="#L629" id="L629">629 </a>	 * Not available when compiled with `-betterC`.
<a class="br" href="#L630" id="L630">630 </a>	 */</span>
<a class="br" href="#L631" id="L631">631 </a>	<span class="type">string</span> <span class="hid">toString</span>(<span class="kwrd">this</span> <span class="hid">T</span>)()
<a class="br" href="#L632" id="L632">632 </a>	{
<a class="br" href="#L633" id="L633">633 </a>		<span class="kwrd">import</span> <span class="hid">std.conv</span>: <span class="hid">to</span>;
<a class="br" href="#L634" id="L634">634 </a>
<a class="br" href="#L635" id="L635">635 </a>		<span class="kwrd">return</span> <span class="kwrd">this</span>.<a class="hid" href="sumtype.d.html#L1352" title="sumtype.match">match</a>!(<span class="hid">to</span>!<span class="type">string</span>);
<a class="br" href="#L636" id="L636">636 </a>	}
<a class="br" href="#L637" id="L637">637 </a>
<a class="br" href="#L638" id="L638">638 </a>	<span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L639" id="L639">639 </a>	<span class="com">/**
<a class="br" href="#L640" id="L640">640 </a>	 * Handles formatted writing of the `SumType`'s current value.
<a class="br" href="#L641" id="L641">641 </a>	 *
<a class="br" href="#L642" id="L642">642 </a>	 * Not available when compiled with `-betterC`.
<a class="br" href="#L643" id="L643">643 </a>	 *
<a class="br" href="#L644" id="L644">644 </a>	 * Params:
<a class="br" href="#L645" id="L645">645 </a>	 *   sink = Output range to write to.
<a class="br" href="#L646" id="L646">646 </a>	 *   fmt = Format specifier to use.
<a class="br" href="#L647" id="L647">647 </a>	 *
<a class="br" href="#L648" id="L648">648 </a>	 * See_Also: `std.format.formatValue`
<a class="br" href="#L649" id="L649">649 </a>	 */</span>
<a class="br" href="#L650" id="L650">650 </a>	<span class="type">void</span> <span class="hid">toString</span>(<span class="kwrd">this</span> <a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>, <span class="hid">Sink</span>, <span class="hid">Char</span>)(<span class="kwrd">ref</span> <span class="hid">Sink</span> <span class="hid">sink</span>, <span class="kwrd">const</span> <span class="kwrd">ref</span> <span class="hid">FormatSpec</span>!<span class="hid">Char</span> <span class="hid">fmt</span>)
<a class="br" href="#L651" id="L651">651 </a>	{
<a class="br" href="#L652" id="L652">652 </a>		<span class="kwrd">import</span> <span class="hid">std.format</span>: <span class="hid">formatValue</span>;
<a class="br" href="#L653" id="L653">653 </a>
<a class="br" href="#L654" id="L654">654 </a>		<span class="kwrd">this</span>.<a class="hid" href="sumtype.d.html#L1352" title="sumtype.match">match</a>!((<span class="kwrd">ref</span> <span class="hid">value</span>) {
<a class="br" href="#L655" id="L655">655 </a>			<span class="hid">formatValue</span>(<span class="hid">sink</span>, <span class="hid">value</span>, <span class="hid">fmt</span>);
<a class="br" href="#L656" id="L656">656 </a>		});
<a class="br" href="#L657" id="L657">657 </a>	}
<a class="br" href="#L658" id="L658">658 </a>
<a class="br" href="#L659" id="L659">659 </a>	<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="hid">allSatisfy</span>!(<a class="hid" href="sumtype.d.html#L259" title="sumtype.isHashable">isHashable</a>, <span class="hid">Map</span>!(<span class="hid">ConstOf</span>, <span class="hid">Types</span>))) {
<a class="br" href="#L660" id="L660">660 </a>		<span class="com">// Workaround for dlang issue 20095</span>
<a class="br" href="#L661" id="L661">661 </a>		<span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L662" id="L662">662 </a>		<span class="com">/**
<a class="br" href="#L663" id="L663">663 </a>		 * Returns the hash of the `SumType`'s current value.
<a class="br" href="#L664" id="L664">664 </a>		 *
<a class="br" href="#L665" id="L665">665 </a>		 * Not available when compiled with `-betterC`.
<a class="br" href="#L666" id="L666">666 </a>		 */</span>
<a class="br" href="#L667" id="L667">667 </a>		<span class="hid">size_t</span> <span class="hid">toHash</span>() <span class="kwrd">const</span>
<a class="br" href="#L668" id="L668">668 </a>		{
<a class="br" href="#L669" id="L669">669 </a>			<span class="kwrd">return</span> <span class="kwrd">this</span>.<a class="hid" href="sumtype.d.html#L1352" title="sumtype.match">match</a>!<span class="hid">hashOf</span>;
<a class="br" href="#L670" id="L670">670 </a>		}
<a class="br" href="#L671" id="L671">671 </a>	}
<a class="br" href="#L672" id="L672">672 </a>}
<a class="br" href="#L673" id="L673">673 </a>
<a class="br" href="#L674" id="L674">674 </a><span class="com">// Construction</span>
<a class="br" href="#L675" id="L675">675 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L676" id="L676">676 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>);
<a class="br" href="#L677" id="L677">677 </a>
<a class="br" href="#L678" id="L678">678 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">MySum</span>(<span class="num">42</span>)));
<a class="br" href="#L679" id="L679">679 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">MySum</span>(<span class="num">3.14</span>)));
<a class="br" href="#L680" id="L680">680 </a>}
<a class="br" href="#L681" id="L681">681 </a>
<a class="br" href="#L682" id="L682">682 </a><span class="com">// Assignment</span>
<a class="br" href="#L683" id="L683">683 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L684" id="L684">684 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>);
<a class="br" href="#L685" id="L685">685 </a>
<a class="br" href="#L686" id="L686">686 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">MySum</span>(<span class="num">42</span>);
<a class="br" href="#L687" id="L687">687 </a>
<a class="br" href="#L688" id="L688">688 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">x</span> = <span class="num">3.14</span>));
<a class="br" href="#L689" id="L689">689 </a>}
<a class="br" href="#L690" id="L690">690 </a>
<a class="br" href="#L691" id="L691">691 </a><span class="com">// Self assignment</span>
<a class="br" href="#L692" id="L692">692 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L693" id="L693">693 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>);
<a class="br" href="#L694" id="L694">694 </a>
<a class="br" href="#L695" id="L695">695 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">MySum</span>(<span class="num">42</span>);
<a class="br" href="#L696" id="L696">696 </a>	<span class="hid">MySum</span> <span class="hid">y</span> = <span class="hid">MySum</span>(<span class="num">3.14</span>);
<a class="br" href="#L697" id="L697">697 </a>
<a class="br" href="#L698" id="L698">698 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">y</span> = <span class="hid">x</span>));
<a class="br" href="#L699" id="L699">699 </a>}
<a class="br" href="#L700" id="L700">700 </a>
<a class="br" href="#L701" id="L701">701 </a><span class="com">// Equality</span>
<a class="br" href="#L702" id="L702">702 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L703" id="L703">703 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>);
<a class="br" href="#L704" id="L704">704 </a>
<a class="br" href="#L705" id="L705">705 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">MySum</span>(<span class="num">123</span>);
<a class="br" href="#L706" id="L706">706 </a>	<span class="hid">MySum</span> <span class="hid">y</span> = <span class="hid">MySum</span>(<span class="num">123</span>);
<a class="br" href="#L707" id="L707">707 </a>	<span class="hid">MySum</span> <span class="hid">z</span> = <span class="hid">MySum</span>(<span class="num">456</span>);
<a class="br" href="#L708" id="L708">708 </a>	<span class="hid">MySum</span> <span class="hid">w</span> = <span class="hid">MySum</span>(<span class="num">123.0</span>);
<a class="br" href="#L709" id="L709">709 </a>	<span class="hid">MySum</span> <span class="hid">v</span> = <span class="hid">MySum</span>(<span class="num">456.0</span>);
<a class="br" href="#L710" id="L710">710 </a>
<a class="br" href="#L711" id="L711">711 </a>	<span class="kwrd">assert</span>(<span class="hid">x</span> == <span class="hid">y</span>);
<a class="br" href="#L712" id="L712">712 </a>	<span class="kwrd">assert</span>(<span class="hid">x</span> != <span class="hid">z</span>);
<a class="br" href="#L713" id="L713">713 </a>	<span class="kwrd">assert</span>(<span class="hid">x</span> != <span class="hid">w</span>);
<a class="br" href="#L714" id="L714">714 </a>	<span class="kwrd">assert</span>(<span class="hid">x</span> != <span class="hid">v</span>);
<a class="br" href="#L715" id="L715">715 </a>
<a class="br" href="#L716" id="L716">716 </a>}
<a class="br" href="#L717" id="L717">717 </a>
<a class="br" href="#L718" id="L718">718 </a><span class="com">// Equality of differently-qualified SumTypes</span>
<a class="br" href="#L719" id="L719">719 </a><span class="kwrd">version</span>(<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L720" id="L720">720 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L721" id="L721">721 </a>	<span class="kwrd">alias</span> <span class="hid">SumA</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>);
<a class="br" href="#L722" id="L722">722 </a>	<span class="kwrd">alias</span> <span class="hid">SumB</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="kwrd">const</span>(<span class="type">int</span>[]), <span class="type">int</span>[]);
<a class="br" href="#L723" id="L723">723 </a>	<span class="kwrd">alias</span> <span class="hid">SumC</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>[], <span class="kwrd">const</span>(<span class="type">int</span>[]));
<a class="br" href="#L724" id="L724">724 </a>
<a class="br" href="#L725" id="L725">725 </a>	<span class="type">int</span>[] <span class="hid">ma</span> = [<span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>];
<a class="br" href="#L726" id="L726">726 </a>	<span class="kwrd">const</span>(<span class="type">int</span>[]) <span class="hid">ca</span> = [<span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>];
<a class="br" href="#L727" id="L727">727 </a>
<a class="br" href="#L728" id="L728">728 </a>	<span class="kwrd">assert</span>(<span class="kwrd">const</span>(<span class="hid">SumA</span>)(<span class="num">123</span>) == <span class="hid">SumA</span>(<span class="num">123</span>));
<a class="br" href="#L729" id="L729">729 </a>	<span class="kwrd">assert</span>(<span class="kwrd">const</span>(<span class="hid">SumB</span>)(<span class="hid">ma</span>[]) == <span class="hid">SumB</span>(<span class="hid">ca</span>[]));
<a class="br" href="#L730" id="L730">730 </a>	<span class="kwrd">assert</span>(<span class="kwrd">const</span>(<span class="hid">SumC</span>)(<span class="hid">ma</span>[]) == <span class="hid">SumC</span>(<span class="hid">ca</span>[]));
<a class="br" href="#L731" id="L731">731 </a>}
<a class="br" href="#L732" id="L732">732 </a>
<a class="br" href="#L733" id="L733">733 </a><span class="com">// Imported types</span>
<a class="br" href="#L734" id="L734">734 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L735" id="L735">735 </a>	<span class="kwrd">import</span> <span class="hid">std.typecons</span>: <span class="hid">Tuple</span>;
<a class="br" href="#L736" id="L736">736 </a>
<a class="br" href="#L737" id="L737">737 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, {
<a class="br" href="#L738" id="L738">738 </a>		<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">Tuple</span>!(<span class="type">int</span>, <span class="type">int</span>));
<a class="br" href="#L739" id="L739">739 </a>	}));
<a class="br" href="#L740" id="L740">740 </a>}
<a class="br" href="#L741" id="L741">741 </a>
<a class="br" href="#L742" id="L742">742 </a><span class="com">// const and immutable types</span>
<a class="br" href="#L743" id="L743">743 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L744" id="L744">744 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, {
<a class="br" href="#L745" id="L745">745 </a>		<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="kwrd">const</span>(<span class="type">int</span>[]), <span class="kwrd">immutable</span>(<span class="type">float</span>[]));
<a class="br" href="#L746" id="L746">746 </a>	}));
<a class="br" href="#L747" id="L747">747 </a>}
<a class="br" href="#L748" id="L748">748 </a>
<a class="br" href="#L749" id="L749">749 </a><span class="com">// Recursive types</span>
<a class="br" href="#L750" id="L750">750 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L751" id="L751">751 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>*);
<a class="br" href="#L752" id="L752">752 </a>	<span class="kwrd">assert</span>(<span class="kwrd">is</span>(<span class="hid">MySum.Types</span>[<span class="num">0</span>] == <span class="hid">MySum</span>*));
<a class="br" href="#L753" id="L753">753 </a>}
<a class="br" href="#L754" id="L754">754 </a>
<a class="br" href="#L755" id="L755">755 </a><span class="com">// Allowed types</span>
<a class="br" href="#L756" id="L756">756 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L757" id="L757">757 </a>	<span class="kwrd">import</span> <span class="hid">std.meta</span>: <span class="hid">AliasSeq</span>;
<a class="br" href="#L758" id="L758">758 </a>
<a class="br" href="#L759" id="L759">759 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>, <a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>*);
<a class="br" href="#L760" id="L760">760 </a>
<a class="br" href="#L761" id="L761">761 </a>	<span class="kwrd">assert</span>(<span class="kwrd">is</span>(<span class="hid">MySum.Types</span> == <span class="hid">AliasSeq</span>!(<span class="type">int</span>, <span class="type">float</span>, <span class="hid">MySum</span>*)));
<a class="br" href="#L762" id="L762">762 </a>}
<a class="br" href="#L763" id="L763">763 </a>
<a class="br" href="#L764" id="L764">764 </a><span class="com">// Types with destructors and postblits</span>
<a class="br" href="#L765" id="L765">765 </a>@<span class="hid">system</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L766" id="L766">766 </a>	<span class="type">int</span> <span class="hid">copies</span>;
<a class="br" href="#L767" id="L767">767 </a>
<a class="br" href="#L768" id="L768">768 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">Test</span>
<a class="br" href="#L769" id="L769">769 </a>	{
<a class="br" href="#L770" id="L770">770 </a>		<span class="type">bool</span> <span class="hid">initialized</span> = <span class="kwrd">false</span>;
<a class="br" href="#L771" id="L771">771 </a>		<span class="type">int</span>* <span class="hid">copiesPtr</span>;
<a class="br" href="#L772" id="L772">772 </a>
<a class="br" href="#L773" id="L773">773 </a>		<span class="kwrd">this</span>(<span class="kwrd">this</span>) { (*<span class="hid">copiesPtr</span>)++; }
<a class="br" href="#L774" id="L774">774 </a>		~<span class="kwrd">this</span>() { <span class="kwrd">if</span> (<span class="hid">initialized</span>) (*<span class="hid">copiesPtr</span>)--; }
<a class="br" href="#L775" id="L775">775 </a>	}
<a class="br" href="#L776" id="L776">776 </a>
<a class="br" href="#L777" id="L777">777 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="hid">Test</span>);
<a class="br" href="#L778" id="L778">778 </a>
<a class="br" href="#L779" id="L779">779 </a>	<span class="hid">Test</span> <span class="hid">t</span> = <span class="hid">Test</span>(<span class="kwrd">true</span>, &amp;<span class="hid">copies</span>);
<a class="br" href="#L780" id="L780">780 </a>
<a class="br" href="#L781" id="L781">781 </a>	{
<a class="br" href="#L782" id="L782">782 </a>		<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">t</span>;
<a class="br" href="#L783" id="L783">783 </a>		<span class="kwrd">assert</span>(<span class="hid">copies</span> == <span class="num">1</span>);
<a class="br" href="#L784" id="L784">784 </a>	}
<a class="br" href="#L785" id="L785">785 </a>	<span class="kwrd">assert</span>(<span class="hid">copies</span> == <span class="num">0</span>);
<a class="br" href="#L786" id="L786">786 </a>
<a class="br" href="#L787" id="L787">787 </a>	{
<a class="br" href="#L788" id="L788">788 </a>		<span class="hid">MySum</span> <span class="hid">x</span> = <span class="num">456</span>;
<a class="br" href="#L789" id="L789">789 </a>		<span class="kwrd">assert</span>(<span class="hid">copies</span> == <span class="num">0</span>);
<a class="br" href="#L790" id="L790">790 </a>	}
<a class="br" href="#L791" id="L791">791 </a>	<span class="kwrd">assert</span>(<span class="hid">copies</span> == <span class="num">0</span>);
<a class="br" href="#L792" id="L792">792 </a>
<a class="br" href="#L793" id="L793">793 </a>	{
<a class="br" href="#L794" id="L794">794 </a>		<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">t</span>;
<a class="br" href="#L795" id="L795">795 </a>		<span class="kwrd">assert</span>(<span class="hid">copies</span> == <span class="num">1</span>);
<a class="br" href="#L796" id="L796">796 </a>		<span class="hid">x</span> = <span class="num">456</span>;
<a class="br" href="#L797" id="L797">797 </a>		<span class="kwrd">assert</span>(<span class="hid">copies</span> == <span class="num">0</span>);
<a class="br" href="#L798" id="L798">798 </a>	}
<a class="br" href="#L799" id="L799">799 </a>
<a class="br" href="#L800" id="L800">800 </a>	{
<a class="br" href="#L801" id="L801">801 </a>		<span class="hid">MySum</span> <span class="hid">x</span> = <span class="num">456</span>;
<a class="br" href="#L802" id="L802">802 </a>		<span class="kwrd">assert</span>(<span class="hid">copies</span> == <span class="num">0</span>);
<a class="br" href="#L803" id="L803">803 </a>		<span class="hid">x</span> = <span class="hid">t</span>;
<a class="br" href="#L804" id="L804">804 </a>		<span class="kwrd">assert</span>(<span class="hid">copies</span> == <span class="num">1</span>);
<a class="br" href="#L805" id="L805">805 </a>	}
<a class="br" href="#L806" id="L806">806 </a>
<a class="br" href="#L807" id="L807">807 </a>	{
<a class="br" href="#L808" id="L808">808 </a>		<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">t</span>;
<a class="br" href="#L809" id="L809">809 </a>		<span class="hid">MySum</span> <span class="hid">y</span> = <span class="hid">x</span>;
<a class="br" href="#L810" id="L810">810 </a>		<span class="kwrd">assert</span>(<span class="hid">copies</span> == <span class="num">2</span>);
<a class="br" href="#L811" id="L811">811 </a>	}
<a class="br" href="#L812" id="L812">812 </a>
<a class="br" href="#L813" id="L813">813 </a>	{
<a class="br" href="#L814" id="L814">814 </a>		<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">t</span>;
<a class="br" href="#L815" id="L815">815 </a>		<span class="hid">MySum</span> <span class="hid">y</span>;
<a class="br" href="#L816" id="L816">816 </a>		<span class="hid">y</span> = <span class="hid">x</span>;
<a class="br" href="#L817" id="L817">817 </a>		<span class="kwrd">assert</span>(<span class="hid">copies</span> == <span class="num">2</span>);
<a class="br" href="#L818" id="L818">818 </a>	}
<a class="br" href="#L819" id="L819">819 </a>}
<a class="br" href="#L820" id="L820">820 </a>
<a class="br" href="#L821" id="L821">821 </a><span class="com">// Doesn't destroy reference types</span>
<a class="br" href="#L822" id="L822">822 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L823" id="L823">823 </a>@<span class="hid">system</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L824" id="L824">824 </a>	<span class="type">bool</span> <span class="hid">destroyed</span>;
<a class="br" href="#L825" id="L825">825 </a>
<a class="br" href="#L826" id="L826">826 </a>	<span class="kwrd">class</span> <span class="hid">C</span>
<a class="br" href="#L827" id="L827">827 </a>	{
<a class="br" href="#L828" id="L828">828 </a>		~<span class="kwrd">this</span>()
<a class="br" href="#L829" id="L829">829 </a>		{
<a class="br" href="#L830" id="L830">830 </a>			<span class="hid">destroyed</span> = <span class="kwrd">true</span>;
<a class="br" href="#L831" id="L831">831 </a>		}
<a class="br" href="#L832" id="L832">832 </a>	}
<a class="br" href="#L833" id="L833">833 </a>
<a class="br" href="#L834" id="L834">834 </a>	<span class="kwrd">struct</span> <span class="hid">S</span>
<a class="br" href="#L835" id="L835">835 </a>	{
<a class="br" href="#L836" id="L836">836 </a>		~<span class="kwrd">this</span>() {}
<a class="br" href="#L837" id="L837">837 </a>	}
<a class="br" href="#L838" id="L838">838 </a>
<a class="br" href="#L839" id="L839">839 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">S</span>, <span class="hid">C</span>);
<a class="br" href="#L840" id="L840">840 </a>
<a class="br" href="#L841" id="L841">841 </a>	<span class="hid">C</span> <span class="hid">c</span> = <span class="kwrd">new</span> <span class="hid">C</span>();
<a class="br" href="#L842" id="L842">842 </a>	{
<a class="br" href="#L843" id="L843">843 </a>		<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">c</span>;
<a class="br" href="#L844" id="L844">844 </a>		<span class="hid">destroyed</span> = <span class="kwrd">false</span>;
<a class="br" href="#L845" id="L845">845 </a>	}
<a class="br" href="#L846" id="L846">846 </a>	<span class="kwrd">assert</span>(!<span class="hid">destroyed</span>);
<a class="br" href="#L847" id="L847">847 </a>
<a class="br" href="#L848" id="L848">848 </a>	{
<a class="br" href="#L849" id="L849">849 </a>		<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">c</span>;
<a class="br" href="#L850" id="L850">850 </a>		<span class="hid">destroyed</span> = <span class="kwrd">false</span>;
<a class="br" href="#L851" id="L851">851 </a>		<span class="hid">x</span> = <span class="hid">S</span>();
<a class="br" href="#L852" id="L852">852 </a>		<span class="kwrd">assert</span>(!<span class="hid">destroyed</span>);
<a class="br" href="#L853" id="L853">853 </a>	}
<a class="br" href="#L854" id="L854">854 </a>}
<a class="br" href="#L855" id="L855">855 </a>
<a class="br" href="#L856" id="L856">856 </a><span class="com">// Types with @disable this()</span>
<a class="br" href="#L857" id="L857">857 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L858" id="L858">858 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">NoInit</span>
<a class="br" href="#L859" id="L859">859 </a>	{
<a class="br" href="#L860" id="L860">860 </a>		@<span class="hid">disable</span> <span class="kwrd">this</span>();
<a class="br" href="#L861" id="L861">861 </a>	}
<a class="br" href="#L862" id="L862">862 </a>
<a class="br" href="#L863" id="L863">863 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">NoInit</span>, <span class="type">int</span>);
<a class="br" href="#L864" id="L864">864 </a>
<a class="br" href="#L865" id="L865">865 </a>	<span class="kwrd">assert</span>(!<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">MySum</span>()));
<a class="br" href="#L866" id="L866">866 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">MySum</span>(<span class="num">42</span>)));
<a class="br" href="#L867" id="L867">867 </a>	<span class="kwrd">auto</span> <span class="hid">x</span> = <span class="hid">MySum</span>(<span class="num">42</span>);
<a class="br" href="#L868" id="L868">868 </a>}
<a class="br" href="#L869" id="L869">869 </a>
<a class="br" href="#L870" id="L870">870 </a><span class="com">// const SumTypes</span>
<a class="br" href="#L871" id="L871">871 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L872" id="L872">872 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>,
<a class="br" href="#L873" id="L873">873 </a>		<span class="kwrd">const</span>(<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>[]))([<span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>])
<a class="br" href="#L874" id="L874">874 </a>	));
<a class="br" href="#L875" id="L875">875 </a>}
<a class="br" href="#L876" id="L876">876 </a>
<a class="br" href="#L877" id="L877">877 </a><span class="com">// Equality of const SumTypes</span>
<a class="br" href="#L878" id="L878">878 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L879" id="L879">879 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="type">int</span>;
<a class="br" href="#L880" id="L880">880 </a>
<a class="br" href="#L881" id="L881">881 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>,
<a class="br" href="#L882" id="L882">882 </a>		<span class="kwrd">const</span>(<span class="hid">MySum</span>)(<span class="num">123</span>) == <span class="kwrd">const</span>(<span class="hid">MySum</span>)(<span class="num">456</span>)
<a class="br" href="#L883" id="L883">883 </a>	));
<a class="br" href="#L884" id="L884">884 </a>}
<a class="br" href="#L885" id="L885">885 </a>
<a class="br" href="#L886" id="L886">886 </a><span class="com">// Compares reference types using value equality</span>
<a class="br" href="#L887" id="L887">887 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L888" id="L888">888 </a>	<span class="kwrd">import</span> <span class="hid">std.array</span>: <span class="hid">staticArray</span>;
<a class="br" href="#L889" id="L889">889 </a>
<a class="br" href="#L890" id="L890">890 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">Field</span> {}
<a class="br" href="#L891" id="L891">891 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">Struct</span> { <span class="hid">Field</span>[] <span class="hid">fields</span>; }
<a class="br" href="#L892" id="L892">892 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">Struct</span>;
<a class="br" href="#L893" id="L893">893 </a>
<a class="br" href="#L894" id="L894">894 </a>	<span class="kwrd">static</span> <span class="hid">arr1</span> = <span class="hid">staticArray</span>([<span class="hid">Field</span>()]);
<a class="br" href="#L895" id="L895">895 </a>	<span class="kwrd">static</span> <span class="hid">arr2</span> = <span class="hid">staticArray</span>([<span class="hid">Field</span>()]);
<a class="br" href="#L896" id="L896">896 </a>
<a class="br" href="#L897" id="L897">897 </a>	<span class="kwrd">auto</span> <span class="hid">a</span> = <span class="hid">MySum</span>(<span class="hid">Struct</span>(<span class="hid">arr1</span>[]));
<a class="br" href="#L898" id="L898">898 </a>	<span class="kwrd">auto</span> <span class="hid">b</span> = <span class="hid">MySum</span>(<span class="hid">Struct</span>(<span class="hid">arr2</span>[]));
<a class="br" href="#L899" id="L899">899 </a>
<a class="br" href="#L900" id="L900">900 </a>	<span class="kwrd">assert</span>(<span class="hid">a</span> == <span class="hid">b</span>);
<a class="br" href="#L901" id="L901">901 </a>}
<a class="br" href="#L902" id="L902">902 </a>
<a class="br" href="#L903" id="L903">903 </a><span class="com">// toString</span>
<a class="br" href="#L904" id="L904">904 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L905" id="L905">905 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L906" id="L906">906 </a>	<span class="kwrd">import</span> <span class="hid">std.conv</span>: <span class="hid">text</span>;
<a class="br" href="#L907" id="L907">907 </a>
<a class="br" href="#L908" id="L908">908 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">Int</span> { <span class="type">int</span> <span class="hid">i</span>; }
<a class="br" href="#L909" id="L909">909 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">Double</span> { <span class="type">double</span> <span class="hid">d</span>; }
<a class="br" href="#L910" id="L910">910 </a>	<span class="kwrd">alias</span> <span class="hid">Sum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">Int</span>, <span class="hid">Double</span>);
<a class="br" href="#L911" id="L911">911 </a>
<a class="br" href="#L912" id="L912">912 </a>	<span class="kwrd">assert</span>(<span class="hid">Sum</span>(<span class="hid">Int</span>(<span class="num">42</span>)).<span class="hid">text</span> == <span class="hid">Int</span>(<span class="num">42</span>).<span class="hid">text</span>, <span class="hid">Sum</span>(<span class="hid">Int</span>(<span class="num">42</span>)).<span class="hid">text</span>);
<a class="br" href="#L913" id="L913">913 </a>	<span class="kwrd">assert</span>(<span class="hid">Sum</span>(<span class="hid">Double</span>(<span class="num">33.3</span>)).<span class="hid">text</span> == <span class="hid">Double</span>(<span class="num">33.3</span>).<span class="hid">text</span>, <span class="hid">Sum</span>(<span class="hid">Double</span>(<span class="num">33.3</span>)).<span class="hid">text</span>);
<a class="br" href="#L914" id="L914">914 </a>	<span class="kwrd">assert</span>((<span class="kwrd">const</span>(<span class="hid">Sum</span>)(<span class="hid">Int</span>(<span class="num">42</span>))).<span class="hid">text</span> == (<span class="kwrd">const</span>(<span class="hid">Int</span>)(<span class="num">42</span>)).<span class="hid">text</span>, (<span class="kwrd">const</span>(<span class="hid">Sum</span>)(<span class="hid">Int</span>(<span class="num">42</span>))).<span class="hid">text</span>);
<a class="br" href="#L915" id="L915">915 </a>}
<a class="br" href="#L916" id="L916">916 </a>
<a class="br" href="#L917" id="L917">917 </a><span class="com">// string formatting</span>
<a class="br" href="#L918" id="L918">918 </a><span class="kwrd">version</span>(<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L919" id="L919">919 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L920" id="L920">920 </a>	<span class="kwrd">import</span> <span class="hid">std.format</span>: <span class="hid">format</span>;
<a class="br" href="#L921" id="L921">921 </a>
<a class="br" href="#L922" id="L922">922 </a>	<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="type">int</span> <span class="hid">x</span> = <span class="num">123</span>;
<a class="br" href="#L923" id="L923">923 </a>
<a class="br" href="#L924" id="L924">924 </a>	<span class="kwrd">assert</span>(<span class="hid">format</span>!<span class="str">&quot;%s&quot;</span>(<span class="hid">x</span>) == <span class="hid">format</span>!<span class="str">&quot;%s&quot;</span>(<span class="num">123</span>));
<a class="br" href="#L925" id="L925">925 </a>	<span class="kwrd">assert</span>(<span class="hid">format</span>!<span class="str">&quot;%x&quot;</span>(<span class="hid">x</span>) == <span class="hid">format</span>!<span class="str">&quot;%x&quot;</span>(<span class="num">123</span>));
<a class="br" href="#L926" id="L926">926 </a>}
<a class="br" href="#L927" id="L927">927 </a>
<a class="br" href="#L928" id="L928">928 </a><span class="com">// string formatting of qualified SumTypes</span>
<a class="br" href="#L929" id="L929">929 </a><span class="kwrd">version</span>(<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L930" id="L930">930 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L931" id="L931">931 </a>	<span class="kwrd">import</span> <span class="hid">std.format</span>: <span class="hid">format</span>;
<a class="br" href="#L932" id="L932">932 </a>
<a class="br" href="#L933" id="L933">933 </a>	<span class="type">int</span>[] <span class="hid">a</span> = [<span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>];
<a class="br" href="#L934" id="L934">934 </a>	<span class="kwrd">const</span>(<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>[])) <span class="hid">x</span> = <span class="hid">a</span>;
<a class="br" href="#L935" id="L935">935 </a>
<a class="br" href="#L936" id="L936">936 </a>	<span class="kwrd">assert</span>(<span class="hid">format</span>!<span class="str">&quot;%(%d, %)&quot;</span>(<span class="hid">x</span>) == <span class="hid">format</span>!<span class="str">&quot;%(%s, %)&quot;</span>(<span class="hid">a</span>));
<a class="br" href="#L937" id="L937">937 </a>}
<a class="br" href="#L938" id="L938">938 </a>
<a class="br" href="#L939" id="L939">939 </a><span class="com">// Github issue #16</span>
<a class="br" href="#L940" id="L940">940 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L941" id="L941">941 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L942" id="L942">942 </a>	<span class="kwrd">alias</span> <span class="hid">Node</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>[], <span class="type">string</span>);
<a class="br" href="#L943" id="L943">943 </a>
<a class="br" href="#L944" id="L944">944 </a>	<span class="com">// override inference of @system attribute for cyclic functions</span>
<a class="br" href="#L945" id="L945">945 </a>	<span class="kwrd">assert</span>((() @<span class="hid">trusted</span> =&gt;
<a class="br" href="#L946" id="L946">946 </a>		<span class="hid">Node</span>([<span class="hid">Node</span>([<span class="hid">Node</span>(<span class="str">&quot;x&quot;</span>)])])
<a class="br" href="#L947" id="L947">947 </a>		==
<a class="br" href="#L948" id="L948">948 </a>		<span class="hid">Node</span>([<span class="hid">Node</span>([<span class="hid">Node</span>(<span class="str">&quot;x&quot;</span>)])])
<a class="br" href="#L949" id="L949">949 </a>	)());
<a class="br" href="#L950" id="L950">950 </a>}
<a class="br" href="#L951" id="L951">951 </a>
<a class="br" href="#L952" id="L952">952 </a><span class="com">// Github issue #16 with const</span>
<a class="br" href="#L953" id="L953">953 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L954" id="L954">954 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L955" id="L955">955 </a>	<span class="kwrd">alias</span> <span class="hid">Node</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="kwrd">const</span>(<a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>)[], <span class="type">string</span>);
<a class="br" href="#L956" id="L956">956 </a>
<a class="br" href="#L957" id="L957">957 </a>	<span class="com">// override inference of @system attribute for cyclic functions</span>
<a class="br" href="#L958" id="L958">958 </a>	<span class="kwrd">assert</span>((() @<span class="hid">trusted</span> =&gt;
<a class="br" href="#L959" id="L959">959 </a>		<span class="hid">Node</span>([<span class="hid">Node</span>([<span class="hid">Node</span>(<span class="str">&quot;x&quot;</span>)])])
<a class="br" href="#L960" id="L960">960 </a>		==
<a class="br" href="#L961" id="L961">961 </a>		<span class="hid">Node</span>([<span class="hid">Node</span>([<span class="hid">Node</span>(<span class="str">&quot;x&quot;</span>)])])
<a class="br" href="#L962" id="L962">962 </a>	)());
<a class="br" href="#L963" id="L963">963 </a>}
<a class="br" href="#L964" id="L964">964 </a>
<a class="br" href="#L965" id="L965">965 </a><span class="com">// Stale pointers</span>
<a class="br" href="#L966" id="L966">966 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L967" id="L967">967 </a>@<span class="hid">system</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L968" id="L968">968 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">ubyte</span>, <span class="type">void</span>*[<span class="num">2</span>]);
<a class="br" href="#L969" id="L969">969 </a>
<a class="br" href="#L970" id="L970">970 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = [<span class="kwrd">null</span>, <span class="kwrd">cast</span>(<span class="type">void</span>*) <span class="num">0x12345678</span>];
<a class="br" href="#L971" id="L971">971 </a>	<span class="type">void</span>** <span class="hid">p</span> = &amp;<span class="hid">x.get</span>!(<span class="type">void</span>*[<span class="num">2</span>])[<span class="num">1</span>];
<a class="br" href="#L972" id="L972">972 </a>	<span class="hid">x</span> = <span class="type">ubyte</span>(<span class="num">123</span>);
<a class="br" href="#L973" id="L973">973 </a>
<a class="br" href="#L974" id="L974">974 </a>	<span class="kwrd">assert</span>(*<span class="hid">p</span> != <span class="kwrd">cast</span>(<span class="type">void</span>*) <span class="num">0x12345678</span>);
<a class="br" href="#L975" id="L975">975 </a>}
<a class="br" href="#L976" id="L976">976 </a>
<a class="br" href="#L977" id="L977">977 </a><span class="com">// Exception-safe assignment</span>
<a class="br" href="#L978" id="L978">978 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L979" id="L979">979 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L980" id="L980">980 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">A</span>
<a class="br" href="#L981" id="L981">981 </a>	{
<a class="br" href="#L982" id="L982">982 </a>		<span class="type">int</span> <span class="hid">value</span> = <span class="num">123</span>;
<a class="br" href="#L983" id="L983">983 </a>	}
<a class="br" href="#L984" id="L984">984 </a>
<a class="br" href="#L985" id="L985">985 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">B</span>
<a class="br" href="#L986" id="L986">986 </a>	{
<a class="br" href="#L987" id="L987">987 </a>		<span class="type">int</span> <span class="hid">value</span> = <span class="num">456</span>;
<a class="br" href="#L988" id="L988">988 </a>		<span class="kwrd">this</span>(<span class="kwrd">this</span>) { <span class="kwrd">throw</span> <span class="kwrd">new</span> <span class="hid">Exception</span>(<span class="str">&quot;oops&quot;</span>); }
<a class="br" href="#L989" id="L989">989 </a>	}
<a class="br" href="#L990" id="L990">990 </a>
<a class="br" href="#L991" id="L991">991 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">A</span>, <span class="hid">B</span>);
<a class="br" href="#L992" id="L992">992 </a>
<a class="br" href="#L993" id="L993">993 </a>	<span class="hid">MySum</span> <span class="hid">x</span>;
<a class="br" href="#L994" id="L994">994 </a>	<span class="kwrd">try</span> {
<a class="br" href="#L995" id="L995">995 </a>		<span class="hid">x</span> = <span class="hid">B</span>();
<a class="br" href="#L996" id="L996">996 </a>	} <span class="kwrd">catch</span> (<span class="hid">Exception</span> <span class="hid">e</span>) {}
<a class="br" href="#L997" id="L997">997 </a>
<a class="br" href="#L998" id="L998">998 </a>	<span class="kwrd">assert</span>(
<a class="br" href="#L999" id="L999">999 </a>		(<span class="hid">x.tag</span> == <span class="num">0</span> &amp;&amp; <span class="hid">x.get</span>!<span class="hid">A.value</span> == <span class="num">123</span>) ||
<a class="br" href="#L1000" id="L1000">1000 </a>		(<span class="hid">x.tag</span> == <span class="num">1</span> &amp;&amp; <span class="hid">x.get</span>!<span class="hid">B.value</span> == <span class="num">456</span>)
<a class="br" href="#L1001" id="L1001">1001 </a>	);
<a class="br" href="#L1002" id="L1002">1002 </a>}
<a class="br" href="#L1003" id="L1003">1003 </a>
<a class="br" href="#L1004" id="L1004">1004 </a><span class="com">// Types with @disable this(this)</span>
<a class="br" href="#L1005" id="L1005">1005 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1006" id="L1006">1006 </a>	<span class="kwrd">import</span> <span class="hid">core.lifetime</span>: <span class="hid">move</span>;
<a class="br" href="#L1007" id="L1007">1007 </a>
<a class="br" href="#L1008" id="L1008">1008 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">NoCopy</span>
<a class="br" href="#L1009" id="L1009">1009 </a>	{
<a class="br" href="#L1010" id="L1010">1010 </a>		@<span class="hid">disable</span> <span class="kwrd">this</span>(<span class="kwrd">this</span>);
<a class="br" href="#L1011" id="L1011">1011 </a>	}
<a class="br" href="#L1012" id="L1012">1012 </a>
<a class="br" href="#L1013" id="L1013">1013 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">NoCopy</span>;
<a class="br" href="#L1014" id="L1014">1014 </a>
<a class="br" href="#L1015" id="L1015">1015 </a>	<span class="hid">NoCopy</span> <span class="hid">lval</span> = <span class="hid">NoCopy</span>();
<a class="br" href="#L1016" id="L1016">1016 </a>
<a class="br" href="#L1017" id="L1017">1017 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">NoCopy</span>();
<a class="br" href="#L1018" id="L1018">1018 </a>	<span class="hid">MySum</span> <span class="hid">y</span> = <span class="hid">NoCopy</span>();
<a class="br" href="#L1019" id="L1019">1019 </a>
<a class="br" href="#L1020" id="L1020">1020 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">NoCopy</span>(<span class="hid">NoCopy</span>())));
<a class="br" href="#L1021" id="L1021">1021 </a>	<span class="kwrd">assert</span>(!<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">NoCopy</span>(<span class="hid">lval</span>)));
<a class="br" href="#L1022" id="L1022">1022 </a>
<a class="br" href="#L1023" id="L1023">1023 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">y</span> = <span class="hid">NoCopy</span>()));
<a class="br" href="#L1024" id="L1024">1024 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">y</span> = <span class="hid">move</span>(<span class="hid">x</span>)));
<a class="br" href="#L1025" id="L1025">1025 </a>	<span class="kwrd">assert</span>(!<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">y</span> = <span class="hid">lval</span>));
<a class="br" href="#L1026" id="L1026">1026 </a>	<span class="kwrd">assert</span>(!<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">y</span> = <span class="hid">x</span>));
<a class="br" href="#L1027" id="L1027">1027 </a>
<a class="br" href="#L1028" id="L1028">1028 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">x</span> == <span class="hid">y</span>));
<a class="br" href="#L1029" id="L1029">1029 </a>}
<a class="br" href="#L1030" id="L1030">1030 </a>
<a class="br" href="#L1031" id="L1031">1031 </a><span class="com">// Github issue #22</span>
<a class="br" href="#L1032" id="L1032">1032 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L1033" id="L1033">1033 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1034" id="L1034">1034 </a>	<span class="kwrd">import</span> <span class="hid">std.typecons</span>;
<a class="br" href="#L1035" id="L1035">1035 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, {
<a class="br" href="#L1036" id="L1036">1036 </a>		<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">A</span> {
<a class="br" href="#L1037" id="L1037">1037 </a>			<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">Nullable</span>!<span class="type">int</span>) <span class="hid">a</span> = <span class="hid">Nullable</span>!<span class="type">int</span>.<span class="hid">init</span>;
<a class="br" href="#L1038" id="L1038">1038 </a>		}
<a class="br" href="#L1039" id="L1039">1039 </a>	}));
<a class="br" href="#L1040" id="L1040">1040 </a>}
<a class="br" href="#L1041" id="L1041">1041 </a>
<a class="br" href="#L1042" id="L1042">1042 </a><span class="com">// Static arrays of structs with postblits</span>
<a class="br" href="#L1043" id="L1043">1043 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L1044" id="L1044">1044 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1045" id="L1045">1045 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">S</span>
<a class="br" href="#L1046" id="L1046">1046 </a>	{
<a class="br" href="#L1047" id="L1047">1047 </a>		<span class="type">int</span> <span class="hid">n</span>;
<a class="br" href="#L1048" id="L1048">1048 </a>		<span class="kwrd">this</span>(<span class="kwrd">this</span>) { <span class="hid">n</span>++; }
<a class="br" href="#L1049" id="L1049">1049 </a>	}
<a class="br" href="#L1050" id="L1050">1050 </a>
<a class="br" href="#L1051" id="L1051">1051 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">S</span>[<span class="num">1</span>])()));
<a class="br" href="#L1052" id="L1052">1052 </a>
<a class="br" href="#L1053" id="L1053">1053 </a>	<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">S</span>[<span class="num">1</span>]) <span class="hid">x</span> = [<span class="hid">S</span>(<span class="num">0</span>)];
<a class="br" href="#L1054" id="L1054">1054 </a>	<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">S</span>[<span class="num">1</span>]) <span class="hid">y</span> = <span class="hid">x</span>;
<a class="br" href="#L1055" id="L1055">1055 </a>
<a class="br" href="#L1056" id="L1056">1056 </a>	<span class="kwrd">auto</span> <span class="hid">xval</span> = <span class="hid">x.get</span>!(<span class="hid">S</span>[<span class="num">1</span>])[<span class="num">0</span>].<span class="hid">n</span>;
<a class="br" href="#L1057" id="L1057">1057 </a>	<span class="kwrd">auto</span> <span class="hid">yval</span> = <span class="hid">y.get</span>!(<span class="hid">S</span>[<span class="num">1</span>])[<span class="num">0</span>].<span class="hid">n</span>;
<a class="br" href="#L1058" id="L1058">1058 </a>
<a class="br" href="#L1059" id="L1059">1059 </a>	<span class="kwrd">assert</span>(<span class="hid">xval</span> != <span class="hid">yval</span>);
<a class="br" href="#L1060" id="L1060">1060 </a>}
<a class="br" href="#L1061" id="L1061">1061 </a>
<a class="br" href="#L1062" id="L1062">1062 </a><span class="com">// Replacement does not happen inside SumType</span>
<a class="br" href="#L1063" id="L1063">1063 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L1064" id="L1064">1064 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1065" id="L1065">1065 </a>	<span class="kwrd">import</span> <span class="hid">std.typecons</span> : <span class="hid">Tuple</span>, <span class="hid">ReplaceTypeUnless</span>;
<a class="br" href="#L1066" id="L1066">1066 </a>	<span class="kwrd">alias</span> <span class="hid">A</span> = <span class="hid">Tuple</span>!(<a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>*,<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>*))[<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>*,<span class="type">string</span>)[<a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>]];
<a class="br" href="#L1067" id="L1067">1067 </a>	<span class="kwrd">alias</span> <span class="hid">TR</span> = <span class="hid">ReplaceTypeUnless</span>!(<a class="hid" href="sumtype.d.html#L1286" title="sumtype.isSumTypeInstance">isSumTypeInstance</a>, <a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>, <span class="type">int</span>, <span class="hid">A</span>);
<a class="br" href="#L1068" id="L1068">1068 </a>	<span class="kwrd">static</span> <span class="kwrd">assert</span>(<span class="kwrd">is</span>(<span class="hid">TR</span> == <span class="hid">Tuple</span>!(<span class="type">int</span>*,<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>*))[<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>*, <span class="type">string</span>)[<span class="type">int</span>]]));
<a class="br" href="#L1069" id="L1069">1069 </a>}
<a class="br" href="#L1070" id="L1070">1070 </a>
<a class="br" href="#L1071" id="L1071">1071 </a><span class="com">// Supports nested self-referential SumTypes</span>
<a class="br" href="#L1072" id="L1072">1072 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1073" id="L1073">1073 </a>	<span class="kwrd">import</span> <span class="hid">std.typecons</span> : <span class="hid">Tuple</span>, <span class="hid">Flag</span>;
<a class="br" href="#L1074" id="L1074">1074 </a>	<span class="kwrd">alias</span> <span class="hid">Nat</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">Flag</span>!<span class="str">&quot;0&quot;</span>, <span class="hid">Tuple</span>!(<a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>*));
<a class="br" href="#L1075" id="L1075">1075 </a>	<span class="kwrd">static</span> <span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">Nat</span>)));
<a class="br" href="#L1076" id="L1076">1076 </a>	<span class="kwrd">static</span> <span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">Nat</span>*, <span class="hid">Tuple</span>!(<a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>*, <a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>*))));
<a class="br" href="#L1077" id="L1077">1077 </a>}
<a class="br" href="#L1078" id="L1078">1078 </a>
<a class="br" href="#L1079" id="L1079">1079 </a><span class="com">// Self-referential SumTypes inside Algebraic</span>
<a class="br" href="#L1080" id="L1080">1080 </a><span class="kwrd">version</span>(<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L1081" id="L1081">1081 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1082" id="L1082">1082 </a>	<span class="kwrd">import</span> <span class="hid">std.variant</span>: <span class="hid">Algebraic</span>;
<a class="br" href="#L1083" id="L1083">1083 </a>
<a class="br" href="#L1084" id="L1084">1084 </a>	<span class="kwrd">alias</span> <span class="hid">T</span> = <span class="hid">Algebraic</span>!(<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>*));
<a class="br" href="#L1085" id="L1085">1085 </a>
<a class="br" href="#L1086" id="L1086">1086 </a>	<span class="kwrd">assert</span>(<span class="kwrd">is</span>(<span class="hid">T.AllowedTypes</span>[<span class="num">0</span>].<span class="hid">Types</span>[<span class="num">0</span>] == <span class="hid">T.AllowedTypes</span>[<span class="num">0</span>]*));
<a class="br" href="#L1087" id="L1087">1087 </a>}
<a class="br" href="#L1088" id="L1088">1088 </a>
<a class="br" href="#L1089" id="L1089">1089 </a><span class="com">// Doesn't call @system postblits in @safe code</span>
<a class="br" href="#L1090" id="L1090">1090 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1091" id="L1091">1091 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">SystemCopy</span> { @<span class="hid">system</span> <span class="kwrd">this</span>(<span class="kwrd">this</span>) {} }
<a class="br" href="#L1092" id="L1092">1092 </a>	<span class="hid">SystemCopy</span> <span class="hid">original</span>;
<a class="br" href="#L1093" id="L1093">1093 </a>
<a class="br" href="#L1094" id="L1094">1094 </a>	<span class="kwrd">assert</span>(!<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, () @<span class="hid">safe</span> {
<a class="br" href="#L1095" id="L1095">1095 </a>		<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">SystemCopy</span> <span class="hid">copy</span> = <span class="hid">original</span>;
<a class="br" href="#L1096" id="L1096">1096 </a>	}));
<a class="br" href="#L1097" id="L1097">1097 </a>
<a class="br" href="#L1098" id="L1098">1098 </a>	<span class="kwrd">assert</span>(!<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, () @<span class="hid">safe</span> {
<a class="br" href="#L1099" id="L1099">1099 </a>		<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">SystemCopy</span> <span class="hid">copy</span>; <span class="hid">copy</span> = <span class="hid">original</span>;
<a class="br" href="#L1100" id="L1100">1100 </a>	}));
<a class="br" href="#L1101" id="L1101">1101 </a>}
<a class="br" href="#L1102" id="L1102">1102 </a>
<a class="br" href="#L1103" id="L1103">1103 </a><span class="com">// Doesn't overwrite pointers in @safe code</span>
<a class="br" href="#L1104" id="L1104">1104 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1105" id="L1105">1105 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>*, <span class="type">int</span>);
<a class="br" href="#L1106" id="L1106">1106 </a>
<a class="br" href="#L1107" id="L1107">1107 </a>	<span class="hid">MySum</span> <span class="hid">x</span>;
<a class="br" href="#L1108" id="L1108">1108 </a>
<a class="br" href="#L1109" id="L1109">1109 </a>	<span class="kwrd">assert</span>(!<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, () @<span class="hid">safe</span> {
<a class="br" href="#L1110" id="L1110">1110 </a>		<span class="hid">x</span> = <span class="num">123</span>;
<a class="br" href="#L1111" id="L1111">1111 </a>	}));
<a class="br" href="#L1112" id="L1112">1112 </a>
<a class="br" href="#L1113" id="L1113">1113 </a>	<span class="kwrd">assert</span>(!<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, () @<span class="hid">safe</span> {
<a class="br" href="#L1114" id="L1114">1114 </a>		<span class="hid">x</span> = <span class="hid">MySum</span>(<span class="num">123</span>);
<a class="br" href="#L1115" id="L1115">1115 </a>	}));
<a class="br" href="#L1116" id="L1116">1116 </a>}
<a class="br" href="#L1117" id="L1117">1117 </a>
<a class="br" href="#L1118" id="L1118">1118 </a><span class="com">// Types with invariants</span>
<a class="br" href="#L1119" id="L1119">1119 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L1120" id="L1120">1120 </a>@<span class="hid">system</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1121" id="L1121">1121 </a>	<span class="kwrd">import</span> <span class="hid">std.exception</span>: <span class="hid">assertThrown</span>;
<a class="br" href="#L1122" id="L1122">1122 </a>	<span class="kwrd">import</span> <span class="hid">core.exception</span>: <span class="hid">AssertError</span>;
<a class="br" href="#L1123" id="L1123">1123 </a>
<a class="br" href="#L1124" id="L1124">1124 </a>	<span class="kwrd">struct</span> <span class="hid">S</span>
<a class="br" href="#L1125" id="L1125">1125 </a>	{
<a class="br" href="#L1126" id="L1126">1126 </a>		<span class="type">int</span> <span class="hid">i</span>;
<a class="br" href="#L1127" id="L1127">1127 </a>		<span class="kwrd">invariant</span> { <span class="kwrd">assert</span>(<span class="hid">i</span> &gt;= <span class="num">0</span>); }
<a class="br" href="#L1128" id="L1128">1128 </a>	}
<a class="br" href="#L1129" id="L1129">1129 </a>
<a class="br" href="#L1130" id="L1130">1130 </a>	<span class="kwrd">class</span> <span class="hid">C</span>
<a class="br" href="#L1131" id="L1131">1131 </a>	{
<a class="br" href="#L1132" id="L1132">1132 </a>		<span class="type">int</span> <span class="hid">i</span>;
<a class="br" href="#L1133" id="L1133">1133 </a>		<span class="kwrd">invariant</span> { <span class="kwrd">assert</span>(<span class="hid">i</span> &gt;= <span class="num">0</span>); }
<a class="br" href="#L1134" id="L1134">1134 </a>	}
<a class="br" href="#L1135" id="L1135">1135 </a>
<a class="br" href="#L1136" id="L1136">1136 </a>	<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">S</span> <span class="hid">x</span>;
<a class="br" href="#L1137" id="L1137">1137 </a>	<span class="hid">x.match</span>!((<span class="kwrd">ref</span> <span class="hid">v</span>) { <span class="hid">v.i</span> = -<span class="num">1</span>; });
<a class="br" href="#L1138" id="L1138">1138 </a>	<span class="hid">assertThrown</span>!<span class="hid">AssertError</span>(<span class="kwrd">assert</span>(&amp;<span class="hid">x</span>));
<a class="br" href="#L1139" id="L1139">1139 </a>
<a class="br" href="#L1140" id="L1140">1140 </a>	<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">C</span> <span class="hid">y</span> = <span class="kwrd">new</span> <span class="hid">C</span>();
<a class="br" href="#L1141" id="L1141">1141 </a>	<span class="hid">y.match</span>!((<span class="kwrd">ref</span> <span class="hid">v</span>) { <span class="hid">v.i</span> = -<span class="num">1</span>; });
<a class="br" href="#L1142" id="L1142">1142 </a>	<span class="hid">assertThrown</span>!<span class="hid">AssertError</span>(<span class="kwrd">assert</span>(&amp;<span class="hid">y</span>));
<a class="br" href="#L1143" id="L1143">1143 </a>}
<a class="br" href="#L1144" id="L1144">1144 </a>
<a class="br" href="#L1145" id="L1145">1145 </a><span class="com">// Calls value postblit on self-assignment</span>
<a class="br" href="#L1146" id="L1146">1146 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1147" id="L1147">1147 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">S</span>
<a class="br" href="#L1148" id="L1148">1148 </a>	{
<a class="br" href="#L1149" id="L1149">1149 </a>		<span class="type">int</span> <span class="hid">n</span>;
<a class="br" href="#L1150" id="L1150">1150 </a>		<span class="kwrd">this</span>(<span class="kwrd">this</span>) { <span class="hid">n</span>++; }
<a class="br" href="#L1151" id="L1151">1151 </a>	}
<a class="br" href="#L1152" id="L1152">1152 </a>
<a class="br" href="#L1153" id="L1153">1153 </a>	<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">S</span> <span class="hid">x</span> = <span class="hid">S</span>();
<a class="br" href="#L1154" id="L1154">1154 </a>	<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">S</span> <span class="hid">y</span>;
<a class="br" href="#L1155" id="L1155">1155 </a>	<span class="hid">y</span> = <span class="hid">x</span>;
<a class="br" href="#L1156" id="L1156">1156 </a>
<a class="br" href="#L1157" id="L1157">1157 </a>	<span class="kwrd">auto</span> <span class="hid">xval</span> = <span class="hid">x.get</span>!<span class="hid">S.n</span>;
<a class="br" href="#L1158" id="L1158">1158 </a>	<span class="kwrd">auto</span> <span class="hid">yval</span> = <span class="hid">y.get</span>!<span class="hid">S.n</span>;
<a class="br" href="#L1159" id="L1159">1159 </a>
<a class="br" href="#L1160" id="L1160">1160 </a>	<span class="kwrd">assert</span>(<span class="hid">xval</span> != <span class="hid">yval</span>);
<a class="br" href="#L1161" id="L1161">1161 </a>}
<a class="br" href="#L1162" id="L1162">1162 </a>
<a class="br" href="#L1163" id="L1163">1163 </a><span class="com">// Github issue #29</span>
<a class="br" href="#L1164" id="L1164">1164 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1165" id="L1165">1165 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, () @<span class="hid">safe</span> {
<a class="br" href="#L1166" id="L1166">1166 </a>		<span class="kwrd">alias</span> <span class="hid">A</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="type">string</span>;
<a class="br" href="#L1167" id="L1167">1167 </a>
<a class="br" href="#L1168" id="L1168">1168 </a>		@<span class="hid">safe</span> <span class="hid">A</span> <span class="hid">createA</span>(<span class="type">string</span> <span class="hid">arg</span>) {
<a class="br" href="#L1169" id="L1169">1169 </a>		<span class="kwrd">return</span> <span class="hid">A</span>(<span class="hid">arg</span>);
<a class="br" href="#L1170" id="L1170">1170 </a>		}
<a class="br" href="#L1171" id="L1171">1171 </a>
<a class="br" href="#L1172" id="L1172">1172 </a>		@<span class="hid">safe</span> <span class="type">void</span> <span class="hid">test</span>() {
<a class="br" href="#L1173" id="L1173">1173 </a>		<span class="hid">A</span> <span class="hid">a</span> = <span class="hid">createA</span>(<span class="str">&quot;&quot;</span>);
<a class="br" href="#L1174" id="L1174">1174 </a>		}
<a class="br" href="#L1175" id="L1175">1175 </a>	}));
<a class="br" href="#L1176" id="L1176">1176 </a>}
<a class="br" href="#L1177" id="L1177">1177 </a>
<a class="br" href="#L1178" id="L1178">1178 </a><span class="com">// SumTypes as associative array keys</span>
<a class="br" href="#L1179" id="L1179">1179 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L1180" id="L1180">1180 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1181" id="L1181">1181 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, {
<a class="br" href="#L1182" id="L1182">1182 </a>		<span class="type">int</span>[<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">string</span>)] <span class="hid">aa</span>;
<a class="br" href="#L1183" id="L1183">1183 </a>	}));
<a class="br" href="#L1184" id="L1184">1184 </a>}
<a class="br" href="#L1185" id="L1185">1185 </a>
<a class="br" href="#L1186" id="L1186">1186 </a><span class="com">// toString with non-copyable types</span>
<a class="br" href="#L1187" id="L1187">1187 </a><span class="kwrd">version</span>(<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L1188" id="L1188">1188 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1189" id="L1189">1189 </a>	<span class="kwrd">struct</span> <span class="hid">NoCopy</span>
<a class="br" href="#L1190" id="L1190">1190 </a>	{
<a class="br" href="#L1191" id="L1191">1191 </a>		@<span class="hid">disable</span> <span class="kwrd">this</span>(<span class="kwrd">this</span>);
<a class="br" href="#L1192" id="L1192">1192 </a>	}
<a class="br" href="#L1193" id="L1193">1193 </a>
<a class="br" href="#L1194" id="L1194">1194 </a>	<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">NoCopy</span> <span class="hid">x</span>;
<a class="br" href="#L1195" id="L1195">1195 </a>
<a class="br" href="#L1196" id="L1196">1196 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">x.toString</span>()));
<a class="br" href="#L1197" id="L1197">1197 </a>}
<a class="br" href="#L1198" id="L1198">1198 </a>
<a class="br" href="#L1199" id="L1199">1199 </a><span class="com">// Can use the result of assignment</span>
<a class="br" href="#L1200" id="L1200">1200 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1201" id="L1201">1201 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>);
<a class="br" href="#L1202" id="L1202">1202 </a>
<a class="br" href="#L1203" id="L1203">1203 </a>	<span class="hid">MySum</span> <span class="hid">a</span> = <span class="hid">MySum</span>(<span class="num">123</span>);
<a class="br" href="#L1204" id="L1204">1204 </a>	<span class="hid">MySum</span> <span class="hid">b</span> = <span class="hid">MySum</span>(<span class="num">3.14</span>);
<a class="br" href="#L1205" id="L1205">1205 </a>
<a class="br" href="#L1206" id="L1206">1206 </a>	<span class="kwrd">assert</span>((<span class="hid">a</span> = <span class="hid">b</span>) == <span class="hid">b</span>);
<a class="br" href="#L1207" id="L1207">1207 </a>	<span class="kwrd">assert</span>((<span class="hid">a</span> = <span class="hid">MySum</span>(<span class="num">123</span>)) == <span class="hid">MySum</span>(<span class="num">123</span>));
<a class="br" href="#L1208" id="L1208">1208 </a>	<span class="kwrd">assert</span>((<span class="hid">a</span> = <span class="num">3.14</span>) == <span class="hid">MySum</span>(<span class="num">3.14</span>));
<a class="br" href="#L1209" id="L1209">1209 </a>	<span class="kwrd">assert</span>(((<span class="hid">a</span> = <span class="hid">b</span>) = <span class="hid">MySum</span>(<span class="num">123</span>)) == <span class="hid">MySum</span>(<span class="num">123</span>));
<a class="br" href="#L1210" id="L1210">1210 </a>}
<a class="br" href="#L1211" id="L1211">1211 </a>
<a class="br" href="#L1212" id="L1212">1212 </a><span class="com">// Types with copy constructors</span>
<a class="br" href="#L1213" id="L1213">1213 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1214" id="L1214">1214 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">S</span>
<a class="br" href="#L1215" id="L1215">1215 </a>	{
<a class="br" href="#L1216" id="L1216">1216 </a>		<span class="type">int</span> <span class="hid">n</span>;
<a class="br" href="#L1217" id="L1217">1217 </a>
<a class="br" href="#L1218" id="L1218">1218 </a>		<span class="kwrd">this</span>(<span class="kwrd">ref</span> <span class="kwrd">return</span> <span class="kwrd">scope</span> <span class="kwrd">inout</span> <span class="hid">S</span> <span class="hid">other</span>) <span class="kwrd">inout</span>
<a class="br" href="#L1219" id="L1219">1219 </a>		{
<a class="br" href="#L1220" id="L1220">1220 </a>			<span class="hid">n</span> = <span class="hid">other.n</span> + <span class="num">1</span>;
<a class="br" href="#L1221" id="L1221">1221 </a>		}
<a class="br" href="#L1222" id="L1222">1222 </a>	}
<a class="br" href="#L1223" id="L1223">1223 </a>
<a class="br" href="#L1224" id="L1224">1224 </a>	<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">S</span> <span class="hid">x</span> = <span class="hid">S</span>();
<a class="br" href="#L1225" id="L1225">1225 </a>	<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">S</span> <span class="hid">y</span> = <span class="hid">x</span>;
<a class="br" href="#L1226" id="L1226">1226 </a>
<a class="br" href="#L1227" id="L1227">1227 </a>	<span class="kwrd">auto</span> <span class="hid">xval</span> = <span class="hid">x.get</span>!<span class="hid">S.n</span>;
<a class="br" href="#L1228" id="L1228">1228 </a>	<span class="kwrd">auto</span> <span class="hid">yval</span> = <span class="hid">y.get</span>!<span class="hid">S.n</span>;
<a class="br" href="#L1229" id="L1229">1229 </a>
<a class="br" href="#L1230" id="L1230">1230 </a>	<span class="kwrd">assert</span>(<span class="hid">xval</span> != <span class="hid">yval</span>);
<a class="br" href="#L1231" id="L1231">1231 </a>}
<a class="br" href="#L1232" id="L1232">1232 </a>
<a class="br" href="#L1233" id="L1233">1233 </a><span class="com">// Copyable by generated copy constructors</span>
<a class="br" href="#L1234" id="L1234">1234 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1235" id="L1235">1235 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">Inner</span>
<a class="br" href="#L1236" id="L1236">1236 </a>	{
<a class="br" href="#L1237" id="L1237">1237 </a>		<span class="kwrd">ref</span> <span class="kwrd">this</span>(<span class="kwrd">ref</span> <span class="kwrd">inout</span> <span class="hid">Inner</span> <span class="hid">other</span>) {}
<a class="br" href="#L1238" id="L1238">1238 </a>	}
<a class="br" href="#L1239" id="L1239">1239 </a>
<a class="br" href="#L1240" id="L1240">1240 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">Outer</span>
<a class="br" href="#L1241" id="L1241">1241 </a>	{
<a class="br" href="#L1242" id="L1242">1242 </a>		<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">Inner</span> <span class="hid">inner</span>;
<a class="br" href="#L1243" id="L1243">1243 </a>	}
<a class="br" href="#L1244" id="L1244">1244 </a>
<a class="br" href="#L1245" id="L1245">1245 </a>	<span class="hid">Outer</span> <span class="hid">x</span>;
<a class="br" href="#L1246" id="L1246">1246 </a>	<span class="hid">Outer</span> <span class="hid">y</span> = <span class="hid">x</span>;
<a class="br" href="#L1247" id="L1247">1247 </a>}
<a class="br" href="#L1248" id="L1248">1248 </a>
<a class="br" href="#L1249" id="L1249">1249 </a><span class="com">// Types with disabled opEquals</span>
<a class="br" href="#L1250" id="L1250">1250 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1251" id="L1251">1251 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">S</span>
<a class="br" href="#L1252" id="L1252">1252 </a>	{
<a class="br" href="#L1253" id="L1253">1253 </a>		@<span class="hid">disable</span> <span class="type">bool</span> <span class="hid">opEquals</span>(<span class="kwrd">const</span> <span class="hid">S</span> <span class="hid">rhs</span>) <span class="kwrd">const</span>;
<a class="br" href="#L1254" id="L1254">1254 </a>	}
<a class="br" href="#L1255" id="L1255">1255 </a>
<a class="br" href="#L1256" id="L1256">1256 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">S</span>(<span class="hid">S</span>())));
<a class="br" href="#L1257" id="L1257">1257 </a>}
<a class="br" href="#L1258" id="L1258">1258 </a>
<a class="br" href="#L1259" id="L1259">1259 </a><span class="com">// Types with non-const opEquals</span>
<a class="br" href="#L1260" id="L1260">1260 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1261" id="L1261">1261 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">S</span>
<a class="br" href="#L1262" id="L1262">1262 </a>	{
<a class="br" href="#L1263" id="L1263">1263 </a>		<span class="type">int</span> <span class="hid">i</span>;
<a class="br" href="#L1264" id="L1264">1264 </a>		<span class="type">bool</span> <span class="hid">opEquals</span>(<span class="hid">S</span> <span class="hid">rhs</span>) { <span class="kwrd">return</span> <span class="hid">i</span> == <span class="hid">rhs.i</span>; }
<a class="br" href="#L1265" id="L1265">1265 </a>	}
<a class="br" href="#L1266" id="L1266">1266 </a>
<a class="br" href="#L1267" id="L1267">1267 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">S</span>(<span class="hid">S</span>(<span class="num">123</span>))));
<a class="br" href="#L1268" id="L1268">1268 </a>}
<a class="br" href="#L1269" id="L1269">1269 </a>
<a class="br" href="#L1270" id="L1270">1270 </a><span class="com">// Incomparability of different SumTypes</span>
<a class="br" href="#L1271" id="L1271">1271 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1272" id="L1272">1272 </a>	<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">string</span>) <span class="hid">x</span> = <span class="num">123</span>;
<a class="br" href="#L1273" id="L1273">1273 </a>	<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">string</span>, <span class="type">int</span>) <span class="hid">y</span> = <span class="num">123</span>;
<a class="br" href="#L1274" id="L1274">1274 </a>
<a class="br" href="#L1275" id="L1275">1275 </a>	<span class="kwrd">assert</span>(!<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">x</span> != <span class="hid">y</span>));
<a class="br" href="#L1276" id="L1276">1276 </a>}
<a class="br" href="#L1277" id="L1277">1277 </a>
<a class="br" href="#L1278" id="L1278">1278 </a><span class="com">// Self-reference in return/parameter type of function pointer member</span>
<a class="br" href="#L1279" id="L1279">1279 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1280" id="L1280">1280 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, {
<a class="br" href="#L1281" id="L1281">1281 </a>		<span class="kwrd">alias</span> <span class="hid">T</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a> <span class="kwrd">delegate</span>(<a class="hid" href="sumtype.d.html#L244" title="sumtype.This">This</a>));
<a class="br" href="#L1282" id="L1282">1282 </a>	}));
<a class="br" href="#L1283" id="L1283">1283 </a>}
<a class="br" href="#L1284" id="L1284">1284 </a>
<a class="br" href="#L1285" id="L1285">1285 </a><span class="com">/// True if `T` is an instance of the `SumType` template, otherwise false.</span>
<a class="br" href="#L1286" id="L1286">1286 </a><span class="kwrd">private</span> <span class="kwrd">enum</span> <span class="type">bool</span> <a class="hid" href="sumtype.d.html#L1286" title="sumtype.isSumTypeInstance">isSumTypeInstance</a>(<span class="hid">T</span>) = <span class="kwrd">is</span>(<span class="hid">T</span> == <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">Args</span>, <span class="hid">Args</span>...);
<a class="br" href="#L1287" id="L1287">1287 </a>
<a class="br" href="#L1288" id="L1288">1288 </a><span class="kwrd">unittest</span> {
<a class="br" href="#L1289" id="L1289">1289 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">Wrapper</span>
<a class="br" href="#L1290" id="L1290">1290 </a>	{
<a class="br" href="#L1291" id="L1291">1291 </a>		<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="type">int</span> <span class="hid">s</span>;
<a class="br" href="#L1292" id="L1292">1292 </a>		<span class="kwrd">alias</span> <span class="hid">s</span> <span class="kwrd">this</span>;
<a class="br" href="#L1293" id="L1293">1293 </a>	}
<a class="br" href="#L1294" id="L1294">1294 </a>
<a class="br" href="#L1295" id="L1295">1295 </a>	<span class="kwrd">assert</span>(<a class="hid" href="sumtype.d.html#L1286" title="sumtype.isSumTypeInstance">isSumTypeInstance</a>!(<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="type">int</span>));
<a class="br" href="#L1296" id="L1296">1296 </a>	<span class="kwrd">assert</span>(!<a class="hid" href="sumtype.d.html#L1286" title="sumtype.isSumTypeInstance">isSumTypeInstance</a>!<span class="hid">Wrapper</span>);
<a class="br" href="#L1297" id="L1297">1297 </a>}
<a class="br" href="#L1298" id="L1298">1298 </a>
<a class="br" href="#L1299" id="L1299">1299 </a><span class="com">/// True if `T` is a [SumType] or implicitly converts to one, otherwise false.</span>
<a class="br" href="#L1300" id="L1300">1300 </a><span class="kwrd">enum</span> <span class="type">bool</span> <a class="hid" href="sumtype.d.html#L1300" title="sumtype.isSumType">isSumType</a>(<span class="hid">T</span>) = <span class="kwrd">is</span>(<span class="hid">T</span> : <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="hid">Args</span>, <span class="hid">Args</span>...);
<a class="br" href="#L1301" id="L1301">1301 </a>
<a class="br" href="#L1302" id="L1302">1302 </a><span class="com">///</span>
<a class="br" href="#L1303" id="L1303">1303 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1304" id="L1304">1304 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">ConvertsToSumType</span>
<a class="br" href="#L1305" id="L1305">1305 </a>	{
<a class="br" href="#L1306" id="L1306">1306 </a>		<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="type">int</span> <span class="hid">payload</span>;
<a class="br" href="#L1307" id="L1307">1307 </a>		<span class="kwrd">alias</span> <span class="hid">payload</span> <span class="kwrd">this</span>;
<a class="br" href="#L1308" id="L1308">1308 </a>	}
<a class="br" href="#L1309" id="L1309">1309 </a>
<a class="br" href="#L1310" id="L1310">1310 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">ContainsSumType</span>
<a class="br" href="#L1311" id="L1311">1311 </a>	{
<a class="br" href="#L1312" id="L1312">1312 </a>		<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="type">int</span> <span class="hid">payload</span>;
<a class="br" href="#L1313" id="L1313">1313 </a>	}
<a class="br" href="#L1314" id="L1314">1314 </a>
<a class="br" href="#L1315" id="L1315">1315 </a>	<span class="kwrd">assert</span>(<a class="hid" href="sumtype.d.html#L1300" title="sumtype.isSumType">isSumType</a>!(<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="type">int</span>));
<a class="br" href="#L1316" id="L1316">1316 </a>	<span class="kwrd">assert</span>(<a class="hid" href="sumtype.d.html#L1300" title="sumtype.isSumType">isSumType</a>!<span class="hid">ConvertsToSumType</span>);
<a class="br" href="#L1317" id="L1317">1317 </a>	<span class="kwrd">assert</span>(!<a class="hid" href="sumtype.d.html#L1300" title="sumtype.isSumType">isSumType</a>!<span class="hid">ContainsSumType</span>);
<a class="br" href="#L1318" id="L1318">1318 </a>}
<a class="br" href="#L1319" id="L1319">1319 </a>
<a class="br" href="#L1320" id="L1320">1320 </a><span class="com">/**
<a class="br" href="#L1321" id="L1321">1321 </a> * Calls a type-appropriate function with the value held in a [SumType].
<a class="br" href="#L1322" id="L1322">1322 </a> *
<a class="br" href="#L1323" id="L1323">1323 </a> * For each possible type the [SumType] can hold, the given handlers are
<a class="br" href="#L1324" id="L1324">1324 </a> * checked, in order, to see whether they accept a single argument of that type.
<a class="br" href="#L1325" id="L1325">1325 </a> * The first one that does is chosen as the match for that type. (Note that the
<a class="br" href="#L1326" id="L1326">1326 </a> * first match may not always be the most exact match.
<a class="br" href="#L1327" id="L1327">1327 </a> * See [#avoiding-unintentional-matches|&quot;Avoiding unintentional matches&quot;] for
<a class="br" href="#L1328" id="L1328">1328 </a> * one common pitfall.)
<a class="br" href="#L1329" id="L1329">1329 </a> *
<a class="br" href="#L1330" id="L1330">1330 </a> * Every type must have a matching handler, and every handler must match at
<a class="br" href="#L1331" id="L1331">1331 </a> * least one type. This is enforced at compile time.
<a class="br" href="#L1332" id="L1332">1332 </a> *
<a class="br" href="#L1333" id="L1333">1333 </a> * Handlers may be functions, delegates, or objects with `opCall` overloads. If
<a class="br" href="#L1334" id="L1334">1334 </a> * a function with more than one overload is given as a handler, all of the
<a class="br" href="#L1335" id="L1335">1335 </a> * overloads are considered as potential matches.
<a class="br" href="#L1336" id="L1336">1336 </a> *
<a class="br" href="#L1337" id="L1337">1337 </a> * Templated handlers are also accepted, and will match any type for which they
<a class="br" href="#L1338" id="L1338">1338 </a> * can be [implicitly instantiated](https://dlang.org/glossary.html#ifti). See
<a class="br" href="#L1339" id="L1339">1339 </a> * [sumtype#introspection-based-matching|&quot;Introspection-based matching&quot;] for an
<a class="br" href="#L1340" id="L1340">1340 </a> * example of templated handler usage.
<a class="br" href="#L1341" id="L1341">1341 </a> *
<a class="br" href="#L1342" id="L1342">1342 </a> * If multiple [SumType]s are passed to match, their values are passed to the
<a class="br" href="#L1343" id="L1343">1343 </a> * handlers as separate arguments, and matching is done for each possible
<a class="br" href="#L1344" id="L1344">1344 </a> * combination of value types. See [#multiple-dispatch|&quot;Multiple dispatch&quot;] for
<a class="br" href="#L1345" id="L1345">1345 </a> * an example.
<a class="br" href="#L1346" id="L1346">1346 </a> *
<a class="br" href="#L1347" id="L1347">1347 </a> * Returns:
<a class="br" href="#L1348" id="L1348">1348 </a> *   The value returned from the handler that matches the currently-held type.
<a class="br" href="#L1349" id="L1349">1349 </a> *
<a class="br" href="#L1350" id="L1350">1350 </a> * See_Also: `std.variant.visit`
<a class="br" href="#L1351" id="L1351">1351 </a> */</span>
<a class="br" href="#L1352" id="L1352">1352 </a><span class="kwrd">template</span> <a class="hid" href="sumtype.d.html#L1352" title="sumtype.match">match</a>(<span class="hid">handlers</span>...)
<a class="br" href="#L1353" id="L1353">1353 </a>{
<a class="br" href="#L1354" id="L1354">1354 </a>	<span class="kwrd">import</span> <span class="hid">std.typecons</span>: <span class="hid">Yes</span>;
<a class="br" href="#L1355" id="L1355">1355 </a>
<a class="br" href="#L1356" id="L1356">1356 </a>	<span class="com">/**
<a class="br" href="#L1357" id="L1357">1357 </a>	 * The actual `match` function.
<a class="br" href="#L1358" id="L1358">1358 </a>	 *
<a class="br" href="#L1359" id="L1359">1359 </a>	 * Params:
<a class="br" href="#L1360" id="L1360">1360 </a>	 *   args = One or more [SumType] objects.
<a class="br" href="#L1361" id="L1361">1361 </a>	 */</span>
<a class="br" href="#L1362" id="L1362">1362 </a>	<span class="kwrd">auto</span> <span class="kwrd">ref</span> <a class="hid" href="sumtype.d.html#L1352" title="sumtype.match">match</a>(<span class="hid">SumTypes</span>...)(<span class="kwrd">auto</span> <span class="kwrd">ref</span> <span class="hid">SumTypes</span> <span class="hid">args</span>)
<a class="br" href="#L1363" id="L1363">1363 </a>		<span class="kwrd">if</span> (<span class="hid">allSatisfy</span>!(<a class="hid" href="sumtype.d.html#L1300" title="sumtype.isSumType">isSumType</a>, <span class="hid">SumTypes</span>) &amp;&amp; <span class="hid">args.length</span> &gt; <span class="num">0</span>)
<a class="br" href="#L1364" id="L1364">1364 </a>	{
<a class="br" href="#L1365" id="L1365">1365 </a>		<span class="kwrd">return</span> <a class="hid" href="sumtype.d.html#L1563" title="sumtype.matchImpl">matchImpl</a>!(<span class="hid">Yes.exhaustive</span>, <span class="hid">handlers</span>)(<span class="hid">args</span>);
<a class="br" href="#L1366" id="L1366">1366 </a>	}
<a class="br" href="#L1367" id="L1367">1367 </a>}
<a class="br" href="#L1368" id="L1368">1368 </a>
<a class="br" href="#L1369" id="L1369">1369 </a><span class="com">/** $(H3 Avoiding unintentional matches)
<a class="br" href="#L1370" id="L1370">1370 </a> *
<a class="br" href="#L1371" id="L1371">1371 </a> * Sometimes, implicit conversions may cause a handler to match more types than
<a class="br" href="#L1372" id="L1372">1372 </a> * intended. The example below shows two solutions to this problem.
<a class="br" href="#L1373" id="L1373">1373 </a> */</span>
<a class="br" href="#L1374" id="L1374">1374 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1375" id="L1375">1375 </a>    <span class="kwrd">alias</span> <span class="hid">Number</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">double</span>, <span class="type">int</span>);
<a class="br" href="#L1376" id="L1376">1376 </a>
<a class="br" href="#L1377" id="L1377">1377 </a>    <span class="hid">Number</span> <span class="hid">x</span>;
<a class="br" href="#L1378" id="L1378">1378 </a>
<a class="br" href="#L1379" id="L1379">1379 </a>    <span class="com">// Problem: because int implicitly converts to double, the double</span>
<a class="br" href="#L1380" id="L1380">1380 </a>    <span class="com">// handler is used for both types, and the int handler never matches.</span>
<a class="br" href="#L1381" id="L1381">1381 </a>    <span class="kwrd">assert</span>(!<span class="kwrd">__traits</span>(<span class="hid">compiles</span>,
<a class="br" href="#L1382" id="L1382">1382 </a>        <span class="hid">x.match</span>!(
<a class="br" href="#L1383" id="L1383">1383 </a>            (<span class="type">double</span> <span class="hid">d</span>) =&gt; <span class="str">&quot;got double&quot;</span>,
<a class="br" href="#L1384" id="L1384">1384 </a>            (<span class="type">int</span> <span class="hid">n</span>) =&gt; <span class="str">&quot;got int&quot;</span>
<a class="br" href="#L1385" id="L1385">1385 </a>        )
<a class="br" href="#L1386" id="L1386">1386 </a>    ));
<a class="br" href="#L1387" id="L1387">1387 </a>
<a class="br" href="#L1388" id="L1388">1388 </a>    <span class="com">// Solution 1: put the handler for the &quot;more specialized&quot; type (in this</span>
<a class="br" href="#L1389" id="L1389">1389 </a>    <span class="com">// case, int) before the handler for the type it converts to.</span>
<a class="br" href="#L1390" id="L1390">1390 </a>    <span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>,
<a class="br" href="#L1391" id="L1391">1391 </a>        <span class="hid">x.match</span>!(
<a class="br" href="#L1392" id="L1392">1392 </a>            (<span class="type">int</span> <span class="hid">n</span>) =&gt; <span class="str">&quot;got int&quot;</span>,
<a class="br" href="#L1393" id="L1393">1393 </a>            (<span class="type">double</span> <span class="hid">d</span>) =&gt; <span class="str">&quot;got double&quot;</span>
<a class="br" href="#L1394" id="L1394">1394 </a>        )
<a class="br" href="#L1395" id="L1395">1395 </a>    ));
<a class="br" href="#L1396" id="L1396">1396 </a>
<a class="br" href="#L1397" id="L1397">1397 </a>    <span class="com">// Solution 2: use a template that only accepts the exact type it's</span>
<a class="br" href="#L1398" id="L1398">1398 </a>    <span class="com">// supposed to match, instead of any type that implicitly converts to it.</span>
<a class="br" href="#L1399" id="L1399">1399 </a>    <span class="kwrd">alias</span> <span class="hid">exactly</span>(<span class="hid">T</span>, <span class="kwrd">alias</span> <span class="hid">fun</span>) = <span class="kwrd">function</span> (<span class="hid">arg</span>) {
<a class="br" href="#L1400" id="L1400">1400 </a>        <span class="kwrd">static</span> <span class="kwrd">assert</span>(<span class="kwrd">is</span>(<span class="kwrd">typeof</span>(<span class="hid">arg</span>) == <span class="hid">T</span>));
<a class="br" href="#L1401" id="L1401">1401 </a>        <span class="kwrd">return</span> <span class="hid">fun</span>(<span class="hid">arg</span>);
<a class="br" href="#L1402" id="L1402">1402 </a>    };
<a class="br" href="#L1403" id="L1403">1403 </a>
<a class="br" href="#L1404" id="L1404">1404 </a>    <span class="com">// Now, even if we put the double handler first, it will only be used for</span>
<a class="br" href="#L1405" id="L1405">1405 </a>    <span class="com">// doubles, not ints.</span>
<a class="br" href="#L1406" id="L1406">1406 </a>    <span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>,
<a class="br" href="#L1407" id="L1407">1407 </a>        <span class="hid">x.match</span>!(
<a class="br" href="#L1408" id="L1408">1408 </a>            <span class="hid">exactly</span>!(<span class="type">double</span>, <span class="hid">d</span> =&gt; <span class="str">&quot;got double&quot;</span>),
<a class="br" href="#L1409" id="L1409">1409 </a>            <span class="hid">exactly</span>!(<span class="type">int</span>, <span class="hid">n</span> =&gt; <span class="str">&quot;got int&quot;</span>)
<a class="br" href="#L1410" id="L1410">1410 </a>        )
<a class="br" href="#L1411" id="L1411">1411 </a>    ));
<a class="br" href="#L1412" id="L1412">1412 </a>}
<a class="br" href="#L1413" id="L1413">1413 </a>
<a class="br" href="#L1414" id="L1414">1414 </a><span class="com">/** $(H3 Multiple dispatch)
<a class="br" href="#L1415" id="L1415">1415 </a> *
<a class="br" href="#L1416" id="L1416">1416 </a> * Pattern matching can be performed on multiple `SumType`s at once by passing
<a class="br" href="#L1417" id="L1417">1417 </a> * handlers with multiple arguments. This usually leads to more concise code
<a class="br" href="#L1418" id="L1418">1418 </a> * than using nested calls to `match`, as show below.
<a class="br" href="#L1419" id="L1419">1419 </a> */</span>
<a class="br" href="#L1420" id="L1420">1420 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1421" id="L1421">1421 </a>    <span class="kwrd">struct</span> <span class="hid">Point2D</span> { <span class="type">double</span> <span class="hid">x</span>, <span class="hid">y</span>; }
<a class="br" href="#L1422" id="L1422">1422 </a>    <span class="kwrd">struct</span> <span class="hid">Point3D</span> { <span class="type">double</span> <span class="hid">x</span>, <span class="hid">y</span>, <span class="hid">z</span>; }
<a class="br" href="#L1423" id="L1423">1423 </a>
<a class="br" href="#L1424" id="L1424">1424 </a>    <span class="kwrd">alias</span> <span class="hid">Point</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">Point2D</span>, <span class="hid">Point3D</span>);
<a class="br" href="#L1425" id="L1425">1425 </a>
<a class="br" href="#L1426" id="L1426">1426 </a>    <span class="kwrd">version</span>(<span class="hid">none</span>) {
<a class="br" href="#L1427" id="L1427">1427 </a>        <span class="com">// This function works, but the code is ugly and repetitive.</span>
<a class="br" href="#L1428" id="L1428">1428 </a>        <span class="com">// It uses three separate calls to match!</span>
<a class="br" href="#L1429" id="L1429">1429 </a>        @<span class="hid">safe</span> <span class="kwrd">pure</span> <span class="kwrd">nothrow</span> @<span class="hid">nogc</span>
<a class="br" href="#L1430" id="L1430">1430 </a>        <span class="type">bool</span> <span class="hid">sameDimensions</span>(<span class="hid">Point</span> <span class="hid">p1</span>, <span class="hid">Point</span> <span class="hid">p2</span>)
<a class="br" href="#L1431" id="L1431">1431 </a>        {
<a class="br" href="#L1432" id="L1432">1432 </a>            <span class="kwrd">return</span> <span class="hid">p1.match</span>!(
<a class="br" href="#L1433" id="L1433">1433 </a>                (<span class="hid">Point2D</span> <span class="hid">_</span>) =&gt; <span class="hid">p2.match</span>!(
<a class="br" href="#L1434" id="L1434">1434 </a>                    (<span class="hid">Point2D</span> <span class="hid">_</span>) =&gt; <span class="kwrd">true</span>,
<a class="br" href="#L1435" id="L1435">1435 </a>                    <span class="hid">_</span> =&gt; <span class="kwrd">false</span>
<a class="br" href="#L1436" id="L1436">1436 </a>                ),
<a class="br" href="#L1437" id="L1437">1437 </a>                (<span class="hid">Point3D</span> <span class="hid">_</span>) =&gt; <span class="hid">p2.match</span>!(
<a class="br" href="#L1438" id="L1438">1438 </a>                    (<span class="hid">Point3D</span> <span class="hid">_</span>) =&gt; <span class="kwrd">true</span>,
<a class="br" href="#L1439" id="L1439">1439 </a>                    <span class="hid">_</span> =&gt; <span class="kwrd">false</span>
<a class="br" href="#L1440" id="L1440">1440 </a>                )
<a class="br" href="#L1441" id="L1441">1441 </a>            );
<a class="br" href="#L1442" id="L1442">1442 </a>        }
<a class="br" href="#L1443" id="L1443">1443 </a>    }
<a class="br" href="#L1444" id="L1444">1444 </a>
<a class="br" href="#L1445" id="L1445">1445 </a>    <span class="com">// This version is much nicer.</span>
<a class="br" href="#L1446" id="L1446">1446 </a>    @<span class="hid">safe</span> <span class="kwrd">pure</span> <span class="kwrd">nothrow</span> @<span class="hid">nogc</span>
<a class="br" href="#L1447" id="L1447">1447 </a>    <span class="type">bool</span> <span class="hid">sameDimensions</span>(<span class="hid">Point</span> <span class="hid">p1</span>, <span class="hid">Point</span> <span class="hid">p2</span>)
<a class="br" href="#L1448" id="L1448">1448 </a>    {
<a class="br" href="#L1449" id="L1449">1449 </a>        <span class="kwrd">alias</span> <span class="hid">doMatch</span> = <a class="hid" href="sumtype.d.html#L1352" title="sumtype.match">match</a>!(
<a class="br" href="#L1450" id="L1450">1450 </a>            (<span class="hid">Point2D</span> <span class="hid">_1</span>, <span class="hid">Point2D</span> <span class="hid">_2</span>) =&gt; <span class="kwrd">true</span>,
<a class="br" href="#L1451" id="L1451">1451 </a>            (<span class="hid">Point3D</span> <span class="hid">_1</span>, <span class="hid">Point3D</span> <span class="hid">_2</span>) =&gt; <span class="kwrd">true</span>,
<a class="br" href="#L1452" id="L1452">1452 </a>            (<span class="hid">_1</span>, <span class="hid">_2</span>) =&gt; <span class="kwrd">false</span>
<a class="br" href="#L1453" id="L1453">1453 </a>        );
<a class="br" href="#L1454" id="L1454">1454 </a>
<a class="br" href="#L1455" id="L1455">1455 </a>        <span class="kwrd">return</span> <span class="hid">doMatch</span>(<span class="hid">p1</span>, <span class="hid">p2</span>);
<a class="br" href="#L1456" id="L1456">1456 </a>    }
<a class="br" href="#L1457" id="L1457">1457 </a>
<a class="br" href="#L1458" id="L1458">1458 </a>    <span class="hid">Point</span> <span class="hid">a</span> = <span class="hid">Point2D</span>(<span class="num">1</span>, <span class="num">2</span>);
<a class="br" href="#L1459" id="L1459">1459 </a>    <span class="hid">Point</span> <span class="hid">b</span> = <span class="hid">Point2D</span>(<span class="num">3</span>, <span class="num">4</span>);
<a class="br" href="#L1460" id="L1460">1460 </a>    <span class="hid">Point</span> <span class="hid">c</span> = <span class="hid">Point3D</span>(<span class="num">5</span>, <span class="num">6</span>, <span class="num">7</span>);
<a class="br" href="#L1461" id="L1461">1461 </a>    <span class="hid">Point</span> <span class="hid">d</span> = <span class="hid">Point3D</span>(<span class="num">8</span>, <span class="num">9</span>, <span class="num">0</span>);
<a class="br" href="#L1462" id="L1462">1462 </a>
<a class="br" href="#L1463" id="L1463">1463 </a>    <span class="kwrd">assert</span>( <span class="hid">sameDimensions</span>(<span class="hid">a</span>, <span class="hid">b</span>));
<a class="br" href="#L1464" id="L1464">1464 </a>    <span class="kwrd">assert</span>( <span class="hid">sameDimensions</span>(<span class="hid">c</span>, <span class="hid">d</span>));
<a class="br" href="#L1465" id="L1465">1465 </a>    <span class="kwrd">assert</span>(!<span class="hid">sameDimensions</span>(<span class="hid">a</span>, <span class="hid">c</span>));
<a class="br" href="#L1466" id="L1466">1466 </a>    <span class="kwrd">assert</span>(!<span class="hid">sameDimensions</span>(<span class="hid">d</span>, <span class="hid">b</span>));
<a class="br" href="#L1467" id="L1467">1467 </a>}
<a class="br" href="#L1468" id="L1468">1468 </a>
<a class="br" href="#L1469" id="L1469">1469 </a><span class="com">/**
<a class="br" href="#L1470" id="L1470">1470 </a> * Attempts to call a type-appropriate function with the value held in a
<a class="br" href="#L1471" id="L1471">1471 </a> * [SumType], and throws on failure.
<a class="br" href="#L1472" id="L1472">1472 </a> *
<a class="br" href="#L1473" id="L1473">1473 </a> * Matches are chosen using the same rules as [match], but are not required to
<a class="br" href="#L1474" id="L1474">1474 </a> * be exhaustive&#8212;in other words, a type (or combination of types) is allowed to
<a class="br" href="#L1475" id="L1475">1475 </a> * have no matching handler. If a type without a handler is encountered at
<a class="br" href="#L1476" id="L1476">1476 </a> * runtime, a [MatchException] is thrown.
<a class="br" href="#L1477" id="L1477">1477 </a> *
<a class="br" href="#L1478" id="L1478">1478 </a> * Not available when compiled with `-betterC`.
<a class="br" href="#L1479" id="L1479">1479 </a> *
<a class="br" href="#L1480" id="L1480">1480 </a> * Returns:
<a class="br" href="#L1481" id="L1481">1481 </a> *   The value returned from the handler that matches the currently-held type,
<a class="br" href="#L1482" id="L1482">1482 </a> *   if a handler was given for that type.
<a class="br" href="#L1483" id="L1483">1483 </a> *
<a class="br" href="#L1484" id="L1484">1484 </a> * Throws:
<a class="br" href="#L1485" id="L1485">1485 </a> *   [MatchException], if the currently-held type has no matching handler.
<a class="br" href="#L1486" id="L1486">1486 </a> *
<a class="br" href="#L1487" id="L1487">1487 </a> * See_Also: `std.variant.tryVisit`
<a class="br" href="#L1488" id="L1488">1488 </a> */</span>
<a class="br" href="#L1489" id="L1489">1489 </a><span class="kwrd">version</span> (<span class="hid">D_Exceptions</span>)
<a class="br" href="#L1490" id="L1490">1490 </a><span class="kwrd">template</span> <a class="hid" href="sumtype.d.html#L1490" title="sumtype.tryMatch">tryMatch</a>(<span class="hid">handlers</span>...)
<a class="br" href="#L1491" id="L1491">1491 </a>{
<a class="br" href="#L1492" id="L1492">1492 </a>	<span class="kwrd">import</span> <span class="hid">std.typecons</span>: <span class="hid">No</span>;
<a class="br" href="#L1493" id="L1493">1493 </a>
<a class="br" href="#L1494" id="L1494">1494 </a>	<span class="com">/**
<a class="br" href="#L1495" id="L1495">1495 </a>	 * The actual `tryMatch` function.
<a class="br" href="#L1496" id="L1496">1496 </a>	 *
<a class="br" href="#L1497" id="L1497">1497 </a>	 * Params:
<a class="br" href="#L1498" id="L1498">1498 </a>	 *   args = One or more [SumType] objects.
<a class="br" href="#L1499" id="L1499">1499 </a>	 */</span>
<a class="br" href="#L1500" id="L1500">1500 </a>	<span class="kwrd">auto</span> <span class="kwrd">ref</span> <a class="hid" href="sumtype.d.html#L1490" title="sumtype.tryMatch">tryMatch</a>(<span class="hid">SumTypes</span>...)(<span class="kwrd">auto</span> <span class="kwrd">ref</span> <span class="hid">SumTypes</span> <span class="hid">args</span>)
<a class="br" href="#L1501" id="L1501">1501 </a>		<span class="kwrd">if</span> (<span class="hid">allSatisfy</span>!(<a class="hid" href="sumtype.d.html#L1300" title="sumtype.isSumType">isSumType</a>, <span class="hid">SumTypes</span>) &amp;&amp; <span class="hid">args.length</span> &gt; <span class="num">0</span>)
<a class="br" href="#L1502" id="L1502">1502 </a>	{
<a class="br" href="#L1503" id="L1503">1503 </a>		<span class="kwrd">return</span> <a class="hid" href="sumtype.d.html#L1563" title="sumtype.matchImpl">matchImpl</a>!(<span class="hid">No.exhaustive</span>, <span class="hid">handlers</span>)(<span class="hid">args</span>);
<a class="br" href="#L1504" id="L1504">1504 </a>	}
<a class="br" href="#L1505" id="L1505">1505 </a>}
<a class="br" href="#L1506" id="L1506">1506 </a>
<a class="br" href="#L1507" id="L1507">1507 </a><span class="com">/**
<a class="br" href="#L1508" id="L1508">1508 </a> * Thrown by [tryMatch] when an unhandled type is encountered.
<a class="br" href="#L1509" id="L1509">1509 </a> *
<a class="br" href="#L1510" id="L1510">1510 </a> * Not available when compiled with `-betterC`.
<a class="br" href="#L1511" id="L1511">1511 </a> */</span>
<a class="br" href="#L1512" id="L1512">1512 </a><span class="kwrd">version</span> (<span class="hid">D_Exceptions</span>)
<a class="br" href="#L1513" id="L1513">1513 </a><span class="kwrd">class</span> <a class="hid" href="sumtype.d.html#L1513" title="sumtype.MatchException">MatchException</a> : <span class="hid">Exception</span>
<a class="br" href="#L1514" id="L1514">1514 </a>{
<a class="br" href="#L1515" id="L1515">1515 </a>	<span class="com">///</span>
<a class="br" href="#L1516" id="L1516">1516 </a>	<span class="kwrd">pure</span> @<span class="hid">safe</span> @<span class="hid">nogc</span> <span class="kwrd">nothrow</span>
<a class="br" href="#L1517" id="L1517">1517 </a>	<span class="kwrd">this</span>(<span class="type">string</span> <span class="hid">msg</span>, <span class="type">string</span> <span class="hid">file</span> = <span class="kwrd">__FILE__</span>, <span class="hid">size_t</span> <span class="hid">line</span> = <span class="kwrd">__LINE__</span>)
<a class="br" href="#L1518" id="L1518">1518 </a>	{
<a class="br" href="#L1519" id="L1519">1519 </a>		<span class="kwrd">super</span>(<span class="hid">msg</span>, <span class="hid">file</span>, <span class="hid">line</span>);
<a class="br" href="#L1520" id="L1520">1520 </a>	}
<a class="br" href="#L1521" id="L1521">1521 </a>}
<a class="br" href="#L1522" id="L1522">1522 </a>
<a class="br" href="#L1523" id="L1523">1523 </a><span class="com">/**
<a class="br" href="#L1524" id="L1524">1524 </a> * True if `handler` is a potential match for `Ts`, otherwise false.
<a class="br" href="#L1525" id="L1525">1525 </a> *
<a class="br" href="#L1526" id="L1526">1526 </a> * See the documentation for [match] for a full explanation of how matches are
<a class="br" href="#L1527" id="L1527">1527 </a> * chosen.
<a class="br" href="#L1528" id="L1528">1528 </a> */</span>
<a class="br" href="#L1529" id="L1529">1529 </a><span class="kwrd">template</span> <a class="hid" href="sumtype.d.html#L1529" title="sumtype.canMatch">canMatch</a>(<span class="kwrd">alias</span> <span class="hid">handler</span>, <span class="hid">Ts</span>...)
<a class="br" href="#L1530" id="L1530">1530 </a>	<span class="kwrd">if</span> (<span class="hid">Ts.length</span> &gt; <span class="num">0</span>)
<a class="br" href="#L1531" id="L1531">1531 </a>{
<a class="br" href="#L1532" id="L1532">1532 </a>	<span class="kwrd">enum</span> <a class="hid" href="sumtype.d.html#L1529" title="sumtype.canMatch">canMatch</a> = <span class="kwrd">is</span>(<span class="kwrd">typeof</span>((<span class="hid">Ts</span> <span class="hid">args</span>) =&gt; <span class="hid">handler</span>(<span class="hid">args</span>)));
<a class="br" href="#L1533" id="L1533">1533 </a>}
<a class="br" href="#L1534" id="L1534">1534 </a>
<a class="br" href="#L1535" id="L1535">1535 </a><span class="com">// Includes all overloads of the given handler</span>
<a class="br" href="#L1536" id="L1536">1536 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1537" id="L1537">1537 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">OverloadSet</span>
<a class="br" href="#L1538" id="L1538">1538 </a>	{
<a class="br" href="#L1539" id="L1539">1539 </a>		<span class="kwrd">static</span> <span class="type">void</span> <span class="hid">fun</span>(<span class="type">int</span> <span class="hid">n</span>) {}
<a class="br" href="#L1540" id="L1540">1540 </a>		<span class="kwrd">static</span> <span class="type">void</span> <span class="hid">fun</span>(<span class="type">double</span> <span class="hid">d</span>) {}
<a class="br" href="#L1541" id="L1541">1541 </a>	}
<a class="br" href="#L1542" id="L1542">1542 </a>
<a class="br" href="#L1543" id="L1543">1543 </a>	<span class="kwrd">assert</span>(<a class="hid" href="sumtype.d.html#L1529" title="sumtype.canMatch">canMatch</a>!(<span class="hid">OverloadSet.fun</span>, <span class="type">int</span>));
<a class="br" href="#L1544" id="L1544">1544 </a>	<span class="kwrd">assert</span>(<a class="hid" href="sumtype.d.html#L1529" title="sumtype.canMatch">canMatch</a>!(<span class="hid">OverloadSet.fun</span>, <span class="type">double</span>));
<a class="br" href="#L1545" id="L1545">1545 </a>}
<a class="br" href="#L1546" id="L1546">1546 </a>
<a class="br" href="#L1547" id="L1547">1547 </a><span class="com">// Like aliasSeqOf!(iota(n)), but works in BetterC</span>
<a class="br" href="#L1548" id="L1548">1548 </a><span class="kwrd">private</span> <span class="kwrd">template</span> <a class="hid" href="sumtype.d.html#L1548" title="sumtype.Iota">Iota</a>(<span class="hid">size_t</span> <span class="hid">n</span>)
<a class="br" href="#L1549" id="L1549">1549 </a>{
<a class="br" href="#L1550" id="L1550">1550 </a>	<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="hid">n</span> == <span class="num">0</span>) {
<a class="br" href="#L1551" id="L1551">1551 </a>		<span class="kwrd">alias</span> <a class="hid" href="sumtype.d.html#L1548" title="sumtype.Iota">Iota</a> = <span class="hid">AliasSeq</span>!();
<a class="br" href="#L1552" id="L1552">1552 </a>	} <span class="kwrd">else</span> {
<a class="br" href="#L1553" id="L1553">1553 </a>		<span class="kwrd">alias</span> <a class="hid" href="sumtype.d.html#L1548" title="sumtype.Iota">Iota</a> = <span class="hid">AliasSeq</span>!(<a class="hid" href="sumtype.d.html#L1548" title="sumtype.Iota">Iota</a>!(<span class="hid">n</span> - <span class="num">1</span>), <span class="hid">n</span> - <span class="num">1</span>);
<a class="br" href="#L1554" id="L1554">1554 </a>	}
<a class="br" href="#L1555" id="L1555">1555 </a>}
<a class="br" href="#L1556" id="L1556">1556 </a>
<a class="br" href="#L1557" id="L1557">1557 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1558" id="L1558">1558 </a>	<span class="kwrd">assert</span>(<span class="kwrd">is</span>(<a class="hid" href="sumtype.d.html#L1548" title="sumtype.Iota">Iota</a>!<span class="num">0</span> == <span class="hid">AliasSeq</span>!()));
<a class="br" href="#L1559" id="L1559">1559 </a>	<span class="kwrd">assert</span>(<a class="hid" href="sumtype.d.html#L1548" title="sumtype.Iota">Iota</a>!<span class="num">1</span> == <span class="hid">AliasSeq</span>!(<span class="num">0</span>));
<a class="br" href="#L1560" id="L1560">1560 </a>	<span class="kwrd">assert</span>(<a class="hid" href="sumtype.d.html#L1548" title="sumtype.Iota">Iota</a>!<span class="num">3</span> == <span class="hid">AliasSeq</span>!(<span class="num">0</span>, <span class="num">1</span>, <span class="num">2</span>));
<a class="br" href="#L1561" id="L1561">1561 </a>}
<a class="br" href="#L1562" id="L1562">1562 </a>
<a class="br" href="#L1563" id="L1563">1563 </a><span class="kwrd">private</span> <span class="kwrd">template</span> <a class="hid" href="sumtype.d.html#L1563" title="sumtype.matchImpl">matchImpl</a>(<span class="hid">Flag</span>!<span class="str">&quot;exhaustive&quot;</span> <span class="hid">exhaustive</span>, <span class="hid">handlers</span>...)
<a class="br" href="#L1564" id="L1564">1564 </a>{
<a class="br" href="#L1565" id="L1565">1565 </a>	<span class="kwrd">auto</span> <span class="kwrd">ref</span> <a class="hid" href="sumtype.d.html#L1563" title="sumtype.matchImpl">matchImpl</a>(<span class="hid">SumTypes</span>...)(<span class="kwrd">auto</span> <span class="kwrd">ref</span> <span class="hid">SumTypes</span> <span class="hid">args</span>)
<a class="br" href="#L1566" id="L1566">1566 </a>		<span class="kwrd">if</span> (<span class="hid">allSatisfy</span>!(<a class="hid" href="sumtype.d.html#L1300" title="sumtype.isSumType">isSumType</a>, <span class="hid">SumTypes</span>) &amp;&amp; <span class="hid">args.length</span> &gt; <span class="num">0</span>)
<a class="br" href="#L1567" id="L1567">1567 </a>	{
<a class="br" href="#L1568" id="L1568">1568 </a>		<span class="com">/* The number that the dim-th argument's tag is multiplied by when
<a class="br" href="#L1569" id="L1569">1569 </a>		 * converting TagTuples to and from case indices (&quot;caseIds&quot;).
<a class="br" href="#L1570" id="L1570">1570 </a>		 *
<a class="br" href="#L1571" id="L1571">1571 </a>		 * Named by analogy to the stride that the dim-th index into a
<a class="br" href="#L1572" id="L1572">1572 </a>		 * multidimensional static array is multiplied by to calculate the
<a class="br" href="#L1573" id="L1573">1573 </a>		 * offset of a specific element.
<a class="br" href="#L1574" id="L1574">1574 </a>		 */</span>
<a class="br" href="#L1575" id="L1575">1575 </a>		<span class="kwrd">static</span> <span class="hid">size_t</span> <span class="hid">stride</span>(<span class="hid">size_t</span> <span class="hid">dim</span>)()
<a class="br" href="#L1576" id="L1576">1576 </a>		{
<a class="br" href="#L1577" id="L1577">1577 </a>			<span class="kwrd">import</span> <span class="hid">core.checkedint</span>: <span class="hid">mulu</span>;
<a class="br" href="#L1578" id="L1578">1578 </a>
<a class="br" href="#L1579" id="L1579">1579 </a>			<span class="hid">size_t</span> <span class="hid">result</span> = <span class="num">1</span>;
<a class="br" href="#L1580" id="L1580">1580 </a>			<span class="type">bool</span> <span class="hid">overflow</span> = <span class="kwrd">false</span>;
<a class="br" href="#L1581" id="L1581">1581 </a>
<a class="br" href="#L1582" id="L1582">1582 </a>			<span class="kwrd">static</span> <span class="kwrd">foreach</span> (<span class="hid">S</span>; <span class="hid">SumTypes</span>[<span class="num">0</span> .. <span class="hid">dim</span>]) {
<a class="br" href="#L1583" id="L1583">1583 </a>				<span class="hid">result</span> = <span class="hid">mulu</span>(<span class="hid">result</span>, <span class="hid">S.Types.length</span>, <span class="hid">overflow</span>);
<a class="br" href="#L1584" id="L1584">1584 </a>			}
<a class="br" href="#L1585" id="L1585">1585 </a>
<a class="br" href="#L1586" id="L1586">1586 </a>			<span class="com">/* The largest number matchImpl uses, numCases, is calculated with
<a class="br" href="#L1587" id="L1587">1587 </a>			 * stride!(SumTypes.length), so as long as this overflow check
<a class="br" href="#L1588" id="L1588">1588 </a>			 * passes, we don't need to check for overflow anywhere else.
<a class="br" href="#L1589" id="L1589">1589 </a>			 */</span>
<a class="br" href="#L1590" id="L1590">1590 </a>			<span class="kwrd">assert</span>(!<span class="hid">overflow</span>);
<a class="br" href="#L1591" id="L1591">1591 </a>			<span class="kwrd">return</span> <span class="hid">result</span>;
<a class="br" href="#L1592" id="L1592">1592 </a>		}
<a class="br" href="#L1593" id="L1593">1593 </a>
<a class="br" href="#L1594" id="L1594">1594 </a>		<span class="com">/* A TagTuple represents a single possible set of tags that `args`
<a class="br" href="#L1595" id="L1595">1595 </a>		 * could have at runtime.
<a class="br" href="#L1596" id="L1596">1596 </a>		 *
<a class="br" href="#L1597" id="L1597">1597 </a>		 * Because D does not allow a struct to be the controlling expression
<a class="br" href="#L1598" id="L1598">1598 </a>		 * of a switch statement, we cannot dispatch on the TagTuple directly.
<a class="br" href="#L1599" id="L1599">1599 </a>		 * Instead, we must map each TagTuple to a unique integer and generate
<a class="br" href="#L1600" id="L1600">1600 </a>		 * a case label for each of those integers. This mapping is implemented
<a class="br" href="#L1601" id="L1601">1601 </a>		 * in `fromCaseId` and `toCaseId`.
<a class="br" href="#L1602" id="L1602">1602 </a>		 *
<a class="br" href="#L1603" id="L1603">1603 </a>		 * The mapping is done by pretending we are indexing into an
<a class="br" href="#L1604" id="L1604">1604 </a>		 * `args.length`-dimensional static array of type
<a class="br" href="#L1605" id="L1605">1605 </a>		 *
<a class="br" href="#L1606" id="L1606">1606 </a>		 *   ubyte[SumTypes[0].Types.length]...[SumTypes[$-1].Types.length]
<a class="br" href="#L1607" id="L1607">1607 </a>		 *
<a class="br" href="#L1608" id="L1608">1608 </a>		 * ...where each element corresponds to the TagTuple whose tags can be
<a class="br" href="#L1609" id="L1609">1609 </a>		 * used (in reverse order) as indices to retrieve it. The caseId for
<a class="br" href="#L1610" id="L1610">1610 </a>		 * that TagTuple is the (hypothetical) offset, in bytes, of its
<a class="br" href="#L1611" id="L1611">1611 </a>		 * corresponding element.
<a class="br" href="#L1612" id="L1612">1612 </a>		 *
<a class="br" href="#L1613" id="L1613">1613 </a>		 * For example, when `args` consists of two SumTypes with two member
<a class="br" href="#L1614" id="L1614">1614 </a>		 * types each, the TagTuples corresponding to each case label are:
<a class="br" href="#L1615" id="L1615">1615 </a>		 *
<a class="br" href="#L1616" id="L1616">1616 </a>		 *   case 0:  TagTuple([0, 0])
<a class="br" href="#L1617" id="L1617">1617 </a>		 *   case 1:  TagTuple([1, 0])
<a class="br" href="#L1618" id="L1618">1618 </a>		 *   case 2:  TagTuple([0, 1])
<a class="br" href="#L1619" id="L1619">1619 </a>		 *   case 3:  TagTuple([1, 1])
<a class="br" href="#L1620" id="L1620">1620 </a>		 */</span>
<a class="br" href="#L1621" id="L1621">1621 </a>		<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">TagTuple</span>
<a class="br" href="#L1622" id="L1622">1622 </a>		{
<a class="br" href="#L1623" id="L1623">1623 </a>			<span class="hid">size_t</span>[<span class="hid">SumTypes.length</span>] <span class="hid">tags</span>;
<a class="br" href="#L1624" id="L1624">1624 </a>			<span class="kwrd">alias</span> <span class="hid">tags</span> <span class="kwrd">this</span>;
<a class="br" href="#L1625" id="L1625">1625 </a>
<a class="br" href="#L1626" id="L1626">1626 </a>			<span class="kwrd">invariant</span> {
<a class="br" href="#L1627" id="L1627">1627 </a>				<span class="kwrd">static</span> <span class="kwrd">foreach</span> (<span class="hid">i</span>; <span class="num">0</span> .. <span class="hid">tags.length</span>) {
<a class="br" href="#L1628" id="L1628">1628 </a>					<span class="kwrd">assert</span>(<span class="hid">tags</span>[<span class="hid">i</span>] &lt; <span class="hid">SumTypes</span>[<span class="hid">i</span>].<span class="hid">Types.length</span>);
<a class="br" href="#L1629" id="L1629">1629 </a>				}
<a class="br" href="#L1630" id="L1630">1630 </a>			}
<a class="br" href="#L1631" id="L1631">1631 </a>
<a class="br" href="#L1632" id="L1632">1632 </a>			<span class="kwrd">this</span>(<span class="kwrd">ref</span> <span class="kwrd">const</span>(<span class="hid">SumTypes</span>) <span class="hid">args</span>)
<a class="br" href="#L1633" id="L1633">1633 </a>			{
<a class="br" href="#L1634" id="L1634">1634 </a>				<span class="kwrd">static</span> <span class="kwrd">foreach</span> (<span class="hid">i</span>; <span class="num">0</span> .. <span class="hid">tags.length</span>) {
<a class="br" href="#L1635" id="L1635">1635 </a>					<span class="hid">tags</span>[<span class="hid">i</span>] = <span class="hid">args</span>[<span class="hid">i</span>].<span class="hid">tag</span>;
<a class="br" href="#L1636" id="L1636">1636 </a>				}
<a class="br" href="#L1637" id="L1637">1637 </a>			}
<a class="br" href="#L1638" id="L1638">1638 </a>
<a class="br" href="#L1639" id="L1639">1639 </a>			<span class="kwrd">static</span> <span class="hid">TagTuple</span> <span class="hid">fromCaseId</span>(<span class="hid">size_t</span> <span class="hid">caseId</span>)
<a class="br" href="#L1640" id="L1640">1640 </a>			{
<a class="br" href="#L1641" id="L1641">1641 </a>				<span class="hid">TagTuple</span> <span class="hid">result</span>;
<a class="br" href="#L1642" id="L1642">1642 </a>
<a class="br" href="#L1643" id="L1643">1643 </a>				<span class="com">// Most-significant to least-significant</span>
<a class="br" href="#L1644" id="L1644">1644 </a>				<span class="kwrd">static</span> <span class="kwrd">foreach_reverse</span> (<span class="hid">i</span>; <span class="num">0</span> .. <span class="hid">result.length</span>) {
<a class="br" href="#L1645" id="L1645">1645 </a>					<span class="hid">result</span>[<span class="hid">i</span>] = <span class="hid">caseId</span> / <span class="hid">stride</span>!<span class="hid">i</span>;
<a class="br" href="#L1646" id="L1646">1646 </a>					<span class="hid">caseId</span> %= <span class="hid">stride</span>!<span class="hid">i</span>;
<a class="br" href="#L1647" id="L1647">1647 </a>				}
<a class="br" href="#L1648" id="L1648">1648 </a>
<a class="br" href="#L1649" id="L1649">1649 </a>				<span class="kwrd">return</span> <span class="hid">result</span>;
<a class="br" href="#L1650" id="L1650">1650 </a>			}
<a class="br" href="#L1651" id="L1651">1651 </a>
<a class="br" href="#L1652" id="L1652">1652 </a>			<span class="hid">size_t</span> <span class="hid">toCaseId</span>()
<a class="br" href="#L1653" id="L1653">1653 </a>			{
<a class="br" href="#L1654" id="L1654">1654 </a>				<span class="hid">size_t</span> <span class="hid">result</span>;
<a class="br" href="#L1655" id="L1655">1655 </a>
<a class="br" href="#L1656" id="L1656">1656 </a>				<span class="kwrd">static</span> <span class="kwrd">foreach</span> (<span class="hid">i</span>; <span class="num">0</span> .. <span class="hid">tags.length</span>) {
<a class="br" href="#L1657" id="L1657">1657 </a>					<span class="hid">result</span> += <span class="hid">tags</span>[<span class="hid">i</span>] * <span class="hid">stride</span>!<span class="hid">i</span>;
<a class="br" href="#L1658" id="L1658">1658 </a>				}
<a class="br" href="#L1659" id="L1659">1659 </a>
<a class="br" href="#L1660" id="L1660">1660 </a>				<span class="kwrd">return</span> <span class="hid">result</span>;
<a class="br" href="#L1661" id="L1661">1661 </a>			}
<a class="br" href="#L1662" id="L1662">1662 </a>		}
<a class="br" href="#L1663" id="L1663">1663 </a>
<a class="br" href="#L1664" id="L1664">1664 </a>		<span class="com">/* An AliasSeq of zero-argument functions that return, by ref, the
<a class="br" href="#L1665" id="L1665">1665 </a>		 * member values of `args` needed for the case labeled with `caseId`.
<a class="br" href="#L1666" id="L1666">1666 </a>		 *
<a class="br" href="#L1667" id="L1667">1667 </a>		 * When used in an expression context (like, say, a function call), it
<a class="br" href="#L1668" id="L1668">1668 </a>		 * will instead be interpreted as a sequence of zero-argument function
<a class="br" href="#L1669" id="L1669">1669 </a>		 * *calls*, with optional parentheses omitted.
<a class="br" href="#L1670" id="L1670">1670 </a>		 */</span>
<a class="br" href="#L1671" id="L1671">1671 </a>		<span class="kwrd">template</span> <span class="hid">values</span>(<span class="hid">size_t</span> <span class="hid">caseId</span>)
<a class="br" href="#L1672" id="L1672">1672 </a>		{
<a class="br" href="#L1673" id="L1673">1673 </a>			<span class="kwrd">enum</span> <span class="hid">tags</span> = <span class="hid">TagTuple.fromCaseId</span>(<span class="hid">caseId</span>);
<a class="br" href="#L1674" id="L1674">1674 </a>
<a class="br" href="#L1675" id="L1675">1675 </a>			<span class="com">// Workaround for dlang issue 21348</span>
<a class="br" href="#L1676" id="L1676">1676 </a>			<span class="kwrd">ref</span> <span class="hid">getValue</span>(<span class="hid">size_t</span> <span class="hid">i</span>)(<span class="kwrd">ref</span> <span class="hid">SumTypes</span>[<span class="hid">i</span>] <span class="hid">arg</span> = <span class="hid">args</span>[<span class="hid">i</span>])
<a class="br" href="#L1677" id="L1677">1677 </a>			{
<a class="br" href="#L1678" id="L1678">1678 </a>				<span class="kwrd">enum</span> <span class="hid">tid</span> = <span class="hid">tags</span>[<span class="hid">i</span>];
<a class="br" href="#L1679" id="L1679">1679 </a>				<span class="kwrd">alias</span> <span class="hid">T</span> = <span class="hid">SumTypes</span>[<span class="hid">i</span>].<span class="hid">Types</span>[<span class="hid">tid</span>];
<a class="br" href="#L1680" id="L1680">1680 </a>				<span class="kwrd">return</span> <span class="hid">arg.get</span>!<span class="hid">T</span>;
<a class="br" href="#L1681" id="L1681">1681 </a>			}
<a class="br" href="#L1682" id="L1682">1682 </a>
<a class="br" href="#L1683" id="L1683">1683 </a>			<span class="kwrd">alias</span> <span class="hid">values</span> = <span class="hid">Map</span>!(<span class="hid">getValue</span>, <a class="hid" href="sumtype.d.html#L1548" title="sumtype.Iota">Iota</a>!(<span class="hid">tags.length</span>));
<a class="br" href="#L1684" id="L1684">1684 </a>		}
<a class="br" href="#L1685" id="L1685">1685 </a>
<a class="br" href="#L1686" id="L1686">1686 </a>		<span class="com">/* An AliasSeq of the types of the member values returned by the
<a class="br" href="#L1687" id="L1687">1687 </a>		 * functions in `values!caseId`.
<a class="br" href="#L1688" id="L1688">1688 </a>		 *
<a class="br" href="#L1689" id="L1689">1689 </a>		 * Note that these are the actual (that is, qualified) types of the
<a class="br" href="#L1690" id="L1690">1690 </a>		 * member values, which may not be the same as the types listed in
<a class="br" href="#L1691" id="L1691">1691 </a>		 * the arguments' `.Types` properties.
<a class="br" href="#L1692" id="L1692">1692 </a>		 *
<a class="br" href="#L1693" id="L1693">1693 </a>		 * typeof(values!caseId) won't work because it gives the types
<a class="br" href="#L1694" id="L1694">1694 </a>		 * of the functions, not the return values (even with @property).
<a class="br" href="#L1695" id="L1695">1695 </a>		 */</span>
<a class="br" href="#L1696" id="L1696">1696 </a>		<span class="kwrd">template</span> <span class="hid">valueTypes</span>(<span class="hid">size_t</span> <span class="hid">caseId</span>)
<a class="br" href="#L1697" id="L1697">1697 </a>		{
<a class="br" href="#L1698" id="L1698">1698 </a>			<span class="kwrd">enum</span> <span class="hid">tags</span> = <span class="hid">TagTuple.fromCaseId</span>(<span class="hid">caseId</span>);
<a class="br" href="#L1699" id="L1699">1699 </a>
<a class="br" href="#L1700" id="L1700">1700 </a>			<span class="kwrd">template</span> <span class="hid">getType</span>(<span class="hid">size_t</span> <span class="hid">i</span>)
<a class="br" href="#L1701" id="L1701">1701 </a>			{
<a class="br" href="#L1702" id="L1702">1702 </a>				<span class="kwrd">enum</span> <span class="hid">tid</span> = <span class="hid">tags</span>[<span class="hid">i</span>];
<a class="br" href="#L1703" id="L1703">1703 </a>				<span class="kwrd">alias</span> <span class="hid">T</span> = <span class="hid">SumTypes</span>[<span class="hid">i</span>].<span class="hid">Types</span>[<span class="hid">tid</span>];
<a class="br" href="#L1704" id="L1704">1704 </a>				<span class="kwrd">alias</span> <span class="hid">getType</span> = <span class="kwrd">typeof</span>(<span class="hid">args</span>[<span class="hid">i</span>].<span class="hid">get</span>!<span class="hid">T</span>());
<a class="br" href="#L1705" id="L1705">1705 </a>			}
<a class="br" href="#L1706" id="L1706">1706 </a>
<a class="br" href="#L1707" id="L1707">1707 </a>			<span class="kwrd">alias</span> <span class="hid">valueTypes</span> = <span class="hid">Map</span>!(<span class="hid">getType</span>, <a class="hid" href="sumtype.d.html#L1548" title="sumtype.Iota">Iota</a>!(<span class="hid">tags.length</span>));
<a class="br" href="#L1708" id="L1708">1708 </a>		}
<a class="br" href="#L1709" id="L1709">1709 </a>
<a class="br" href="#L1710" id="L1710">1710 </a>		<span class="com">/* The total number of cases is
<a class="br" href="#L1711" id="L1711">1711 </a>		 *
<a class="br" href="#L1712" id="L1712">1712 </a>		 *   &#928; SumTypes[i].Types.length for 0 &#8804; i &lt; SumTypes.length
<a class="br" href="#L1713" id="L1713">1713 </a>		 *
<a class="br" href="#L1714" id="L1714">1714 </a>		 * Or, equivalently,
<a class="br" href="#L1715" id="L1715">1715 </a>		 *
<a class="br" href="#L1716" id="L1716">1716 </a>		 *   ubyte[SumTypes[0].Types.length]...[SumTypes[$-1].Types.length].sizeof
<a class="br" href="#L1717" id="L1717">1717 </a>		 *
<a class="br" href="#L1718" id="L1718">1718 </a>		 * Conveniently, this is equal to stride!(SumTypes.length), so we can
<a class="br" href="#L1719" id="L1719">1719 </a>		 * use that function to compute it.
<a class="br" href="#L1720" id="L1720">1720 </a>		 */</span>
<a class="br" href="#L1721" id="L1721">1721 </a>		<span class="kwrd">enum</span> <span class="hid">numCases</span> = <span class="hid">stride</span>!(<span class="hid">SumTypes.length</span>);
<a class="br" href="#L1722" id="L1722">1722 </a>
<a class="br" href="#L1723" id="L1723">1723 </a>		<span class="com">/* Guaranteed to never be a valid handler index, since
<a class="br" href="#L1724" id="L1724">1724 </a>		 * handlers.length &lt;= size_t.max.
<a class="br" href="#L1725" id="L1725">1725 </a>		 */</span>
<a class="br" href="#L1726" id="L1726">1726 </a>		<span class="kwrd">enum</span> <span class="hid">noMatch</span> = <span class="hid">size_t.max</span>;
<a class="br" href="#L1727" id="L1727">1727 </a>
<a class="br" href="#L1728" id="L1728">1728 </a>		<span class="com">// An array that maps caseIds to handler indices (&quot;hids&quot;).</span>
<a class="br" href="#L1729" id="L1729">1729 </a>		<span class="kwrd">enum</span> <span class="hid">matches</span> = () {
<a class="br" href="#L1730" id="L1730">1730 </a>			<span class="hid">size_t</span>[<span class="hid">numCases</span>] <span class="hid">matches</span>;
<a class="br" href="#L1731" id="L1731">1731 </a>
<a class="br" href="#L1732" id="L1732">1732 </a>			<span class="com">// Workaround for dlang issue 19561</span>
<a class="br" href="#L1733" id="L1733">1733 </a>			<span class="kwrd">foreach</span> (<span class="kwrd">ref</span> <a class="hid" href="sumtype.d.html#L1352" title="sumtype.match">match</a>; <span class="hid">matches</span>) {
<a class="br" href="#L1734" id="L1734">1734 </a>				<a class="hid" href="sumtype.d.html#L1352" title="sumtype.match">match</a> = <span class="hid">noMatch</span>;
<a class="br" href="#L1735" id="L1735">1735 </a>			}
<a class="br" href="#L1736" id="L1736">1736 </a>
<a class="br" href="#L1737" id="L1737">1737 </a>			<span class="kwrd">static</span> <span class="kwrd">foreach</span> (<span class="hid">caseId</span>; <span class="num">0</span> .. <span class="hid">numCases</span>) {
<a class="br" href="#L1738" id="L1738">1738 </a>				<span class="kwrd">static</span> <span class="kwrd">foreach</span> (<span class="hid">hid</span>, <span class="hid">handler</span>; <span class="hid">handlers</span>) {
<a class="br" href="#L1739" id="L1739">1739 </a>					<span class="kwrd">static</span> <span class="kwrd">if</span> (<a class="hid" href="sumtype.d.html#L1529" title="sumtype.canMatch">canMatch</a>!(<span class="hid">handler</span>, <span class="hid">valueTypes</span>!<span class="hid">caseId</span>)) {
<a class="br" href="#L1740" id="L1740">1740 </a>						<span class="kwrd">if</span> (<span class="hid">matches</span>[<span class="hid">caseId</span>] == <span class="hid">noMatch</span>) {
<a class="br" href="#L1741" id="L1741">1741 </a>							<span class="hid">matches</span>[<span class="hid">caseId</span>] = <span class="hid">hid</span>;
<a class="br" href="#L1742" id="L1742">1742 </a>						}
<a class="br" href="#L1743" id="L1743">1743 </a>					}
<a class="br" href="#L1744" id="L1744">1744 </a>				}
<a class="br" href="#L1745" id="L1745">1745 </a>			}
<a class="br" href="#L1746" id="L1746">1746 </a>
<a class="br" href="#L1747" id="L1747">1747 </a>			<span class="kwrd">return</span> <span class="hid">matches</span>;
<a class="br" href="#L1748" id="L1748">1748 </a>		}();
<a class="br" href="#L1749" id="L1749">1749 </a>
<a class="br" href="#L1750" id="L1750">1750 </a>		<span class="kwrd">import</span> <span class="hid">std.algorithm.searching</span>: <span class="hid">canFind</span>;
<a class="br" href="#L1751" id="L1751">1751 </a>
<a class="br" href="#L1752" id="L1752">1752 </a>		<span class="com">// Check for unreachable handlers</span>
<a class="br" href="#L1753" id="L1753">1753 </a>		<span class="kwrd">static</span> <span class="kwrd">foreach</span> (<span class="hid">hid</span>, <span class="hid">handler</span>; <span class="hid">handlers</span>) {
<a class="br" href="#L1754" id="L1754">1754 </a>			<span class="kwrd">static</span> <span class="kwrd">assert</span>(<span class="hid">matches</span>[].<span class="hid">canFind</span>(<span class="hid">hid</span>),
<a class="br" href="#L1755" id="L1755">1755 </a>				<span class="str">&quot;`handlers[&quot;</span> ~ <a class="hid" href="sumtype.d.html#L247" title="sumtype.toCtString">toCtString</a>!<span class="hid">hid</span> ~ <span class="str">&quot;]` &quot;</span> ~
<a class="br" href="#L1756" id="L1756">1756 </a>				<span class="str">&quot;of type `&quot;</span> ~ ( <span class="kwrd">__traits</span>(<span class="hid">isTemplate</span>, <span class="hid">handler</span>)
<a class="br" href="#L1757" id="L1757">1757 </a>					? <span class="str">&quot;template&quot;</span>
<a class="br" href="#L1758" id="L1758">1758 </a>					: <span class="kwrd">typeof</span>(<span class="hid">handler</span>).<span class="hid">stringof</span>
<a class="br" href="#L1759" id="L1759">1759 </a>				) ~ <span class="str">&quot;` &quot;</span> ~
<a class="br" href="#L1760" id="L1760">1760 </a>				<span class="str">&quot;never matches&quot;</span>
<a class="br" href="#L1761" id="L1761">1761 </a>			);
<a class="br" href="#L1762" id="L1762">1762 </a>		}
<a class="br" href="#L1763" id="L1763">1763 </a>
<a class="br" href="#L1764" id="L1764">1764 </a>		<span class="com">// Workaround for dlang issue 19993</span>
<a class="br" href="#L1765" id="L1765">1765 </a>		<span class="kwrd">enum</span> <span class="hid">handlerName</span>(<span class="hid">size_t</span> <span class="hid">hid</span>) = <span class="str">&quot;handler&quot;</span> ~ <a class="hid" href="sumtype.d.html#L247" title="sumtype.toCtString">toCtString</a>!<span class="hid">hid</span>;
<a class="br" href="#L1766" id="L1766">1766 </a>
<a class="br" href="#L1767" id="L1767">1767 </a>		<span class="kwrd">static</span> <span class="kwrd">foreach</span> (<span class="hid">size_t</span> <span class="hid">hid</span>, <span class="hid">handler</span>; <span class="hid">handlers</span>) {
<a class="br" href="#L1768" id="L1768">1768 </a>			<span class="kwrd">mixin</span>(<span class="str">&quot;alias &quot;</span>, <span class="hid">handlerName</span>!<span class="hid">hid</span>, <span class="str">&quot; = handler;&quot;</span>);
<a class="br" href="#L1769" id="L1769">1769 </a>		}
<a class="br" href="#L1770" id="L1770">1770 </a>
<a class="br" href="#L1771" id="L1771">1771 </a>		<span class="kwrd">immutable</span> <span class="hid">argsId</span> = <span class="hid">TagTuple</span>(<span class="hid">args</span>).<span class="hid">toCaseId</span>;
<a class="br" href="#L1772" id="L1772">1772 </a>
<a class="br" href="#L1773" id="L1773">1773 </a>		<span class="kwrd">final</span> <span class="kwrd">switch</span> (<span class="hid">argsId</span>) {
<a class="br" href="#L1774" id="L1774">1774 </a>			<span class="kwrd">static</span> <span class="kwrd">foreach</span> (<span class="hid">caseId</span>; <span class="num">0</span> .. <span class="hid">numCases</span>) {
<a class="br" href="#L1775" id="L1775">1775 </a>				<span class="kwrd">case</span> <span class="hid">caseId</span>:
<a class="br" href="#L1776" id="L1776">1776 </a>					<span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="hid">matches</span>[<span class="hid">caseId</span>] != <span class="hid">noMatch</span>) {
<a class="br" href="#L1777" id="L1777">1777 </a>						<span class="kwrd">return</span> <span class="kwrd">mixin</span>(<span class="hid">handlerName</span>!(<span class="hid">matches</span>[<span class="hid">caseId</span>]))(<span class="hid">values</span>!<span class="hid">caseId</span>);
<a class="br" href="#L1778" id="L1778">1778 </a>					} <span class="kwrd">else</span> {
<a class="br" href="#L1779" id="L1779">1779 </a>						<span class="kwrd">static</span> <span class="kwrd">if</span>(<span class="hid">exhaustive</span>) {
<a class="br" href="#L1780" id="L1780">1780 </a>							<span class="kwrd">static</span> <span class="kwrd">assert</span>(<span class="kwrd">false</span>,
<a class="br" href="#L1781" id="L1781">1781 </a>								<span class="str">&quot;No matching handler for types `&quot;</span> ~ <span class="hid">valueTypes</span>!<span class="hid">caseId.stringof</span> ~ <span class="str">&quot;`&quot;</span>);
<a class="br" href="#L1782" id="L1782">1782 </a>						} <span class="kwrd">else</span> {
<a class="br" href="#L1783" id="L1783">1783 </a>							<span class="kwrd">throw</span> <span class="kwrd">new</span> <a class="hid" href="sumtype.d.html#L1513" title="sumtype.MatchException">MatchException</a>(
<a class="br" href="#L1784" id="L1784">1784 </a>								<span class="str">&quot;No matching handler for types `&quot;</span> ~ <span class="hid">valueTypes</span>!<span class="hid">caseId.stringof</span> ~ <span class="str">&quot;`&quot;</span>);
<a class="br" href="#L1785" id="L1785">1785 </a>						}
<a class="br" href="#L1786" id="L1786">1786 </a>					}
<a class="br" href="#L1787" id="L1787">1787 </a>			}
<a class="br" href="#L1788" id="L1788">1788 </a>		}
<a class="br" href="#L1789" id="L1789">1789 </a>
<a class="br" href="#L1790" id="L1790">1790 </a>		<span class="kwrd">assert</span>(<span class="kwrd">false</span>); <span class="com">// unreached</span>
<a class="br" href="#L1791" id="L1791">1791 </a>	}
<a class="br" href="#L1792" id="L1792">1792 </a>}
<a class="br" href="#L1793" id="L1793">1793 </a>
<a class="br" href="#L1794" id="L1794">1794 </a><span class="com">// Matching</span>
<a class="br" href="#L1795" id="L1795">1795 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1796" id="L1796">1796 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>);
<a class="br" href="#L1797" id="L1797">1797 </a>
<a class="br" href="#L1798" id="L1798">1798 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">MySum</span>(<span class="num">42</span>);
<a class="br" href="#L1799" id="L1799">1799 </a>	<span class="hid">MySum</span> <span class="hid">y</span> = <span class="hid">MySum</span>(<span class="num">3.14</span>);
<a class="br" href="#L1800" id="L1800">1800 </a>
<a class="br" href="#L1801" id="L1801">1801 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!((<span class="type">int</span> <span class="hid">v</span>) =&gt; <span class="kwrd">true</span>, (<span class="type">float</span> <span class="hid">v</span>) =&gt; <span class="kwrd">false</span>));
<a class="br" href="#L1802" id="L1802">1802 </a>	<span class="kwrd">assert</span>(<span class="hid">y.match</span>!((<span class="type">int</span> <span class="hid">v</span>) =&gt; <span class="kwrd">false</span>, (<span class="type">float</span> <span class="hid">v</span>) =&gt; <span class="kwrd">true</span>));
<a class="br" href="#L1803" id="L1803">1803 </a>}
<a class="br" href="#L1804" id="L1804">1804 </a>
<a class="br" href="#L1805" id="L1805">1805 </a><span class="com">// Missing handlers</span>
<a class="br" href="#L1806" id="L1806">1806 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1807" id="L1807">1807 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>);
<a class="br" href="#L1808" id="L1808">1808 </a>
<a class="br" href="#L1809" id="L1809">1809 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">MySum</span>(<span class="num">42</span>);
<a class="br" href="#L1810" id="L1810">1810 </a>
<a class="br" href="#L1811" id="L1811">1811 </a>	<span class="kwrd">assert</span>(!<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">x.match</span>!((<span class="type">int</span> <span class="hid">x</span>) =&gt; <span class="kwrd">true</span>)));
<a class="br" href="#L1812" id="L1812">1812 </a>	<span class="kwrd">assert</span>(!<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">x.match</span>!()));
<a class="br" href="#L1813" id="L1813">1813 </a>}
<a class="br" href="#L1814" id="L1814">1814 </a>
<a class="br" href="#L1815" id="L1815">1815 </a><span class="com">// Handlers with qualified parameters</span>
<a class="br" href="#L1816" id="L1816">1816 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L1817" id="L1817">1817 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1818" id="L1818">1818 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>[], <span class="type">float</span>[]);
<a class="br" href="#L1819" id="L1819">1819 </a>
<a class="br" href="#L1820" id="L1820">1820 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">MySum</span>([<span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>]);
<a class="br" href="#L1821" id="L1821">1821 </a>	<span class="hid">MySum</span> <span class="hid">y</span> = <span class="hid">MySum</span>([<span class="num">1.0</span>, <span class="num">2.0</span>, <span class="num">3.0</span>]);
<a class="br" href="#L1822" id="L1822">1822 </a>
<a class="br" href="#L1823" id="L1823">1823 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!((<span class="kwrd">const</span>(<span class="type">int</span>[]) <span class="hid">v</span>) =&gt; <span class="kwrd">true</span>, (<span class="kwrd">const</span>(<span class="type">float</span>[]) <span class="hid">v</span>) =&gt; <span class="kwrd">false</span>));
<a class="br" href="#L1824" id="L1824">1824 </a>	<span class="kwrd">assert</span>(<span class="hid">y.match</span>!((<span class="kwrd">const</span>(<span class="type">int</span>[]) <span class="hid">v</span>) =&gt; <span class="kwrd">false</span>, (<span class="kwrd">const</span>(<span class="type">float</span>[]) <span class="hid">v</span>) =&gt; <span class="kwrd">true</span>));
<a class="br" href="#L1825" id="L1825">1825 </a>}
<a class="br" href="#L1826" id="L1826">1826 </a>
<a class="br" href="#L1827" id="L1827">1827 </a><span class="com">// Handlers for qualified types</span>
<a class="br" href="#L1828" id="L1828">1828 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L1829" id="L1829">1829 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1830" id="L1830">1830 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="kwrd">immutable</span>(<span class="type">int</span>[]), <span class="kwrd">immutable</span>(<span class="type">float</span>[]));
<a class="br" href="#L1831" id="L1831">1831 </a>
<a class="br" href="#L1832" id="L1832">1832 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">MySum</span>([<span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>]);
<a class="br" href="#L1833" id="L1833">1833 </a>
<a class="br" href="#L1834" id="L1834">1834 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!((<span class="kwrd">immutable</span>(<span class="type">int</span>[]) <span class="hid">v</span>) =&gt; <span class="kwrd">true</span>, (<span class="kwrd">immutable</span>(<span class="type">float</span>[]) <span class="hid">v</span>) =&gt; <span class="kwrd">false</span>));
<a class="br" href="#L1835" id="L1835">1835 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!((<span class="kwrd">const</span>(<span class="type">int</span>[]) <span class="hid">v</span>) =&gt; <span class="kwrd">true</span>, (<span class="kwrd">const</span>(<span class="type">float</span>[]) <span class="hid">v</span>) =&gt; <span class="kwrd">false</span>));
<a class="br" href="#L1836" id="L1836">1836 </a>	<span class="com">// Tail-qualified parameters</span>
<a class="br" href="#L1837" id="L1837">1837 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!((<span class="kwrd">immutable</span>(<span class="type">int</span>)[] <span class="hid">v</span>) =&gt; <span class="kwrd">true</span>, (<span class="kwrd">immutable</span>(<span class="type">float</span>)[] <span class="hid">v</span>) =&gt; <span class="kwrd">false</span>));
<a class="br" href="#L1838" id="L1838">1838 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!((<span class="kwrd">const</span>(<span class="type">int</span>)[] <span class="hid">v</span>) =&gt; <span class="kwrd">true</span>, (<span class="kwrd">const</span>(<span class="type">float</span>)[] <span class="hid">v</span>) =&gt; <span class="kwrd">false</span>));
<a class="br" href="#L1839" id="L1839">1839 </a>	<span class="com">// Generic parameters</span>
<a class="br" href="#L1840" id="L1840">1840 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!((<span class="kwrd">immutable</span> <span class="hid">v</span>) =&gt; <span class="kwrd">true</span>));
<a class="br" href="#L1841" id="L1841">1841 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!((<span class="kwrd">const</span> <span class="hid">v</span>) =&gt; <span class="kwrd">true</span>));
<a class="br" href="#L1842" id="L1842">1842 </a>	<span class="com">// Unqualified parameters</span>
<a class="br" href="#L1843" id="L1843">1843 </a>	<span class="kwrd">assert</span>(!<span class="kwrd">__traits</span>(<span class="hid">compiles</span>,
<a class="br" href="#L1844" id="L1844">1844 </a>		<span class="hid">x.match</span>!((<span class="type">int</span>[] <span class="hid">v</span>) =&gt; <span class="kwrd">true</span>, (<span class="type">float</span>[] <span class="hid">v</span>) =&gt; <span class="kwrd">false</span>)
<a class="br" href="#L1845" id="L1845">1845 </a>	));
<a class="br" href="#L1846" id="L1846">1846 </a>}
<a class="br" href="#L1847" id="L1847">1847 </a>
<a class="br" href="#L1848" id="L1848">1848 </a><span class="com">// Delegate handlers</span>
<a class="br" href="#L1849" id="L1849">1849 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L1850" id="L1850">1850 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1851" id="L1851">1851 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>);
<a class="br" href="#L1852" id="L1852">1852 </a>
<a class="br" href="#L1853" id="L1853">1853 </a>	<span class="type">int</span> <span class="hid">answer</span> = <span class="num">42</span>;
<a class="br" href="#L1854" id="L1854">1854 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">MySum</span>(<span class="num">42</span>);
<a class="br" href="#L1855" id="L1855">1855 </a>	<span class="hid">MySum</span> <span class="hid">y</span> = <span class="hid">MySum</span>(<span class="num">3.14</span>);
<a class="br" href="#L1856" id="L1856">1856 </a>
<a class="br" href="#L1857" id="L1857">1857 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!((<span class="type">int</span> <span class="hid">v</span>) =&gt; <span class="hid">v</span> == <span class="hid">answer</span>, (<span class="type">float</span> <span class="hid">v</span>) =&gt; <span class="hid">v</span> == <span class="hid">answer</span>));
<a class="br" href="#L1858" id="L1858">1858 </a>	<span class="kwrd">assert</span>(!<span class="hid">y.match</span>!((<span class="type">int</span> <span class="hid">v</span>) =&gt; <span class="hid">v</span> == <span class="hid">answer</span>, (<span class="type">float</span> <span class="hid">v</span>) =&gt; <span class="hid">v</span> == <span class="hid">answer</span>));
<a class="br" href="#L1859" id="L1859">1859 </a>}
<a class="br" href="#L1860" id="L1860">1860 </a>
<a class="br" href="#L1861" id="L1861">1861 </a><span class="kwrd">version</span>(<span class="kwrd">unittest</span>) {
<a class="br" href="#L1862" id="L1862">1862 </a>	<span class="kwrd">version</span>(<span class="hid">D_BetterC</span>) {
<a class="br" href="#L1863" id="L1863">1863 </a>		<span class="com">// std.math.isClose depends on core.runtime.math, so use a</span>
<a class="br" href="#L1864" id="L1864">1864 </a>		<span class="com">// libc-based version for testing with -betterC</span>
<a class="br" href="#L1865" id="L1865">1865 </a>		@<span class="hid">safe</span> <span class="kwrd">pure</span> @<span class="hid">nogc</span> <span class="kwrd">nothrow</span>
<a class="br" href="#L1866" id="L1866">1866 </a>		<span class="kwrd">private</span> <span class="type">bool</span> <a class="hid" href="sumtype.d.html#L1866" title="sumtype.isClose">isClose</a>(<span class="type">double</span> <span class="hid">lhs</span>, <span class="type">double</span> <span class="hid">rhs</span>)
<a class="br" href="#L1867" id="L1867">1867 </a>		{
<a class="br" href="#L1868" id="L1868">1868 </a>			<span class="kwrd">import</span> <span class="hid">core.stdc.math</span>: <span class="hid">fabs</span>;
<a class="br" href="#L1869" id="L1869">1869 </a>
<a class="br" href="#L1870" id="L1870">1870 </a>			<span class="kwrd">return</span> (<span class="hid">lhs</span> - <span class="hid">rhs</span>) &lt; <span class="num">1e-5</span>;
<a class="br" href="#L1871" id="L1871">1871 </a>		}
<a class="br" href="#L1872" id="L1872">1872 </a>	} <span class="kwrd">else</span> {
<a class="br" href="#L1873" id="L1873">1873 </a>		<span class="kwrd">import</span> <span class="hid">std.math</span>: <a class="hid" href="sumtype.d.html#L1866" title="sumtype.isClose">isClose</a>;
<a class="br" href="#L1874" id="L1874">1874 </a>	}
<a class="br" href="#L1875" id="L1875">1875 </a>}
<a class="br" href="#L1876" id="L1876">1876 </a>
<a class="br" href="#L1877" id="L1877">1877 </a><span class="com">// Generic handler</span>
<a class="br" href="#L1878" id="L1878">1878 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1879" id="L1879">1879 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>);
<a class="br" href="#L1880" id="L1880">1880 </a>
<a class="br" href="#L1881" id="L1881">1881 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">MySum</span>(<span class="num">42</span>);
<a class="br" href="#L1882" id="L1882">1882 </a>	<span class="hid">MySum</span> <span class="hid">y</span> = <span class="hid">MySum</span>(<span class="num">3.14</span>);
<a class="br" href="#L1883" id="L1883">1883 </a>
<a class="br" href="#L1884" id="L1884">1884 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!(<span class="hid">v</span> =&gt; <span class="hid">v</span>*<span class="num">2</span>) == <span class="num">84</span>);
<a class="br" href="#L1885" id="L1885">1885 </a>	<span class="kwrd">assert</span>(<span class="hid">y.match</span>!(<span class="hid">v</span> =&gt; <span class="hid">v</span>*<span class="num">2</span>).<a class="hid" href="sumtype.d.html#L1866" title="sumtype.isClose">isClose</a>(<span class="num">6.28</span>));
<a class="br" href="#L1886" id="L1886">1886 </a>}
<a class="br" href="#L1887" id="L1887">1887 </a>
<a class="br" href="#L1888" id="L1888">1888 </a><span class="com">// Fallback to generic handler</span>
<a class="br" href="#L1889" id="L1889">1889 </a><span class="kwrd">version</span> (<span class="hid">D_BetterC</span>) {} <span class="kwrd">else</span>
<a class="br" href="#L1890" id="L1890">1890 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1891" id="L1891">1891 </a>	<span class="kwrd">import</span> <span class="hid">std.conv</span>: <span class="hid">to</span>;
<a class="br" href="#L1892" id="L1892">1892 </a>
<a class="br" href="#L1893" id="L1893">1893 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>, <span class="type">string</span>);
<a class="br" href="#L1894" id="L1894">1894 </a>
<a class="br" href="#L1895" id="L1895">1895 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">MySum</span>(<span class="num">42</span>);
<a class="br" href="#L1896" id="L1896">1896 </a>	<span class="hid">MySum</span> <span class="hid">y</span> = <span class="hid">MySum</span>(<span class="str">&quot;42&quot;</span>);
<a class="br" href="#L1897" id="L1897">1897 </a>
<a class="br" href="#L1898" id="L1898">1898 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!((<span class="type">string</span> <span class="hid">v</span>) =&gt; <span class="hid">v.to</span>!<span class="type">int</span>, <span class="hid">v</span> =&gt; <span class="hid">v</span>*<span class="num">2</span>) == <span class="num">84</span>);
<a class="br" href="#L1899" id="L1899">1899 </a>	<span class="kwrd">assert</span>(<span class="hid">y.match</span>!((<span class="type">string</span> <span class="hid">v</span>) =&gt; <span class="hid">v.to</span>!<span class="type">int</span>, <span class="hid">v</span> =&gt; <span class="hid">v</span>*<span class="num">2</span>) == <span class="num">42</span>);
<a class="br" href="#L1900" id="L1900">1900 </a>}
<a class="br" href="#L1901" id="L1901">1901 </a>
<a class="br" href="#L1902" id="L1902">1902 </a><span class="com">// Multiple non-overlapping generic handlers</span>
<a class="br" href="#L1903" id="L1903">1903 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1904" id="L1904">1904 </a>	<span class="kwrd">import</span> <span class="hid">std.array</span>: <span class="hid">staticArray</span>;
<a class="br" href="#L1905" id="L1905">1905 </a>
<a class="br" href="#L1906" id="L1906">1906 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>, <span class="type">int</span>[], <span class="type">char</span>[]);
<a class="br" href="#L1907" id="L1907">1907 </a>
<a class="br" href="#L1908" id="L1908">1908 </a>	<span class="kwrd">static</span> <span class="hid">ints</span> = <span class="hid">staticArray</span>([<span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>]);
<a class="br" href="#L1909" id="L1909">1909 </a>	<span class="kwrd">static</span> <span class="hid">chars</span> = <span class="hid">staticArray</span>([<span class="str">'a'</span>, <span class="str">'b'</span>, <span class="str">'c'</span>]);
<a class="br" href="#L1910" id="L1910">1910 </a>
<a class="br" href="#L1911" id="L1911">1911 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">MySum</span>(<span class="num">42</span>);
<a class="br" href="#L1912" id="L1912">1912 </a>	<span class="hid">MySum</span> <span class="hid">y</span> = <span class="hid">MySum</span>(<span class="num">3.14</span>);
<a class="br" href="#L1913" id="L1913">1913 </a>	<span class="hid">MySum</span> <span class="hid">z</span> = <span class="hid">MySum</span>(<span class="hid">ints</span>[]);
<a class="br" href="#L1914" id="L1914">1914 </a>	<span class="hid">MySum</span> <span class="hid">w</span> = <span class="hid">MySum</span>(<span class="hid">chars</span>[]);
<a class="br" href="#L1915" id="L1915">1915 </a>
<a class="br" href="#L1916" id="L1916">1916 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!(<span class="hid">v</span> =&gt; <span class="hid">v</span>*<span class="num">2</span>, <span class="hid">v</span> =&gt; <span class="hid">v.length</span>) == <span class="num">84</span>);
<a class="br" href="#L1917" id="L1917">1917 </a>	<span class="kwrd">assert</span>(<span class="hid">y.match</span>!(<span class="hid">v</span> =&gt; <span class="hid">v</span>*<span class="num">2</span>, <span class="hid">v</span> =&gt; <span class="hid">v.length</span>).<a class="hid" href="sumtype.d.html#L1866" title="sumtype.isClose">isClose</a>(<span class="num">6.28</span>));
<a class="br" href="#L1918" id="L1918">1918 </a>	<span class="kwrd">assert</span>(<span class="hid">w.match</span>!(<span class="hid">v</span> =&gt; <span class="hid">v</span>*<span class="num">2</span>, <span class="hid">v</span> =&gt; <span class="hid">v.length</span>) == <span class="num">3</span>);
<a class="br" href="#L1919" id="L1919">1919 </a>	<span class="kwrd">assert</span>(<span class="hid">z.match</span>!(<span class="hid">v</span> =&gt; <span class="hid">v</span>*<span class="num">2</span>, <span class="hid">v</span> =&gt; <span class="hid">v.length</span>) == <span class="num">3</span>);
<a class="br" href="#L1920" id="L1920">1920 </a>}
<a class="br" href="#L1921" id="L1921">1921 </a>
<a class="br" href="#L1922" id="L1922">1922 </a><span class="com">// Structural matching</span>
<a class="br" href="#L1923" id="L1923">1923 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1924" id="L1924">1924 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">S1</span> { <span class="type">int</span> <span class="hid">x</span>; }
<a class="br" href="#L1925" id="L1925">1925 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">S2</span> { <span class="type">int</span> <span class="hid">y</span>; }
<a class="br" href="#L1926" id="L1926">1926 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">S1</span>, <span class="hid">S2</span>);
<a class="br" href="#L1927" id="L1927">1927 </a>
<a class="br" href="#L1928" id="L1928">1928 </a>	<span class="hid">MySum</span> <span class="hid">a</span> = <span class="hid">MySum</span>(<span class="hid">S1</span>(<span class="num">0</span>));
<a class="br" href="#L1929" id="L1929">1929 </a>	<span class="hid">MySum</span> <span class="hid">b</span> = <span class="hid">MySum</span>(<span class="hid">S2</span>(<span class="num">0</span>));
<a class="br" href="#L1930" id="L1930">1930 </a>
<a class="br" href="#L1931" id="L1931">1931 </a>	<span class="kwrd">assert</span>(<span class="hid">a.match</span>!(<span class="hid">s1</span> =&gt; <span class="hid">s1.x</span> + <span class="num">1</span>, <span class="hid">s2</span> =&gt; <span class="hid">s2.y</span> - <span class="num">1</span>) == <span class="num">1</span>);
<a class="br" href="#L1932" id="L1932">1932 </a>	<span class="kwrd">assert</span>(<span class="hid">b.match</span>!(<span class="hid">s1</span> =&gt; <span class="hid">s1.x</span> + <span class="num">1</span>, <span class="hid">s2</span> =&gt; <span class="hid">s2.y</span> - <span class="num">1</span>) == -<span class="num">1</span>);
<a class="br" href="#L1933" id="L1933">1933 </a>}
<a class="br" href="#L1934" id="L1934">1934 </a>
<a class="br" href="#L1935" id="L1935">1935 </a><span class="com">// Separate opCall handlers</span>
<a class="br" href="#L1936" id="L1936">1936 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1937" id="L1937">1937 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">IntHandler</span>
<a class="br" href="#L1938" id="L1938">1938 </a>	{
<a class="br" href="#L1939" id="L1939">1939 </a>		<span class="type">bool</span> <span class="hid">opCall</span>(<span class="type">int</span> <span class="hid">arg</span>)
<a class="br" href="#L1940" id="L1940">1940 </a>		{
<a class="br" href="#L1941" id="L1941">1941 </a>			<span class="kwrd">return</span> <span class="kwrd">true</span>;
<a class="br" href="#L1942" id="L1942">1942 </a>		}
<a class="br" href="#L1943" id="L1943">1943 </a>	}
<a class="br" href="#L1944" id="L1944">1944 </a>
<a class="br" href="#L1945" id="L1945">1945 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">FloatHandler</span>
<a class="br" href="#L1946" id="L1946">1946 </a>	{
<a class="br" href="#L1947" id="L1947">1947 </a>		<span class="type">bool</span> <span class="hid">opCall</span>(<span class="type">float</span> <span class="hid">arg</span>)
<a class="br" href="#L1948" id="L1948">1948 </a>		{
<a class="br" href="#L1949" id="L1949">1949 </a>			<span class="kwrd">return</span> <span class="kwrd">false</span>;
<a class="br" href="#L1950" id="L1950">1950 </a>		}
<a class="br" href="#L1951" id="L1951">1951 </a>	}
<a class="br" href="#L1952" id="L1952">1952 </a>
<a class="br" href="#L1953" id="L1953">1953 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>);
<a class="br" href="#L1954" id="L1954">1954 </a>
<a class="br" href="#L1955" id="L1955">1955 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">MySum</span>(<span class="num">42</span>);
<a class="br" href="#L1956" id="L1956">1956 </a>	<span class="hid">MySum</span> <span class="hid">y</span> = <span class="hid">MySum</span>(<span class="num">3.14</span>);
<a class="br" href="#L1957" id="L1957">1957 </a>
<a class="br" href="#L1958" id="L1958">1958 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!(<span class="hid">IntHandler.init</span>, <span class="hid">FloatHandler.init</span>));
<a class="br" href="#L1959" id="L1959">1959 </a>	<span class="kwrd">assert</span>(!<span class="hid">y.match</span>!(<span class="hid">IntHandler.init</span>, <span class="hid">FloatHandler.init</span>));
<a class="br" href="#L1960" id="L1960">1960 </a>}
<a class="br" href="#L1961" id="L1961">1961 </a>
<a class="br" href="#L1962" id="L1962">1962 </a><span class="com">// Compound opCall handler</span>
<a class="br" href="#L1963" id="L1963">1963 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1964" id="L1964">1964 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">CompoundHandler</span>
<a class="br" href="#L1965" id="L1965">1965 </a>	{
<a class="br" href="#L1966" id="L1966">1966 </a>		<span class="type">bool</span> <span class="hid">opCall</span>(<span class="type">int</span> <span class="hid">arg</span>)
<a class="br" href="#L1967" id="L1967">1967 </a>		{
<a class="br" href="#L1968" id="L1968">1968 </a>			<span class="kwrd">return</span> <span class="kwrd">true</span>;
<a class="br" href="#L1969" id="L1969">1969 </a>		}
<a class="br" href="#L1970" id="L1970">1970 </a>
<a class="br" href="#L1971" id="L1971">1971 </a>		<span class="type">bool</span> <span class="hid">opCall</span>(<span class="type">float</span> <span class="hid">arg</span>)
<a class="br" href="#L1972" id="L1972">1972 </a>		{
<a class="br" href="#L1973" id="L1973">1973 </a>			<span class="kwrd">return</span> <span class="kwrd">false</span>;
<a class="br" href="#L1974" id="L1974">1974 </a>		}
<a class="br" href="#L1975" id="L1975">1975 </a>	}
<a class="br" href="#L1976" id="L1976">1976 </a>
<a class="br" href="#L1977" id="L1977">1977 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>);
<a class="br" href="#L1978" id="L1978">1978 </a>
<a class="br" href="#L1979" id="L1979">1979 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">MySum</span>(<span class="num">42</span>);
<a class="br" href="#L1980" id="L1980">1980 </a>	<span class="hid">MySum</span> <span class="hid">y</span> = <span class="hid">MySum</span>(<span class="num">3.14</span>);
<a class="br" href="#L1981" id="L1981">1981 </a>
<a class="br" href="#L1982" id="L1982">1982 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!(<span class="hid">CompoundHandler.init</span>));
<a class="br" href="#L1983" id="L1983">1983 </a>	<span class="kwrd">assert</span>(!<span class="hid">y.match</span>!(<span class="hid">CompoundHandler.init</span>));
<a class="br" href="#L1984" id="L1984">1984 </a>}
<a class="br" href="#L1985" id="L1985">1985 </a>
<a class="br" href="#L1986" id="L1986">1986 </a><span class="com">// Ordered matching</span>
<a class="br" href="#L1987" id="L1987">1987 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1988" id="L1988">1988 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>);
<a class="br" href="#L1989" id="L1989">1989 </a>
<a class="br" href="#L1990" id="L1990">1990 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">MySum</span>(<span class="num">42</span>);
<a class="br" href="#L1991" id="L1991">1991 </a>
<a class="br" href="#L1992" id="L1992">1992 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!((<span class="type">int</span> <span class="hid">v</span>) =&gt; <span class="kwrd">true</span>, <span class="hid">v</span> =&gt; <span class="kwrd">false</span>));
<a class="br" href="#L1993" id="L1993">1993 </a>}
<a class="br" href="#L1994" id="L1994">1994 </a>
<a class="br" href="#L1995" id="L1995">1995 </a><span class="com">// Non-exhaustive matching</span>
<a class="br" href="#L1996" id="L1996">1996 </a><span class="kwrd">version</span> (<span class="hid">D_Exceptions</span>)
<a class="br" href="#L1997" id="L1997">1997 </a>@<span class="hid">system</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L1998" id="L1998">1998 </a>	<span class="kwrd">import</span> <span class="hid">std.exception</span>: <span class="hid">assertThrown</span>, <span class="hid">assertNotThrown</span>;
<a class="br" href="#L1999" id="L1999">1999 </a>
<a class="br" href="#L2000" id="L2000">2000 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>);
<a class="br" href="#L2001" id="L2001">2001 </a>
<a class="br" href="#L2002" id="L2002">2002 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="hid">MySum</span>(<span class="num">42</span>);
<a class="br" href="#L2003" id="L2003">2003 </a>	<span class="hid">MySum</span> <span class="hid">y</span> = <span class="hid">MySum</span>(<span class="num">3.14</span>);
<a class="br" href="#L2004" id="L2004">2004 </a>
<a class="br" href="#L2005" id="L2005">2005 </a>	<span class="hid">assertNotThrown</span>!<a class="hid" href="sumtype.d.html#L1513" title="sumtype.MatchException">MatchException</a>(<span class="hid">x.tryMatch</span>!((<span class="type">int</span> <span class="hid">n</span>) =&gt; <span class="kwrd">true</span>));
<a class="br" href="#L2006" id="L2006">2006 </a>	<span class="hid">assertThrown</span>!<a class="hid" href="sumtype.d.html#L1513" title="sumtype.MatchException">MatchException</a>(<span class="hid">y.tryMatch</span>!((<span class="type">int</span> <span class="hid">n</span>) =&gt; <span class="kwrd">true</span>));
<a class="br" href="#L2007" id="L2007">2007 </a>}
<a class="br" href="#L2008" id="L2008">2008 </a>
<a class="br" href="#L2009" id="L2009">2009 </a><span class="com">// Non-exhaustive matching in @safe code</span>
<a class="br" href="#L2010" id="L2010">2010 </a><span class="kwrd">version</span> (<span class="hid">D_Exceptions</span>)
<a class="br" href="#L2011" id="L2011">2011 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L2012" id="L2012">2012 </a>	<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">float</span>) <span class="hid">x</span>;
<a class="br" href="#L2013" id="L2013">2013 </a>
<a class="br" href="#L2014" id="L2014">2014 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>,
<a class="br" href="#L2015" id="L2015">2015 </a>		<span class="hid">x.tryMatch</span>!(
<a class="br" href="#L2016" id="L2016">2016 </a>			(<span class="type">int</span> <span class="hid">n</span>) =&gt; <span class="hid">n</span> + <span class="num">1</span>,
<a class="br" href="#L2017" id="L2017">2017 </a>		)
<a class="br" href="#L2018" id="L2018">2018 </a>	));
<a class="br" href="#L2019" id="L2019">2019 </a>
<a class="br" href="#L2020" id="L2020">2020 </a>}
<a class="br" href="#L2021" id="L2021">2021 </a>
<a class="br" href="#L2022" id="L2022">2022 </a><span class="com">// Handlers with ref parameters</span>
<a class="br" href="#L2023" id="L2023">2023 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L2024" id="L2024">2024 </a>	<span class="kwrd">import</span> <span class="hid">std.meta</span>: <span class="hid">staticIndexOf</span>;
<a class="br" href="#L2025" id="L2025">2025 </a>
<a class="br" href="#L2026" id="L2026">2026 </a>	<span class="kwrd">alias</span> <span class="hid">Value</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">long</span>, <span class="type">double</span>);
<a class="br" href="#L2027" id="L2027">2027 </a>
<a class="br" href="#L2028" id="L2028">2028 </a>	<span class="kwrd">auto</span> <span class="hid">value</span> = <span class="hid">Value</span>(<span class="num">3.14</span>);
<a class="br" href="#L2029" id="L2029">2029 </a>
<a class="br" href="#L2030" id="L2030">2030 </a>	<span class="hid">value.match</span>!(
<a class="br" href="#L2031" id="L2031">2031 </a>		(<span class="type">long</span>) {},
<a class="br" href="#L2032" id="L2032">2032 </a>		(<span class="kwrd">ref</span> <span class="type">double</span> <span class="hid">d</span>) { <span class="hid">d</span> *= <span class="num">2</span>; }
<a class="br" href="#L2033" id="L2033">2033 </a>	);
<a class="br" href="#L2034" id="L2034">2034 </a>
<a class="br" href="#L2035" id="L2035">2035 </a>	<span class="kwrd">assert</span>(<span class="hid">value.get</span>!<span class="type">double</span>.<a class="hid" href="sumtype.d.html#L1866" title="sumtype.isClose">isClose</a>(<span class="num">6.28</span>));
<a class="br" href="#L2036" id="L2036">2036 </a>}
<a class="br" href="#L2037" id="L2037">2037 </a>
<a class="br" href="#L2038" id="L2038">2038 </a><span class="com">// Unreachable handlers</span>
<a class="br" href="#L2039" id="L2039">2039 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L2040" id="L2040">2040 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">string</span>);
<a class="br" href="#L2041" id="L2041">2041 </a>
<a class="br" href="#L2042" id="L2042">2042 </a>	<span class="hid">MySum</span> <span class="hid">s</span>;
<a class="br" href="#L2043" id="L2043">2043 </a>
<a class="br" href="#L2044" id="L2044">2044 </a>	<span class="kwrd">assert</span>(!<span class="kwrd">__traits</span>(<span class="hid">compiles</span>,
<a class="br" href="#L2045" id="L2045">2045 </a>		<span class="hid">s.match</span>!(
<a class="br" href="#L2046" id="L2046">2046 </a>			(<span class="type">int</span> <span class="hid">_</span>) =&gt; <span class="num">0</span>,
<a class="br" href="#L2047" id="L2047">2047 </a>			(<span class="type">string</span> <span class="hid">_</span>) =&gt; <span class="num">1</span>,
<a class="br" href="#L2048" id="L2048">2048 </a>			(<span class="type">double</span> <span class="hid">_</span>) =&gt; <span class="num">2</span>
<a class="br" href="#L2049" id="L2049">2049 </a>		)
<a class="br" href="#L2050" id="L2050">2050 </a>	));
<a class="br" href="#L2051" id="L2051">2051 </a>
<a class="br" href="#L2052" id="L2052">2052 </a>	<span class="kwrd">assert</span>(!<span class="kwrd">__traits</span>(<span class="hid">compiles</span>,
<a class="br" href="#L2053" id="L2053">2053 </a>		<span class="hid">s.match</span>!(
<a class="br" href="#L2054" id="L2054">2054 </a>			<span class="hid">_</span> =&gt; <span class="num">0</span>,
<a class="br" href="#L2055" id="L2055">2055 </a>			(<span class="type">int</span> <span class="hid">_</span>) =&gt; <span class="num">1</span>
<a class="br" href="#L2056" id="L2056">2056 </a>		)
<a class="br" href="#L2057" id="L2057">2057 </a>	));
<a class="br" href="#L2058" id="L2058">2058 </a>}
<a class="br" href="#L2059" id="L2059">2059 </a>
<a class="br" href="#L2060" id="L2060">2060 </a><span class="com">// Unsafe handlers</span>
<a class="br" href="#L2061" id="L2061">2061 </a><span class="kwrd">unittest</span> {
<a class="br" href="#L2062" id="L2062">2062 </a>	<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="type">int</span> <span class="hid">x</span>;
<a class="br" href="#L2063" id="L2063">2063 </a>	<span class="kwrd">alias</span> <span class="hid">unsafeHandler</span> = (<span class="type">int</span> <span class="hid">x</span>) @<span class="hid">system</span> { <span class="kwrd">return</span>; };
<a class="br" href="#L2064" id="L2064">2064 </a>
<a class="br" href="#L2065" id="L2065">2065 </a>	<span class="kwrd">assert</span>(!<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, () @<span class="hid">safe</span> {
<a class="br" href="#L2066" id="L2066">2066 </a>		<span class="hid">x.match</span>!<span class="hid">unsafeHandler</span>;
<a class="br" href="#L2067" id="L2067">2067 </a>	}));
<a class="br" href="#L2068" id="L2068">2068 </a>
<a class="br" href="#L2069" id="L2069">2069 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, () @<span class="hid">system</span> {
<a class="br" href="#L2070" id="L2070">2070 </a>		<span class="kwrd">return</span> <span class="hid">x.match</span>!<span class="hid">unsafeHandler</span>;
<a class="br" href="#L2071" id="L2071">2071 </a>	}));
<a class="br" href="#L2072" id="L2072">2072 </a>}
<a class="br" href="#L2073" id="L2073">2073 </a>
<a class="br" href="#L2074" id="L2074">2074 </a><span class="com">// Overloaded handlers</span>
<a class="br" href="#L2075" id="L2075">2075 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L2076" id="L2076">2076 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">OverloadSet</span>
<a class="br" href="#L2077" id="L2077">2077 </a>	{
<a class="br" href="#L2078" id="L2078">2078 </a>		<span class="kwrd">static</span> <span class="type">string</span> <span class="hid">fun</span>(<span class="type">int</span> <span class="hid">i</span>) { <span class="kwrd">return</span> <span class="str">&quot;int&quot;</span>; }
<a class="br" href="#L2079" id="L2079">2079 </a>		<span class="kwrd">static</span> <span class="type">string</span> <span class="hid">fun</span>(<span class="type">double</span> <span class="hid">d</span>) { <span class="kwrd">return</span> <span class="str">&quot;double&quot;</span>; }
<a class="br" href="#L2080" id="L2080">2080 </a>	}
<a class="br" href="#L2081" id="L2081">2081 </a>
<a class="br" href="#L2082" id="L2082">2082 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">double</span>);
<a class="br" href="#L2083" id="L2083">2083 </a>
<a class="br" href="#L2084" id="L2084">2084 </a>	<span class="hid">MySum</span> <span class="hid">a</span> = <span class="num">42</span>;
<a class="br" href="#L2085" id="L2085">2085 </a>	<span class="hid">MySum</span> <span class="hid">b</span> = <span class="num">3.14</span>;
<a class="br" href="#L2086" id="L2086">2086 </a>
<a class="br" href="#L2087" id="L2087">2087 </a>	<span class="kwrd">assert</span>(<span class="hid">a.match</span>!(<span class="hid">OverloadSet.fun</span>) == <span class="str">&quot;int&quot;</span>);
<a class="br" href="#L2088" id="L2088">2088 </a>	<span class="kwrd">assert</span>(<span class="hid">b.match</span>!(<span class="hid">OverloadSet.fun</span>) == <span class="str">&quot;double&quot;</span>);
<a class="br" href="#L2089" id="L2089">2089 </a>}
<a class="br" href="#L2090" id="L2090">2090 </a>
<a class="br" href="#L2091" id="L2091">2091 </a><span class="com">// Overload sets that include SumType arguments</span>
<a class="br" href="#L2092" id="L2092">2092 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L2093" id="L2093">2093 </a>	<span class="kwrd">alias</span> <span class="hid">Inner</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">double</span>);
<a class="br" href="#L2094" id="L2094">2094 </a>	<span class="kwrd">alias</span> <span class="hid">Outer</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">Inner</span>, <span class="type">string</span>);
<a class="br" href="#L2095" id="L2095">2095 </a>
<a class="br" href="#L2096" id="L2096">2096 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">OverloadSet</span>
<a class="br" href="#L2097" id="L2097">2097 </a>	{
<a class="br" href="#L2098" id="L2098">2098 </a>		@<span class="hid">safe</span>:
<a class="br" href="#L2099" id="L2099">2099 </a>		<span class="kwrd">static</span> <span class="type">string</span> <span class="hid">fun</span>(<span class="type">int</span> <span class="hid">i</span>) { <span class="kwrd">return</span> <span class="str">&quot;int&quot;</span>; }
<a class="br" href="#L2100" id="L2100">2100 </a>		<span class="kwrd">static</span> <span class="type">string</span> <span class="hid">fun</span>(<span class="type">double</span> <span class="hid">d</span>) { <span class="kwrd">return</span> <span class="str">&quot;double&quot;</span>; }
<a class="br" href="#L2101" id="L2101">2101 </a>		<span class="kwrd">static</span> <span class="type">string</span> <span class="hid">fun</span>(<span class="type">string</span> <span class="hid">s</span>) { <span class="kwrd">return</span> <span class="str">&quot;string&quot;</span>; }
<a class="br" href="#L2102" id="L2102">2102 </a>		<span class="kwrd">static</span> <span class="type">string</span> <span class="hid">fun</span>(<span class="hid">Inner</span> <span class="hid">i</span>) { <span class="kwrd">return</span> <span class="hid">i.match</span>!<span class="hid">fun</span>; }
<a class="br" href="#L2103" id="L2103">2103 </a>		<span class="kwrd">static</span> <span class="type">string</span> <span class="hid">fun</span>(<span class="hid">Outer</span> <span class="hid">o</span>) { <span class="kwrd">return</span> <span class="hid">o.match</span>!<span class="hid">fun</span>; }
<a class="br" href="#L2104" id="L2104">2104 </a>	}
<a class="br" href="#L2105" id="L2105">2105 </a>
<a class="br" href="#L2106" id="L2106">2106 </a>	<span class="hid">Outer</span> <span class="hid">a</span> = <span class="hid">Inner</span>(<span class="num">42</span>);
<a class="br" href="#L2107" id="L2107">2107 </a>	<span class="hid">Outer</span> <span class="hid">b</span> = <span class="hid">Inner</span>(<span class="num">3.14</span>);
<a class="br" href="#L2108" id="L2108">2108 </a>	<span class="hid">Outer</span> <span class="hid">c</span> = <span class="str">&quot;foo&quot;</span>;
<a class="br" href="#L2109" id="L2109">2109 </a>
<a class="br" href="#L2110" id="L2110">2110 </a>	<span class="kwrd">assert</span>(<span class="hid">OverloadSet.fun</span>(<span class="hid">a</span>) == <span class="str">&quot;int&quot;</span>);
<a class="br" href="#L2111" id="L2111">2111 </a>	<span class="kwrd">assert</span>(<span class="hid">OverloadSet.fun</span>(<span class="hid">b</span>) == <span class="str">&quot;double&quot;</span>);
<a class="br" href="#L2112" id="L2112">2112 </a>	<span class="kwrd">assert</span>(<span class="hid">OverloadSet.fun</span>(<span class="hid">c</span>) == <span class="str">&quot;string&quot;</span>);
<a class="br" href="#L2113" id="L2113">2113 </a>}
<a class="br" href="#L2114" id="L2114">2114 </a>
<a class="br" href="#L2115" id="L2115">2115 </a><span class="com">// Overload sets with ref arguments</span>
<a class="br" href="#L2116" id="L2116">2116 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L2117" id="L2117">2117 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">OverloadSet</span>
<a class="br" href="#L2118" id="L2118">2118 </a>	{
<a class="br" href="#L2119" id="L2119">2119 </a>		<span class="kwrd">static</span> <span class="type">void</span> <span class="hid">fun</span>(<span class="kwrd">ref</span> <span class="type">int</span> <span class="hid">i</span>) { <span class="hid">i</span> = <span class="num">42</span>; }
<a class="br" href="#L2120" id="L2120">2120 </a>		<span class="kwrd">static</span> <span class="type">void</span> <span class="hid">fun</span>(<span class="kwrd">ref</span> <span class="type">double</span> <span class="hid">d</span>) { <span class="hid">d</span> = <span class="num">3.14</span>; }
<a class="br" href="#L2121" id="L2121">2121 </a>	}
<a class="br" href="#L2122" id="L2122">2122 </a>
<a class="br" href="#L2123" id="L2123">2123 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">double</span>);
<a class="br" href="#L2124" id="L2124">2124 </a>
<a class="br" href="#L2125" id="L2125">2125 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="num">0</span>;
<a class="br" href="#L2126" id="L2126">2126 </a>	<span class="hid">MySum</span> <span class="hid">y</span> = <span class="num">0.0</span>;
<a class="br" href="#L2127" id="L2127">2127 </a>
<a class="br" href="#L2128" id="L2128">2128 </a>	<span class="hid">x.match</span>!(<span class="hid">OverloadSet.fun</span>);
<a class="br" href="#L2129" id="L2129">2129 </a>	<span class="hid">y.match</span>!(<span class="hid">OverloadSet.fun</span>);
<a class="br" href="#L2130" id="L2130">2130 </a>
<a class="br" href="#L2131" id="L2131">2131 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!((<span class="hid">value</span>) =&gt; <span class="kwrd">is</span>(<span class="kwrd">typeof</span>(<span class="hid">value</span>) == <span class="type">int</span>) &amp;&amp; <span class="hid">value</span> == <span class="num">42</span>));
<a class="br" href="#L2132" id="L2132">2132 </a>	<span class="kwrd">assert</span>(<span class="hid">y.match</span>!((<span class="hid">value</span>) =&gt; <span class="kwrd">is</span>(<span class="kwrd">typeof</span>(<span class="hid">value</span>) == <span class="type">double</span>) &amp;&amp; <span class="hid">value</span> == <span class="num">3.14</span>));
<a class="br" href="#L2133" id="L2133">2133 </a>}
<a class="br" href="#L2134" id="L2134">2134 </a>
<a class="br" href="#L2135" id="L2135">2135 </a><span class="com">// Overload sets with templates</span>
<a class="br" href="#L2136" id="L2136">2136 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L2137" id="L2137">2137 </a>	<span class="kwrd">import</span> <span class="hid">std.traits</span>: <span class="hid">isNumeric</span>;
<a class="br" href="#L2138" id="L2138">2138 </a>
<a class="br" href="#L2139" id="L2139">2139 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">OverloadSet</span>
<a class="br" href="#L2140" id="L2140">2140 </a>	{
<a class="br" href="#L2141" id="L2141">2141 </a>		<span class="kwrd">static</span> <span class="type">string</span> <span class="hid">fun</span>(<span class="type">string</span> <span class="hid">arg</span>)
<a class="br" href="#L2142" id="L2142">2142 </a>		{
<a class="br" href="#L2143" id="L2143">2143 </a>			<span class="kwrd">return</span> <span class="str">&quot;string&quot;</span>;
<a class="br" href="#L2144" id="L2144">2144 </a>		}
<a class="br" href="#L2145" id="L2145">2145 </a>
<a class="br" href="#L2146" id="L2146">2146 </a>		<span class="kwrd">static</span> <span class="type">string</span> <span class="hid">fun</span>(<span class="hid">T</span>)(<span class="hid">T</span> <span class="hid">arg</span>)
<a class="br" href="#L2147" id="L2147">2147 </a>			<span class="kwrd">if</span> (<span class="hid">isNumeric</span>!<span class="hid">T</span>)
<a class="br" href="#L2148" id="L2148">2148 </a>		{
<a class="br" href="#L2149" id="L2149">2149 </a>			<span class="kwrd">return</span> <span class="str">&quot;numeric&quot;</span>;
<a class="br" href="#L2150" id="L2150">2150 </a>		}
<a class="br" href="#L2151" id="L2151">2151 </a>	}
<a class="br" href="#L2152" id="L2152">2152 </a>
<a class="br" href="#L2153" id="L2153">2153 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">string</span>);
<a class="br" href="#L2154" id="L2154">2154 </a>
<a class="br" href="#L2155" id="L2155">2155 </a>	<span class="hid">MySum</span> <span class="hid">x</span> = <span class="num">123</span>;
<a class="br" href="#L2156" id="L2156">2156 </a>	<span class="hid">MySum</span> <span class="hid">y</span> = <span class="str">&quot;hello&quot;</span>;
<a class="br" href="#L2157" id="L2157">2157 </a>
<a class="br" href="#L2158" id="L2158">2158 </a>	<span class="kwrd">assert</span>(<span class="hid">x.match</span>!(<span class="hid">OverloadSet.fun</span>) == <span class="str">&quot;numeric&quot;</span>);
<a class="br" href="#L2159" id="L2159">2159 </a>	<span class="kwrd">assert</span>(<span class="hid">y.match</span>!(<span class="hid">OverloadSet.fun</span>) == <span class="str">&quot;string&quot;</span>);
<a class="br" href="#L2160" id="L2160">2160 </a>}
<a class="br" href="#L2161" id="L2161">2161 </a>
<a class="br" href="#L2162" id="L2162">2162 </a><span class="com">// Github issue #24</span>
<a class="br" href="#L2163" id="L2163">2163 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L2164" id="L2164">2164 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, () @<span class="hid">nogc</span> {
<a class="br" href="#L2165" id="L2165">2165 </a>		<span class="type">int</span> <span class="hid">acc</span> = <span class="num">0</span>;
<a class="br" href="#L2166" id="L2166">2166 </a>		<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!<span class="type">int</span>(<span class="num">1</span>).<a class="hid" href="sumtype.d.html#L1352" title="sumtype.match">match</a>!((<span class="type">int</span> <span class="hid">x</span>) =&gt; <span class="hid">acc</span> += <span class="hid">x</span>);
<a class="br" href="#L2167" id="L2167">2167 </a>	}));
<a class="br" href="#L2168" id="L2168">2168 </a>}
<a class="br" href="#L2169" id="L2169">2169 </a>
<a class="br" href="#L2170" id="L2170">2170 </a><span class="com">// Github issue #31</span>
<a class="br" href="#L2171" id="L2171">2171 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L2172" id="L2172">2172 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, () @<span class="hid">nogc</span> {
<a class="br" href="#L2173" id="L2173">2173 </a>		<span class="type">int</span> <span class="hid">acc</span> = <span class="num">0</span>;
<a class="br" href="#L2174" id="L2174">2174 </a>
<a class="br" href="#L2175" id="L2175">2175 </a>		<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">string</span>)(<span class="num">1</span>).<a class="hid" href="sumtype.d.html#L1352" title="sumtype.match">match</a>!(
<a class="br" href="#L2176" id="L2176">2176 </a>			(<span class="type">int</span> <span class="hid">x</span>) =&gt; <span class="hid">acc</span> += <span class="hid">x</span>,
<a class="br" href="#L2177" id="L2177">2177 </a>			(<span class="type">string</span> <span class="hid">_</span>) =&gt; <span class="num">0</span>,
<a class="br" href="#L2178" id="L2178">2178 </a>		);
<a class="br" href="#L2179" id="L2179">2179 </a>	}));
<a class="br" href="#L2180" id="L2180">2180 </a>}
<a class="br" href="#L2181" id="L2181">2181 </a>
<a class="br" href="#L2182" id="L2182">2182 </a><span class="com">// Types that `alias this` a SumType</span>
<a class="br" href="#L2183" id="L2183">2183 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L2184" id="L2184">2184 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">A</span> {}
<a class="br" href="#L2185" id="L2185">2185 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">B</span> {}
<a class="br" href="#L2186" id="L2186">2186 </a>	<span class="kwrd">static</span> <span class="kwrd">struct</span> <span class="hid">D</span> { <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="hid">A</span>, <span class="hid">B</span>) <span class="hid">value</span>; <span class="kwrd">alias</span> <span class="hid">value</span> <span class="kwrd">this</span>; }
<a class="br" href="#L2187" id="L2187">2187 </a>
<a class="br" href="#L2188" id="L2188">2188 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <span class="hid">D</span>().<a class="hid" href="sumtype.d.html#L1352" title="sumtype.match">match</a>!(<span class="hid">_</span> =&gt; <span class="kwrd">true</span>)));
<a class="br" href="#L2189" id="L2189">2189 </a>}
<a class="br" href="#L2190" id="L2190">2190 </a>
<a class="br" href="#L2191" id="L2191">2191 </a><span class="com">// Multiple dispatch</span>
<a class="br" href="#L2192" id="L2192">2192 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L2193" id="L2193">2193 </a>	<span class="kwrd">alias</span> <span class="hid">MySum</span> = <a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>, <span class="type">string</span>);
<a class="br" href="#L2194" id="L2194">2194 </a>
<a class="br" href="#L2195" id="L2195">2195 </a>	<span class="kwrd">static</span> <span class="type">int</span> <span class="hid">fun</span>(<span class="hid">MySum</span> <span class="hid">x</span>, <span class="hid">MySum</span> <span class="hid">y</span>)
<a class="br" href="#L2196" id="L2196">2196 </a>	{
<a class="br" href="#L2197" id="L2197">2197 </a>		<span class="kwrd">import</span> <span class="hid">std.meta</span>: <span class="hid">Args</span> = <span class="hid">AliasSeq</span>;
<a class="br" href="#L2198" id="L2198">2198 </a>
<a class="br" href="#L2199" id="L2199">2199 </a>		<span class="kwrd">return</span> <span class="hid">Args</span>!(<span class="hid">x</span>, <span class="hid">y</span>).<a class="hid" href="sumtype.d.html#L1352" title="sumtype.match">match</a>!(
<a class="br" href="#L2200" id="L2200">2200 </a>			(<span class="type">int</span>    <span class="hid">xv</span>, <span class="type">int</span>    <span class="hid">yv</span>) =&gt; <span class="num">0</span>,
<a class="br" href="#L2201" id="L2201">2201 </a>			(<span class="type">string</span> <span class="hid">xv</span>, <span class="type">int</span>    <span class="hid">yv</span>) =&gt; <span class="num">1</span>,
<a class="br" href="#L2202" id="L2202">2202 </a>			(<span class="type">int</span>    <span class="hid">xv</span>, <span class="type">string</span> <span class="hid">yv</span>) =&gt; <span class="num">2</span>,
<a class="br" href="#L2203" id="L2203">2203 </a>			(<span class="type">string</span> <span class="hid">xv</span>, <span class="type">string</span> <span class="hid">yv</span>) =&gt; <span class="num">3</span>
<a class="br" href="#L2204" id="L2204">2204 </a>		);
<a class="br" href="#L2205" id="L2205">2205 </a>	}
<a class="br" href="#L2206" id="L2206">2206 </a>
<a class="br" href="#L2207" id="L2207">2207 </a>	<span class="kwrd">assert</span>(<span class="hid">fun</span>(<span class="hid">MySum</span>(<span class="num">0</span>),  <span class="hid">MySum</span>(<span class="num">0</span>))  == <span class="num">0</span>);
<a class="br" href="#L2208" id="L2208">2208 </a>	<span class="kwrd">assert</span>(<span class="hid">fun</span>(<span class="hid">MySum</span>(<span class="str">&quot;&quot;</span>), <span class="hid">MySum</span>(<span class="num">0</span>))  == <span class="num">1</span>);
<a class="br" href="#L2209" id="L2209">2209 </a>	<span class="kwrd">assert</span>(<span class="hid">fun</span>(<span class="hid">MySum</span>(<span class="num">0</span>),  <span class="hid">MySum</span>(<span class="str">&quot;&quot;</span>)) == <span class="num">2</span>);
<a class="br" href="#L2210" id="L2210">2210 </a>	<span class="kwrd">assert</span>(<span class="hid">fun</span>(<span class="hid">MySum</span>(<span class="str">&quot;&quot;</span>), <span class="hid">MySum</span>(<span class="str">&quot;&quot;</span>)) == <span class="num">3</span>);
<a class="br" href="#L2211" id="L2211">2211 </a>}
<a class="br" href="#L2212" id="L2212">2212 </a>
<a class="br" href="#L2213" id="L2213">2213 </a><span class="com">// inout SumTypes</span>
<a class="br" href="#L2214" id="L2214">2214 </a>@<span class="hid">safe</span> <span class="kwrd">unittest</span> {
<a class="br" href="#L2215" id="L2215">2215 </a>	<span class="kwrd">assert</span>(<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, {
<a class="br" href="#L2216" id="L2216">2216 </a>		<span class="kwrd">inout</span>(<span class="type">int</span>[]) <span class="hid">fun</span>(<span class="kwrd">inout</span>(<a class="hid" href="sumtype.d.html#L283" title="sumtype.SumType">SumType</a>!(<span class="type">int</span>[])) <span class="hid">x</span>)
<a class="br" href="#L2217" id="L2217">2217 </a>		{
<a class="br" href="#L2218" id="L2218">2218 </a>			<span class="kwrd">return</span> <span class="hid">x.match</span>!((<span class="kwrd">inout</span>(<span class="type">int</span>[]) <span class="hid">a</span>) =&gt; <span class="hid">a</span>);
<a class="br" href="#L2219" id="L2219">2219 </a>		}
<a class="br" href="#L2220" id="L2220">2220 </a>	}));
<a class="br" href="#L2221" id="L2221">2221 </a>}
<a class="br" href="#L2222" id="L2222">2222 </a>
<a class="br" href="#L2223" id="L2223">2223 </a><span class="kwrd">static</span> <span class="kwrd">if</span> (<span class="kwrd">__traits</span>(<span class="hid">compiles</span>, { <span class="kwrd">import</span> <span class="hid">std.traits</span>: <a class="hid" href="sumtype.d.html#L2226" title="sumtype.isRvalueAssignable">isRvalueAssignable</a>; })) {
<a class="br" href="#L2224" id="L2224">2224 </a>	<span class="kwrd">import</span> <span class="hid">std.traits</span>: <a class="hid" href="sumtype.d.html#L2226" title="sumtype.isRvalueAssignable">isRvalueAssignable</a>;
<a class="br" href="#L2225" id="L2225">2225 </a>} <span class="kwrd">else</span> <span class="kwrd">private</span> {
<a class="br" href="#L2226" id="L2226">2226 </a>	<span class="kwrd">enum</span> <a class="hid" href="sumtype.d.html#L2226" title="sumtype.isRvalueAssignable">isRvalueAssignable</a>(<span class="hid">Lhs</span>, <span class="hid">Rhs</span> = <span class="hid">Lhs</span>) = <span class="kwrd">__traits</span>(<span class="hid">compiles</span>, <a class="hid" href="sumtype.d.html#L2229" title="sumtype.lvalueOf">lvalueOf</a>!<span class="hid">Lhs</span> = <a class="hid" href="sumtype.d.html#L2228" title="sumtype.rvalueOf">rvalueOf</a>!<span class="hid">Rhs</span>);
<a class="br" href="#L2227" id="L2227">2227 </a>	<span class="kwrd">struct</span> <a class="hid" href="sumtype.d.html#L2227" title="sumtype.__InoutWorkaroundStruct">__InoutWorkaroundStruct</a>{}
<a class="br" href="#L2228" id="L2228">2228 </a>	@<span class="hid">property</span> <span class="hid">T</span> <a class="hid" href="sumtype.d.html#L2228" title="sumtype.rvalueOf">rvalueOf</a>(<span class="hid">T</span>)(<span class="kwrd">inout</span> <a class="hid" href="sumtype.d.html#L2227" title="sumtype.__InoutWorkaroundStruct">__InoutWorkaroundStruct</a> = <a class="hid" href="sumtype.d.html#L2227" title="sumtype.__InoutWorkaroundStruct">__InoutWorkaroundStruct.init</a>);
<a class="br" href="#L2229" id="L2229">2229 </a>	@<span class="hid">property</span> <span class="kwrd">ref</span> <span class="hid">T</span> <a class="hid" href="sumtype.d.html#L2229" title="sumtype.lvalueOf">lvalueOf</a>(<span class="hid">T</span>)(<span class="kwrd">inout</span> <a class="hid" href="sumtype.d.html#L2227" title="sumtype.__InoutWorkaroundStruct">__InoutWorkaroundStruct</a> = <a class="hid" href="sumtype.d.html#L2227" title="sumtype.__InoutWorkaroundStruct">__InoutWorkaroundStruct.init</a>);
<a class="br" href="#L2230" id="L2230">2230 </a>}</pre></div>
		<div id="page-nav">
		<div id="source-navigation"><div class="list-holder"><ul><li><a class="docs" href="../sumtype.html">[Docs] </a><a href="#L1">sumtype</a><ul><li><a href="#L232">std.format</a></li><li><a href="#L233">std.meta</a></li><li><a href="#L234">std.meta</a></li><li><a href="#L235">std.meta</a></li><li><a href="#L236">std.traits</a></li><li><a href="#L237">std.traits</a></li><li><a href="#L238">std.traits</a></li><li><a href="#L239">std.traits</a></li><li><a href="#L240">std.typecons</a></li><li><a href="#L241">std.typecons</a></li><li><a class="docs" href="../sumtype.This.html">[Docs] </a><a href="#L244">This</a></li><li><a href="#L247">toCtString</a></li><li><a href="#L255">isAssignableTo</a></li><li><a href="#L259">isHashable</a></li><li><a class="docs" href="../sumtype.SumType.html">[Docs] </a><a href="#L283">SumType</a><ul><li><a class="docs" href="../sumtype.SumType.Types.html">[Docs] </a><a href="#L287">Types</a></li><li><a href="#L293">canHoldTag</a></li><li><a href="#L294">unsignedInts</a></li><li><a href="#L296">Tag</a></li><li><a href="#L298">Storage</a><ul><li><a href="#L300">memberName</a><ul><li><a href="#L1">tid</a></li></ul></li></ul></li><li><a href="#L312">storage</a></li><li><a href="#L313">tag</a></li><li><a href="#L329">get</a></li><li><a class="docs" href="../sumtype.SumType.this.1.html">[Docs] </a><a href="#L341">this</a></li><li><a class="docs" href="../sumtype.SumType.this.2.html">[Docs] </a><a href="#L364">this</a></li><li><a class="docs" href="../sumtype.SumType.this.3.html">[Docs] </a><a href="#L378">this</a></li><li><a href="#L391">this</a></li><li><a href="#L392">this</a></li><li><a href="#L397">hasPostblit</a></li><li><a class="docs" href="../sumtype.SumType.this.4.html">[Docs] </a><a href="#L404">this</a></li><li><a class="docs" href="../sumtype.SumType.this.5.html">[Docs] </a><a href="#L423">this</a></li><li><a href="#L438">this</a></li><li><a class="docs" href="../sumtype.SumType.this.6.html">[Docs] </a><a href="#L443">this</a></li><li><a href="#L460">this</a></li><li><a class="docs" href="../sumtype.SumType.this.7.html">[Docs] </a><a href="#L465">this</a></li><li><a href="#L482">this</a></li><li><a href="#L488">this</a></li><li><a class="docs" href="../sumtype.SumType.opAssign.1.html">[Docs] </a><a href="#L506">opAssign</a></li><li><a class="docs" href="../sumtype.SumType.opAssign.2.html">[Docs] </a><a href="#L546">opAssign</a></li><li><a href="#L552">opAssign</a></li><li><a class="docs" href="../sumtype.SumType.opAssign.3.html">[Docs] </a><a href="#L560">opAssign</a></li><li><a class="docs" href="../sumtype.SumType.opEquals.html">[Docs] </a><a href="#L575">opEquals</a></li><li><a href="#L1">includeDtor</a></li><li><a href="#L1">includeDtor</a></li><li><a class="docs" href="../sumtype.SumType.~this.html">[Docs] </a><a href="#L603">~this</a></li><li><a class="docs" href="../sumtype.SumType.toString.1.html">[Docs] </a><a href="#L631">toString</a></li><li><a class="docs" href="../sumtype.SumType.toString.2.html">[Docs] </a><a href="#L650">toString</a></li><li><a class="docs" href="../sumtype.SumType.toHash.html">[Docs] </a><a href="#L667">toHash</a></li></ul></li><li><a href="#L1286">isSumTypeInstance</a></li><li><a class="docs" href="../sumtype.isSumType.html">[Docs] </a><a href="#L1300">isSumType</a></li><li><a class="docs" href="../sumtype.match.html">[Docs] </a><a href="#L1352">match</a><ul><li><a href="#L1354">std.typecons</a></li><li><a class="docs" href="../sumtype.match.match.html">[Docs] </a><a href="#L1362">match</a></li></ul></li><li><a class="docs" href="../sumtype.tryMatch.html">[Docs] </a><a href="#L1490">tryMatch</a><ul><li><a href="#L1492">std.typecons</a></li><li><a class="docs" href="../sumtype.tryMatch.tryMatch.html">[Docs] </a><a href="#L1500">tryMatch</a></li></ul></li><li><a class="docs" href="../sumtype.MatchException.html">[Docs] </a><a href="#L1513">MatchException</a><ul><li><a class="docs" href="../sumtype.MatchException.this.html">[Docs] </a><a href="#L1517">this</a></li></ul></li><li><a class="docs" href="../sumtype.canMatch.html">[Docs] </a><a href="#L1529">canMatch</a><ul><li><a href="#L1">canMatch</a></li></ul></li><li><a href="#L1548">Iota</a><ul><li><a href="#L1551">Iota</a></li><li><a href="#L1553">Iota</a></li></ul></li><li><a href="#L1563">matchImpl</a><ul><li><a href="#L1565">matchImpl</a></li></ul></li><li><a href="#L1866">isClose</a></li><li><a href="#L1873">std.math</a></li><li><a href="#L2224">std.traits</a></li><li><a href="#L2226">isRvalueAssignable</a></li><li><a href="#L2227">__InoutWorkaroundStruct</a></li><li><a href="#L2228">rvalueOf</a></li><li><a href="#L2229">lvalueOf</a></li></ul></li></ul></div></div></div>
	</div>
	<div id="page-footer">Page generated by <a href="https://github.com/adamdruppe/adrdox">adrdox</a></div>
</body>
</html>